<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; The Common-Gate and Common-Drain Stages – COCOA: Collaborative Compendium on Analog Integrated Circuits</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../contents/partI/partI.5.html" rel="next">
<link href="../../contents/partI/partI.3.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "~",
    "/"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">COCOA: Collaborative Compendium on Analog Integrated Circuits</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-wide tools-end">
    <a href="https://github.com/bmurmann/COCOA" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../../COCOA--Collaborative-Compendium-on-Analog-Integrated-Circuits.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../contents/partI/partI.1.html">Learn to Crawl — Square-Law Transistors, Biasing and Small-Signal Analysis</a></li><li class="breadcrumb-item"><a href="../../contents/partI/partI.4.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Common-Gate and Common-Drain Stages</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgements</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/contributors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/copyright.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Copyright</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/conventions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conventions</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Learn to Crawl — Square-Law Transistors, Biasing and Small-Signal Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partI/partI.1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partI/partI.2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Transfer Characteristic of the Common-Source Voltage Amplifier</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partI/partI.3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Frequency Response of the Common-Source Voltage Amplifier</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partI/partI.4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Common-Gate and Common-Drain Stages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partI/partI.5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Biasing Circuits</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partI/partI.6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Multistage Amplifiers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partI/partI.indexes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Index</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Learn to Walk — Real Transistors, Noise, Mismatch, and Distortion</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partII/partII.1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partII/partII.2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Introduction to Feedback</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Dare to Run — Knowledge Base for State-of-the-Art Circuits</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partIII/partIII.1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../contents/partI/partI.1.html">Learn to Crawl — Square-Law Transistors, Biasing and Small-Signal Analysis</a></li><li class="breadcrumb-item"><a href="../../contents/partI/partI.4.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Common-Gate and Common-Drain Stages</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="the-common-gate-and-common-drain-stages" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Common-Gate and Common-Drain Stages</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div style="text-align: justify">
<p>As we have seen from the discussion in the previous two chapters, the common-source stage can be used to realize a basic voltage amplifier. In this chapter, we will introduce the common-gate and common-drain stages, which, for instance, can be combined with the common-source amplifier to enhance its performance. More generally, as already indicated in <a href="partI.1.html">Section 1-1</a>, most analog amplifier circuits can be modeled as a combination of common-source, common-gate and common-drain configurations. For this reason, the three basic stage configurations can be viewed as the “atoms” of analog circuit design.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Chapter Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>◆ Analyze the common-gate and common-drain stages with respect to their low- and high-frequency transfer functions and port resistances (and impedances).</p>
<p>◆ Extend the MOSFET model as needed to capture relevant new effects that must be included in the analysis.</p>
<p>◆ Provide a first pass look at application examples for the common-gate and common-drain stages</p>
</div>
</div>
<section id="overview-of-stage-configurations" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="overview-of-stage-configurations"><span class="header-section-number">4.1</span> Overview of Stage Configurations</h2>
<p>In the common-source (CS) amplifier discussed in the previous chapters, the input signal is applied to the gate and the output signal is taken from the drain. In a <strong>common-gate (CG) amplifier</strong>, the source is used as the input and the drain serves as the output terminal. In the <strong>common-drain (CD) amplifier</strong>, the input is applied at the gate and the output is taken from the source. Thus, in the context of two-port amplifiers with one terminal common between the input and output, the CS, CG, and CD circuits represent all three possible configurations (see <a href="#fig-4.1" class="quarto-xref">Figure&nbsp;<span>4.1</span></a>).</p>
<div id="fig-4.1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: Conceptual illustration of the three elementary transistor stage configurations.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;In our detailed analysis of the CG amplifier, we will find that this topology has a very low input resistance and a very high output resistance, which is exactly what we would want in a current amplifier. Conversely, the CD stage has a high input resistance and a small output resistance, which corresponds to the desired characteristics of a voltage amplifier (see <a href="partI.1.html#two-port-abstraction-for-amplifiers">Section 1-3</a>).</p>
</section>
<section id="bulk-connection-scenarios-and-required-model-extensions" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="bulk-connection-scenarios-and-required-model-extensions"><span class="header-section-number">4.2</span> Bulk Connection Scenarios and Required Model Extensions</h2>
<p>Before engaging in a detailed analysis of the CG and CD stages, we need to think about the bulk connection in these stages. For the CS stage discussed so far, it was natural to connect the bulk to the source of the MOSFET. However, now that the source is connected either to the input or output port, we need to develop an understanding of the available options.</p>
<p>&nbsp;&nbsp;&nbsp; The first aspect to consider is related to technology constraints, and specifically how the n-channel and p-channel devices are formed in the integrated circuit substrate. As already indicated in <a href="partI.2.html#p-channel-mosfet">Section 2-1-2</a>, we assume in this module that the MOSFETs are built in a so-called n-well technology (see <a href="#fig-4.2" class="quarto-xref">Figure&nbsp;<span>4.2</span></a>). This means that the substrate is p-type, and the n-channel transistors are formed directly in the substrate. In order to create p-channels, n-type wells are diffused into the substrate, and the p-channels are subsequently formed in these regions.</p>
<div id="fig-4.2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.2.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2: Cross-section of an n-well CMOS technology.
</figcaption>
</figure>
</div>
<p>Given the cross-section of <a href="#fig-4.2" class="quarto-xref">Figure&nbsp;<span>4.2</span></a>, it is clear that all n-channel transistors share the same bulk node. In contrast, the bulk node of a p-channel MOSFET can be isolated and freely connected to an arbitrary potential. <a href="#fig-4.3" class="quarto-xref">Figure&nbsp;<span>4.3</span></a> shows the possible bulk connection scenarios arising from these constraints. For CG and CD stages built using n-channels in an n-well process, the bulks are always connected to the substrate potential (assumed to be “ground” in this module) by default. On the other hand, we are free to choose the bulk connection in p-channel CG and CD amplifiers. The most common scenarios encountered in practice are to tie the p-channel bulk to the supply voltage (<span class="math inline">\(V_{DD}\)</span>), or to the source terminal. Either choice can have advantages and disadvantages, depending on the given circuit. In order to be able to reason about the associated tradeoffs, we will now extend the MOSFET model such that the bulk node is incorporated as a fourth “free” terminal.</p>
<div id="fig-4.3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.3.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3: Possible bulk connection scenarios.
</figcaption>
</figure>
</div>
<section id="well-capacitance" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="well-capacitance"><span class="header-section-number">4.2.1</span> Well Capacitance</h3>
<p>As indicated in <a href="#fig-4.2" class="quarto-xref">Figure&nbsp;<span>4.2</span></a>, the n-well region of the p-channel transistor forms a pn-junction with the p-type substrate (<span class="math inline">\(D_{bsub}\)</span>). Similar to the junctions formed by the source/drain regions (see <a href="partI.3.html#modeling-extrinsic-mosfet-capacitance">Section 3-3-1</a>), we can model this junction as a parasitic capacitance between the bulk terminal and the substrate. Whether or not this capacitance must be considered depends on the bulk connection. As shown in <a href="#fig-4.4" class="quarto-xref">Figure&nbsp;<span>4.4</span></a>, if the bulk is tied to the supply, the junction capacitance is typically irrelevant, since it is connected between <span class="math inline">\(V_{DD}\)</span> and ground, having no impact on circuit nodes that carry the signal. On the other hand, if the bulk is connected to the source, the capacitance will appear across the input port for the CG stage, and across the output port of the CD stage. In this case, the parasitic capacitance contribution from the well must be taken into account.</p>
<div id="fig-4.4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.4.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.4: Connection of the well-to-substrate diode for various configurations. (a) P-channel bulk connected to the supply. (b) Bulk connected to the source in a p-channel common-gate stage. (c) Bulk connected to the source in a p-channel common-drain stage.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp; Similar to the expression we used to estimate the source/drain junction capacitances, we can obtain an estimate for the well capacitance using</p>
<p><span id="eq-4.1"><span class="math display">\[
C_{bsub} = \frac{C_{Jwell \cdot A_{well}}}{(1+V_{BSUB} / PB)^{MJ}}
\tag{4.1}\]</span></span></p>
<p>This expression is similar to <a href="partI.3.html#eq-3.33" class="quarto-xref">Equation&nbsp;<span>3.33</span></a>, except that the sidewall contribution has been omitted for simplicity. In <a href="#eq-4.1" class="quarto-xref">Equation&nbsp;<span>4.1</span></a>, <span class="math inline">\(V_{BSUB}\)</span> is the voltage between the bulk node and the substrate (a positive voltage, i.e.,the junction is reverse biased). <span class="math inline">\(C_{Jwell}\)</span> is the zero-bias depletion capacitance parameter for the junction and Awell is the area of the n-well under consideration. The well area depends strongly on the actual layout of the transistor. However, for approximate calculations it is often sufficient to assume a basic rectangular well shape using reasonable geometry estimates. We will illustrate this using an example.</p>
<p><strong><span id="example-4-1">Example 4-1</span>: Well Capacitance Calculation</strong></p>
<p>Consider a p-channel MOSFET that was laid out as shown in <a href="#fig-ex-4.1" class="quarto-xref">Figure&nbsp;<span>4.6</span></a>. Estimate the well-to-substrate capacitance Cbsub assuming the following parameters: <span class="math inline">\(W = 10\)</span> <span class="math inline">\(μm\)</span>, <span class="math inline">\(L = 3\)</span> <span class="math inline">\(μm\)</span>, <span class="math inline">\(X_1 = 5\)</span> <span class="math inline">\(μm\)</span> (diffuion to well edge spacing), <span class="math inline">\(X2 = 3\)</span> <span class="math inline">\(μm\)</span> (diffusion spacing), <span class="math inline">\(C_{Jwell} = 0.05\)</span> <span class="math inline">\(fF/μm^2\)</span>, and <span class="math inline">\(V_{BSUB} = 2.5\)</span> <span class="math inline">\(V\)</span>.</p>
<p><strong>SOLUTION</strong></p>
<p>From <a href="#fig-ex-4.1" class="quarto-xref">Figure&nbsp;<span>4.6</span></a>, we see that</p>
<p><span class="math display">\[
A_{welll} = (W + 2X_1) \cdot (L +3L_{diff} + 2X_1 +X_2)
\]</span></p>
<p><span class="math display">\[
= (10 +10) \cdot (1 + 6 + 10+ 3)µm^2
\]</span></p>
<p><span class="math display">\[
= 400µm^2
\]</span></p>
<div id="fig-ex-4.1" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ex-4.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-ex-4.5.png" id="fig-ex-4.1" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ex-4.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.5
</figcaption>
</figure>
</div>
<p>Using <a href="#eq-4.1" class="quarto-xref">Equation&nbsp;<span>4.1</span></a> and the technology parameters for <span class="math inline">\(PB\)</span> and <span class="math inline">\(MJ\)</span> from <a href="#tbl-3.1">Table 3-1</a>, we obtain</p>
<!-- TODO table 3.1 linking -->
<p><span class="math display">\[
C_{bsub} = \frac{C_{Jwell \cdot A_{well}}}{(1+V_{BSUB} / PB)^{MJ}}
\]</span></p>
<p><span class="math display">\[
= \frac{0.05fF \cdot400}{(1+2.5 / 0.95)^{0.95}}
\]</span></p>
<p><span class="math display">\[
= 10.5fF
\]</span></p>
<div id="fig-ex-4.1" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ex-4.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-ex-4.1.png" id="fig-ex-4.1" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ex-4.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.6
</figcaption>
</figure>
</div>
<p>From the above calculation, we see that the well capacitance can be comparable to the intrinsic and extrinsic device capacitances (see <a href="#example-3-5">Example 3-5</a>). Hence, whenever the designer chooses a bulk connection for which the well capacitance appears at an internal circuit node (other than the supply), care must be taken in estimating <span class="math inline">\(C_{bsub}\)</span> and incorporating this capacitance in the overall circuit model.</p>
<p>&nbsp;&nbsp;&nbsp;As a final note, it is worth mentioning that most circuit simulation tools, such as SPICE, do not automatically account for the well capacitance. Whenever relevant, the circuit designer must (manually) ensure that an appropriate modeling element is included in the simulation. This can be done, for example, by adding a properly modeled diode or capacitor to the node in question.</p>
</section>
<section id="backstage-effect" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="backstage-effect"><span class="header-section-number">4.2.2</span> Backgate Effect</h3>
<p>In <a href="partI.2.html#first-order-mosfet-model">Section 2-1</a>, we analyzed the MOSFET’s I-V characteristics assuming that the bulk node is connected to the source, i.e., <span class="math inline">\(V_{SB}\)</span> = 0. However, in the CG and CD configurations, this is not the case unless the designer opted for a source-to-bulk tie as in the circuits of <a href="#fig-4.4" class="quarto-xref">Figure&nbsp;<span>4.4</span></a>(b) and (c). Therefore, we will now refine the I-V expressions from <a href="partI.2.html#first-order-mosfet-model">Section 2-1</a>, for the case of non-zero <span class="math inline">\(V_{SB}\)</span> and using an n-channel MOSFET for the analysis.</p>
<p>&nbsp;&nbsp;&nbsp;For an n-channel device with positive <span class="math inline">\(V_{SB}\)</span> — i.e., the source lies at a higher potential than the (grounded) substrate — the primary effect is that the depletion region between the source and the substrate is widened (see <a href="#fig-4.5" class="quarto-xref">Figure&nbsp;<span>4.7</span></a>). This follows from the usual behavior of pn junctions — the depletion region of a reverse biased junction widens for increasing reverse bias.</p>
<div id="fig-4.5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.5.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.7: N-channel MOSFET with backgate bias <span class="math inline">\(V_{SB} &gt;0\)</span>. The depletion region widens in comparison with <span class="math inline">\(V_{SB} = 0\)</span>.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp; Qualitatively speaking, the widened depletion region increases the amount of negative fixed charge (<span class="math inline">\(NA^-\)</span>) near the source. This extra negative charge opposes the injection of electrons from the source, and hence a larger <span class="math inline">\(V_{GS}\)</span> is needed to cause the same drain current <span class="math inline">\(I_D\)</span>. The larger required <span class="math inline">\(V_{GS}\)</span> is commonly modeled as an effective increase in the device’s threshold voltage. The dependence of the threshold voltage on the bulk-source voltage is called <strong>backgate effect</strong>. A detailed analysis based on solid-state physics reveals that the relationship between the applied <span class="math inline">\(V_{SB}\)</span> and the MOSFET’s threshold voltage is given by the following expression (see <a href="#reference4">Reference 1</a>):</p>
<p><span id="eq-4.2"><span class="math display">\[
V_{Tn}(V_{SB}) = V_{TOn} + γ_n(\sqrt{2φ_f+V_{SB}}-\sqrt{2φ_f})
\tag{4.2}\]</span></span></p>
<p>where <span class="math inline">\(V_{TOn}\)</span> is the threshold voltage without backgate effect, <span class="math inline">\(γ_n\)</span> is the n-channel MOSFET <strong>backgate effect parameter</strong>, and <span class="math inline">\(φ_f\)</span> is the surface potential parameter. With backgate effect included, the large-signal I-V characteristic for the saturation region is</p>
<p><span id="eq-4.3"><span class="math display">\[
I_D = \frac{1}{2} \mu_n C_{ox} \frac{W}{L} ({V_{GS}} - V_{Tn}(V_{SB}))^2 (1+\lambda_n V_{DS})
\tag{4.3}\]</span></span></p>
<p>which is identical to <a href="partI.2.html#eq-2.45" class="quarto-xref">Equation&nbsp;<span>2.45</span></a>, except that <span class="math inline">\(V_{Tn}\)</span> is now a function of <span class="math inline">\(V_{SB}\)</span>, as defined in <a href="#eq-4.2" class="quarto-xref">Equation&nbsp;<span>4.2</span></a>.</p>
<p>&nbsp;&nbsp;&nbsp; In order to incorporate the backgate effect into the small signal model of the transistor, we will follow exactly the same approach as in <a href="partI.2.html#the-lambda-model">Section 2-3-1</a>. That is, we approximate the incremental drain current around the operating point as the total differential, now with a drain current perturbation due to <span class="math inline">\(v_{bs}\)</span> included:</p>
<p><span id="eq-4.4"><span class="math display">\[
i_d =
\left.\frac{\partial i_D}{\partial v_{GS}}\right|_{Q}\, v_{gs}
+ \left.\frac{\partial i_D}{\partial v_{DS}}\right|_{Q}\, v_{ds}
+ \left.\frac{\partial i_D}{\partial v_{BS}}\right|_{Q}\, v_{bs}
\tag{4.4}\]</span></span></p>
<p><span class="math display">\[
= g_mv_{gs} + g_ov_{ds} + g_{mb}v_{bs}
\]</span></p>
<p>In this expression, gm and go are the transconductance and output conductance, respectively, and as derived previously in <a href="partI.2.html">Chapter 2</a>. The new term <span class="math inline">\(g_{mb}\)</span> is called <strong>backgate transconductance</strong> and represents the perturbation of the drain current by an incremental change in the bulk-source voltage.</p>
<p>&nbsp;&nbsp;&nbsp; To compute <span class="math inline">\(g_{mb}\)</span>, it is convenient to expand the partial derivative in <a href="#eq-4.4" class="quarto-xref">Equation&nbsp;<span>4.4</span></a> using the chain rule</p>
<p><span class="math display">\[
g_{mb} =
\left.\frac{\partial i_D}{\partial v_{BS}}\right|_{Q}
\]</span></p>
<p><span id="eq-4.5"><span class="math display">\[
= \left.\frac{\partial i_D}{\partial (V_{GS} - V_{Tn})}\right|_{Q}
\left.\frac{\partial (V_{GS} - V_{Tn})}{\partial V_{Tn}}\right|_{Q}
\left.\frac{\partial V_{Tn}}{\partial v_{BS}}\right|_{Q}
\tag{4.5}\]</span></span></p>
<p>The first partial derivative in the above expression is simply <span class="math inline">\(g_m\)</span>. The second term is equal to –1. Therefore, after partial differentiation of the threshold voltage <a href="#eq-4.2" class="quarto-xref">Equation&nbsp;<span>4.2</span></a> we obtain</p>
<p><span id="eq-4.6"><span class="math display">\[
g_{mb}
= -g_m \left.\frac{\partial V_{Tn}}{\partial v_{BS}}\right|_{Q}
= \frac{g_m \gamma_n}{2\sqrt{2\phi_f + V_{SB}}}
\tag{4.6}\]</span></span></p>
<p>Analogous to the way we incorporated <span class="math inline">\(g_m\)</span> and <span class="math inline">\(g_o\)</span>, the backgate transconductance can be included in the transistor’s small signal model as shown in <a href="#fig-4.6" class="quarto-xref">Figure&nbsp;<span>4.8</span></a>. As defined in <a href="#eq-4.4" class="quarto-xref">Equation&nbsp;<span>4.4</span></a>, the <span class="math inline">\(g_{mb}\)</span> element captures the dependence of the drain current to incremental changes in the bulk-source voltage. From this final result, we see that the term <strong>backgate</strong> was coined to reflect that the bulk acts just like another gate of the transistor. The only difference between the backgate and the actual gate node is that the backgate is physical located at the back side of the MOSFET, separated from the channel by a depletion layer.</p>
<p>&nbsp;&nbsp;&nbsp;For circuit design, it is useful to have a feel for the magnitude of <span class="math inline">\(g_{mb}\)</span>, as well as for the range of threshold voltage ranges for typical bias conditions. The following example investigates typical numbers for the technology assumed in this module.</p>
<div id="fig-4.6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.6.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.8: N-channel MOSFET small-signal model for the saturation region with backgate transconductance (<span class="math inline">\(g_{mb}\)</span>) included.
</figcaption>
</figure>
</div>
<p><strong>Example 4-2 {#example-4-2}: Backgate Effect</strong></p>
<p>Consider an n-channel MOSFET with the following parameters <span class="math inline">\(V_{T0n} = 0.5\ \mathrm{V}\)</span>, <span class="math inline">\(\gamma_{n} = 0.6\ \mathrm{V^{1/2}}\)</span>, <span class="math inline">\(\phi_{f} = 0.4\ \mathrm{V}\)</span>, and <span class="math inline">\(V_{SB} = 2.5\ \mathrm{V}\)</span>, <span class="math inline">\(1.5\ \mathrm{V}\)</span>, and <span class="math inline">\(0\ \mathrm{V}\)</span>.</p>
<p>For each case, calculate <span class="math inline">\(V_{Tn}\)</span> and the ratio <span class="math inline">\(\frac{g_{mb}}{g_{m}}\)</span>.</p>
<p><strong>SOLUTION</strong></p>
<p>Evaluating Eqs. (4.2) and (4.6) for <span class="math inline">\(V_{SB} = 2.5\ \mathrm{V}\)</span>, we have</p>
<p><span class="math display">\[
V_{Tn} = V_{TOn} + \gamma_n \left( \sqrt{2\phi_f + V_{SB}} - \sqrt{2\phi_f} \right)
\]</span></p>
<p><span class="math display">\[
= 0.5\ \mathrm{V} + 0.6\ \mathrm{V^{1/2}} \left( \sqrt{0.8\ \mathrm{V} + 2.5\ \mathrm{V}} - \sqrt{0.8\ \mathrm{V}} \right)
= 1.05\ \mathrm{V}
\]</span></p>
<p><span class="math display">\[
\frac{g_{mb}}{g_m} =
\frac{\gamma_n}{2\sqrt{2\phi_f + V_{SB}}}
= \frac{0.6\ \mathrm{V^{1/2}}}{2\sqrt{0.8\ \mathrm{V} + 2.5\ \mathrm{V}}}
= 0.165
\]</span></p>
<p>After evaluating the same expressions for the remaining two cases, we can summarize the obtained results as shown in the table below.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">\(V_{SB}\)</span> [V]</th>
<th><span class="math inline">\(V_{Tn}\)</span> [V]</th>
<th><span class="math inline">\(g_{mb} / g_m\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2.5</td>
<td>1.05</td>
<td>0.165</td>
</tr>
<tr class="even">
<td>1.5</td>
<td>0.87</td>
<td>0.198</td>
</tr>
<tr class="odd">
<td>0</td>
<td>0.50</td>
<td>0.335</td>
</tr>
</tbody>
</table>
<p>From these values, we see that the threshold voltage of an n-channel MOSFET in our technology shifts up by about <span class="math inline">\(0.5 V\)</span> as the source-bulk bias voltage approaches <span class="math inline">\(2.5 V\)</span> (half of the supply voltage assumed in this module). The backgate transconductance ranges approximately between 15% and 30% of gm over the same backgate bias range. Note that the backgate transconductance reduces for larger <span class="math inline">\(V_{SB}\)</span>. This makes intuitive sense, since the depletion region widens for larger reverse bias. Qualitatively speaking, this increases the distance from the bulk electrode to the inversion layer, weakening the effect of backgate voltage changes on the incremental drain current.</p>
<p><a href="#tbl-4.1">Table 4-1</a> summarizes the MOSFET modeling parameters for our standard technology with backgate effect parameters included. This table represents the complete set of parameters used in this module; no further extensions will be needed.</p>
<div class="table striped hover">
<div id="tbl-4.1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-4.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.1: Standard technology parameters for the λ-model, with intrinsic and extrinsic capacitance parameters, as well as backgate effect parameters included.
</figcaption>
<div aria-describedby="tbl-4.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 32%">
<col style="width: 32%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter</strong></th>
<th style="text-align: center;"><strong>n-channel MOSFET</strong></th>
<th style="text-align: center;"><strong>p-channel MOSFET</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Threshold voltage</td>
<td style="text-align: center;"><span class="math inline">\(V_{Tn}\)</span> = 0.5V</td>
<td style="text-align: center;"><span class="math inline">\(V_{Tp}\)</span> = -0.5V</td>
</tr>
<tr class="even">
<td>Transconductance parameter</td>
<td style="text-align: center;"><span class="math inline">\(μ_nC_{ox}= 50μA/V^2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(μ_pC_{ox}= 25μA/V^2\)</span></td>
</tr>
<tr class="odd">
<td>Chanel length modulation parameter</td>
<td style="text-align: center;"><p><span class="math inline">\(\lambda_n =0.1V^{-1}/L\)</span></p>
<p>(<span class="math inline">\(L\)</span> in <span class="math inline">\(\mu m\)</span>)</p></td>
<td style="text-align: center;"><p><span class="math inline">\(\lambda_p =0.1V^{-1}/L\)</span></p>
<p>(<span class="math inline">\(L\)</span> in <span class="math inline">\(\mu m\)</span>)</p></td>
</tr>
<tr class="even">
<td>Gate oxide capacitance per unit area</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(C_{ox} = 2.3fF/\mu m^2\)</span></td>
</tr>
<tr class="odd">
<td>Overlap Capacitance</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(C_{ov} = 0.5fF/\mu m\)</span></td>
</tr>
<tr class="even">
<td>Zero-bias planar bulk depletion capacitance</td>
<td style="text-align: center;"><span class="math inline">\(C_{Jn} = 0.1fF/\mu m^2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(C_{Jp} = 0.3fF/\mu m^2\)</span></td>
</tr>
<tr class="odd">
<td>Zero-bias sidewall bulk depletion capacitance</td>
<td style="text-align: center;"><span class="math inline">\(C_{JSWn}=0.5fF/\mu m\)</span></td>
<td style="text-align: center;"><span class="math inline">\(C_{JSWp}=0.35fF/\mu m\)</span></td>
</tr>
<tr class="even">
<td>Bulk junction potential</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(PB = 0.95\)</span> <span class="math inline">\(V\)</span></td>
</tr>
<tr class="odd">
<td>Planar bulk junction grading coefficient</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(MJ = 0.5\)</span></td>
</tr>
<tr class="even">
<td>Sidewall bulk junction grading coefficient</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(MJSW = 0.33\)</span></td>
</tr>
<tr class="odd">
<td>Length of source and drain diffusions</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(L_{diff} = 3\mu m\)</span></td>
</tr>
<tr class="even">
<td>Backgate effect parameter</td>
<td style="text-align: center;"><span class="math inline">\(\gamma_n\)</span> = <span class="math inline">\(0.6^{\frac{1}{2}}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\gamma_n\)</span> = <span class="math inline">\(0.6^{\frac{1}{2}}\)</span></td>
</tr>
<tr class="odd">
<td>Surface potential parameter</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(\phi_f = 0.4V\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</section>
</section>
<section id="analysis-of-the-common-gate-stage" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="analysis-of-the-common-gate-stage"><span class="header-section-number">4.3</span> Analysis of the Common-Gate Stage</h2>
<p>Using the additional modeling insight obtained in the previous section, we are now ready to analyze the CG circuit in detail. For the derivations in this section, we will assume the circuit topology shown in <a href="#fig-4.1" class="quarto-xref">Figure&nbsp;<span>4.1</span></a>. In this example configuration, the MOSFET’s quiescent point drain current (and <span class="math inline">\(V_{GS}\)</span>) is established using the input bias current source <span class="math inline">\(I_B\)</span>. The auxiliary bias voltage source <span class="math inline">\(V_B\)</span> is used to define the operating point node voltages at the gate and source of the transistor. The resistor <span class="math inline">\(R_D\)</span> sources the bias current and sets the quiescent point voltage at the output node. One minor additional point to note is that the circuit is drawn different from <a href="#fig-4.1" class="quarto-xref">Figure&nbsp;<span>4.1</span></a>(b) such that the drain node lies above the source. This is the preferred way to draw this circuit for large-signal analysis, since one can better visualize the DC bias point levels. The drain lies at a higher DC potential than the source.</p>
<div id="fig-4.7" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.7.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.9: Practical realization of a CG transresistance amplifier with biasing circuitry included.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp; Since there are many different ways to configure the source, bias, and load network of the stage, we distinguish the circuitry outside the dashed line from the core of the stage, which is essentially just the MOSFET with its ac-grounded gate. This distinction makes the results derived below more modular and generally applicable. For instance, when we derive expressions for small-signal port resistances, we distinguish between the core components (<span class="math inline">\(R_{in}\)</span> and <span class="math inline">\(R_{out}\)</span> shown in <a href="#fig-4.7" class="quarto-xref">Figure&nbsp;<span>4.9</span></a>) and any resistances in the source, bias, and load network that appear in parallel. Also, depending on how the CG circuit is used, the output variable of interest may be either the voltage at the output or the current that flows into the output network. For the discussion in this chapter, we assume that the intended output is the voltage <span class="math inline">\(v_{OUT}\)</span> as indicated in <a href="#fig-4.7" class="quarto-xref">Figure&nbsp;<span>4.9</span></a>. With this choice, the (low-frequency) gain of the circuit <span class="math inline">\(v_{out}/i_s\)</span> is a transresistance.</p>
<p>&nbsp;&nbsp;&nbsp; The detailed analysis below consists of several parts. First, we will establish basic expressions for the circuit’s operating point and derive the conditions for MOSFET operation in the saturation region. Next, we will analyze the CG circuit core in terms of its port resistances, which will show that it is most appropriately modeled as a current amplifier. Finally, the obtained results are extended to include high-frequency effects due to capacitive elements.</p>
<section id="bias-point-analysis" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="bias-point-analysis"><span class="header-section-number">4.3.1</span> Bias Point Analysis</h3>
<p>To determine the amplifier’s node voltages at the operating point, we consider the circuit with the small-signal source <span class="math inline">\(i_s\)</span> and its (small-signal) source resistance <span class="math inline">\(r_s\)</span> removed (see <a href="#fig-4.8" class="quarto-xref">Figure&nbsp;<span>4.10</span></a>). From this circuit we see that <span class="math inline">\(I_D\)</span> = <span class="math inline">\(I_B\)</span>, and thus</p>
<p><span id="eq-4.7"><span class="math display">\[
V_{OUT} = V_{DD} - I_B R_D
\tag{4.7}\]</span></span></p>
<p>A more complex analysis is needed to find the voltage at the source node, <span class="math inline">\(V_S\)</span>.<br>
We begin by recognizing that</p>
<p><span id="eq-4.8"><span class="math display">\[
V_S = V_B - V_{GS}
\tag{4.8}\]</span></span></p>
<p>Assuming that the MOSFET operates in the saturation region (which is subject to verification), we know that</p>
<p><span id="eq-4.9"><span class="math display">\[
I_D = I_B = \frac{1}{2} \mu_n C_{ox} \frac{W}{L} (V_{GS} - V_{Tn})^2 (1 + \lambda_n V_{DS})
\tag{4.9}\]</span></span></p>
<p>where</p>
<p><span id="eq-4.10"><span class="math display">\[
V_{Tn} = V_{TOn} + \gamma_n \left( \sqrt{2\phi_f + V_{SB}} - \sqrt{2\phi_f} \right)
\tag{4.10}\]</span></span></p>
<p>and <span class="math inline">\(V_{SB} = V_S\)</span>. Neglecting channel length modulation (i.e., assuming <span class="math inline">\(\lambda_n V_{DS} ≅ 0\)</span>), we can solve <a href="#eq-4.9" class="quarto-xref">Equation&nbsp;<span>4.9</span></a> for <span class="math inline">\(V_{GS}\)</span>:</p>
<p><span id="eq-4.11"><span class="math display">\[
V_{GS} = V_{Tn} + \sqrt{\frac{I_B}{\frac{1}{2} \mu_n C_{ox} \frac{W}{L}}}
= V_{Tn} + V_{OV}
\tag{4.11}\]</span></span></p>
<p>Substituting back into <a href="#eq-4.8" class="quarto-xref">Equation&nbsp;<span>4.8</span></a>, we have</p>
<p><span id="eq-4.12"><span class="math display">\[
V_S = V_B - V_{Tn}(V_S) - \sqrt{\frac{I_B}{\frac{1}{2} \mu_n C_{ox} \frac{W}{L}}}
\tag{4.12}\]</span></span></p>
<div id="fig-4.8" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.8.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.10: Simplified schematic of the CG amplifier for bias point calculations.
</figcaption>
</figure>
</div>
<p>Unfortunately this is a transcendental equation and obtaining a precise solution will require numerical iterations (using <a href="#eq-4.10" class="quarto-xref">Equation&nbsp;<span>4.10</span></a> with <span class="math inline">\(V_{SB}\)</span> = <span class="math inline">\(V_S\)</span>). However, since the dependence of <span class="math inline">\(V_{Tn}\)</span> on <span class="math inline">\(V_S\)</span> is relatively weak, a calculation with one or two iterations tends to give a satisfactory answer for the purpose of hand analysis. This is illustrated in <a href="#example-4-3">Example 4.3</a> below. Once <span class="math inline">\(V_S\)</span> is computed, we can ensure that the MOSFET operates in saturation by checking the following inequality:</p>
<p><span id="eq-4.13"><span class="math display">\[
V_{DS} = V_{OUT} - V_{S} &gt; V_{DSsat} = V_{GS} - V_{Tn}
\tag{4.13}\]</span></span></p>
<p><strong><span id="example-4-3">Example 4-3</span>: Well Bias Point Calculation for a Common Gate Stage</strong></p>
<p>Consider the common-gate circuit shown in <a href="#fig-4.8" class="quarto-xref">Figure&nbsp;<span>4.10</span></a> with the following parameters: <span class="math inline">\(V_{DD} = 5\ \mathrm{V}\)</span>, <span class="math inline">\(V_{B} = 2.5\ \mathrm{V}\)</span>, <span class="math inline">\(I_{B} = 400\ \mu\mathrm{A}\)</span>, <span class="math inline">\(R_{D} = 3\ \mathrm{k\Omega}\)</span>.</p>
<p>For the MOSFET, assume <span class="math inline">\(W = 100\ \mu\mathrm{m}\)</span>, <span class="math inline">\(L = 1\ \mu\mathrm{m}\)</span>, and the standard technology parameters given in <a href="#tbl-4.1">Table 4-1</a>.</p>
<p>Compute <span class="math inline">\(V_{OUT}\)</span>, <span class="math inline">\(V_S\)</span>, as well as <span class="math inline">\(V_{DS}\)</span> and <span class="math inline">\(V_{OV} = V_{GS} - V_{Tn}\)</span> of the transistor.</p>
<p><strong>SOLUTION</strong></p>
<p>Using <a href="#eq-4.7" class="quarto-xref">Equation&nbsp;<span>4.7</span></a> we can directly compute</p>
<p><span class="math display">\[
V_{OUT} = V_{DD} - I_B R_D = 5\ \mathrm{V} - 1.2\ \mathrm{V} = 3.8\ \mathrm{V}
\]</span></p>
<p>Next, we find</p>
<p><span class="math display">\[
V_{GS} - V_{Tn} = \sqrt{\frac{I_B}{\frac{1}{2} \mu_n C_{ox} \frac{W}{L}}} = 0.4\ \mathrm{V}
\]</span></p>
<p>In order to determine <span class="math inline">\(V_S\)</span>, we begin by first ignoring the backgate effect, i.e., the evaluation of <a href="#eq-4.12" class="quarto-xref">Equation&nbsp;<span>4.12</span></a> using the given numbers</p>
<p><span class="math display">\[
g_{mb} =
\left.\frac{\partial i_D}{\partial v_{SB}}\right|_{Q}
= \left.\frac{\partial i_D}{\partial (V_{GS} - V_{Tn})}\right|_{Q}
\left.\frac{\partial (V_{GS} - V_{Tn})}{\partial V_{Tn}}\right|_{Q}
\left.\frac{\partial V_{Tn}}{\partial v_{BS}}\right|_{Q}
\]</span></p>
<p>Using this estimate of <span class="math inline">\(V_S\)</span>, we can now compute an estimate of the actual threshold voltage with backgate effect included.<br>
By evaluatin <a href="#eq-4.10" class="quarto-xref">Equation&nbsp;<span>4.10</span></a>, we find</p>
<p><span class="math display">\[
V_{Tn} = \left( 0.5\ \mathrm{V} + 0.6\ \mathrm{V}^{1/2}
\left( \sqrt{0.8\ \mathrm{V} + 1.6\ \mathrm{V}} - \sqrt{0.8\ \mathrm{V}} \right) \right)
= 0.893\ \mathrm{V}
\]</span></p>
<p>and thus</p>
<p><span class="math display">\[
V_S = 2.5\ \mathrm{V} - 0.893\ \mathrm{V} - 0.4\ \mathrm{V}
= 1.207\ \mathrm{V}
\]</span></p>
<p>This result for <span class="math inline">\(V_S\)</span>, which was obtained using only one iteration, differs from the exact solution <span class="math inline">\(V_S = 1.273\ \mathrm{V}\)</span> (obtained through computer simulations or further iterations) by only <span class="math inline">\(-67\ \mathrm{mV}\)</span> (<span class="math inline">\(-5.2\%\)</span>).</p>
<p>With the above numbers, we have <span class="math display">\[
V_{DS} = V_{OUT} - V_{S} = 3.8\ \mathrm{V} - 1.207\ \mathrm{V}
= 2.59\ \mathrm{V} &gt; V_{GS} - V_{Tn} = 0.4\ \mathrm{V}
\]</span></p>
<p>Therefore, the transistor indeed operates in the saturation region, as assumed initially.</p>
</section>
<section id="first-pass-low-frequency-analysis" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="first-pass-low-frequency-analysis"><span class="header-section-number">4.3.2</span> First Pass Low-Frequency Analysis</h3>
<p>In order to establish symbolic expressions for the stage’s small-signal transfer characteristics, we will first ignore capacitive elements and focus on the low-frequency behavior. Based on the circuit of <a href="#fig-4.7" class="quarto-xref">Figure&nbsp;<span>4.9</span></a>, we can thus construct the low-frequency small-signal model shown in <a href="#fig-4.9" class="quarto-xref">Figure&nbsp;<span>4.11</span></a>. Note here that, as already explained in <a href="partI.2.html">Chapter 2</a>, the DC bias current source was removed, and the DC voltage sources were replaced by a connection to ground.</p>
<div id="fig-4.9" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.9.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.11: Low-frequency small-signal model of the CG stage.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;In principle, we could use the circuit of <a href="#fig-4.9" class="quarto-xref">Figure&nbsp;<span>4.11</span></a> directly to carry out a detailed analysis. However, it is beneficial to first walk through a few circuit simplifications that reduce the algebraic effort and also provide qualitative insight. First, note that since the gate and the bulk of the MOSFET are small-signal grounds, it follows that <span class="math inline">\(v_{gs} = -v_s\)</span> and <span class="math inline">\(v_{bs} = -v_s\)</span>. Thus, the current generators <span class="math inline">\(g_m\)</span> and <span class="math inline">\(g_{mb}\)</span> effectively add, since they are controlled by the same voltage (<span class="math inline">\(-v_s\)</span>). For notational convenience, we therefore define</p>
<p><span class="math display">\[
g' = g_m + g_{mb}.
\]</span></p>
<p>The resulting circuit is shown in <a href="#fig-4.10" class="quarto-xref">Figure&nbsp;<span>4.12</span></a>(a) (with the controlled source rotated for convenience).</p>
<p>&nbsp;&nbsp;&nbsp;As a next step, we split the controlled current source into two elements as depicted in <a href="#fig-4.10" class="quarto-xref">Figure&nbsp;<span>4.12</span></a>(b). Since this change does not alter the summation of currents at the two nodes, the obtained circuit is equivalent to that of <a href="#fig-4.10" class="quarto-xref">Figure&nbsp;<span>4.12</span></a>(a). Next, we recognize that the controlled source on the left side is simply a resistor with value <span class="math inline">\(\frac{1}{g'_m}\)</span>. This is true because for this element we have</p>
<p><span class="math display">\[
i = g'_m\, v \quad \Longrightarrow \quad R = \frac{v}{i} = \frac{1}{g'_m}.
\]</span></p>
<div id="fig-4.10" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.10.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.12: Modified representations of the CG small-signal circuit model. (a) Circuit with combined <span class="math inline">\(g_m\)</span> and <span class="math inline">\(g_{mb}\)</span> generators. (b) Split of controlled current source. (c) Representation of left side current generator using a resistor. (d) Approximate circuit model neglecting <span class="math inline">\(r_o\)</span>.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;In the resulting circuit of@fig-4.10(c), let us assume for the time being that the resistance ro has negligible impact on the operation of the CG amplifier. In this case, shown in <a href="#fig-4.10" class="quarto-xref">Figure&nbsp;<span>4.12</span></a>(d), the core of the CG stage perfectly conforms with the unilateral current amplifier two-port model discussed in <a href="partI.1.html#two-port-abstraction-for-amplifiers">Section 1-3</a>. Specifically, note that the circuit has low input resistance (for example, if <span class="math inline">\(g'm = 10mS =&gt; \frac{1}{g'm} = 100 \ohm\)</span>) and high output resistance (<span class="math inline">\(R_{out}\)</span> → <span class="math inline">\(\infty\)</span>), as desired for a current amplifier. The current gain (<span class="math inline">\(A_i\)</span>) of the two-port is equal to one; any current that enters the core part of the CG stage passes through it unchanged. This result makes intuitive sense also from the original circuit in <a href="#fig-4.7" class="quarto-xref">Figure&nbsp;<span>4.9</span></a>. Any change in the MOSFET’s source current must also appear at the drain side.</p>
<p>&nbsp;&nbsp;&nbsp;A secondary conclusion to draw from this first-pass analysis concerns the backgate connection of the transistor. If the bulk terminal were not connected to ground, but instead tied to the source of the transistor (which is possible for the p-channel version of the circuit in our n-well technology), we would have <span class="math inline">\(v_{bs} = 0\)</span>, and the <span class="math inline">\(g'm\)</span> term would reduce to <span class="math inline">\(g_m\)</span>. This is undesired since the amplifier’s input resistance will increase correspondingly (on the order of 15–35%, see <a href="#example-4-2">Example 4-2</a>). Thus, in a CG amplifier, it is typically advantageous to leave the bulk node ac-grounded, rather than tying it to the source. Note that this also reduces the parasitic capacitance at the source, as discussed in <a href="#well-capacitance">Section 4-2-1</a>.</p>
</section>
<section id="detailed-low-frequency-analysis" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="detailed-low-frequency-analysis"><span class="header-section-number">4.3.3</span> Detailed Low-Frequency Analysis</h3>
<p>We will now carry out a more detailed analysis that refines the result obtained in the previous subsection. Specifically, we wish to perform a full analysis with the MOSFET’s ro included to see if, and precisely when, this resistor can be neglected.</p>
<p>&nbsp;&nbsp;&nbsp;We begin by computing the input resistance (<span class="math inline">\(R_{in}\)</span>) of the CG circuit core using the full circuit from <a href="#fig-4.10" class="quarto-xref">Figure&nbsp;<span>4.12</span></a>(c), redrawn in <a href="#fig-4.11" class="quarto-xref">Figure&nbsp;<span>4.13</span></a>(a) with a test voltage source included. From this setup, the input resistance is found using the procedure described in <a href="partI.1.html#consturction-of-unilateral-two-port-models">Section 1-3-3</a>. Specifically, note that <span class="math inline">\(R_D\)</span> is included in the analysis since the circuit is bilateral.</p>
<div id="fig-4.11" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.11.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.13: Small-signal model used to calculate (a) the input resistance (<span class="math inline">\(R_{in}\)</span>), and (b) the output resistance (<span class="math inline">\(R_{out}\)</span>) of the intrinsic CG circuit.
</figcaption>
</figure>
</div>
<p>Now, writing KVL at the input and output nodes gives</p>
<p><span id="eq-4.14"><span class="math display">\[
i_t = g'_m v_t + \frac{v_t - v_{out}}{r_o}
\tag{4.14}\]</span></span></p>
<p><span id="eq-4.15"><span class="math display">\[
0 = -g'_m v_t - \frac{v_t - v_{out}}{r_o} + \frac{v_{out}}{R_D}
\tag{4.15}\]</span></span></p>
<p>By solving this system of equations for <span class="math inline">\(v_t\)</span> and <span class="math inline">\(i_t\)</span>, we obtain</p>
<p><span id="eq-4.16"><span class="math display">\[
R_{in} = \frac{v_t}{i_t} =
\frac{1 + \frac{R_D}{r_o}}{g'_m + \frac{1}{r_o}}
\tag{4.16}\]</span></span></p>
<p>Assuming <span class="math inline">\(r_o \gg R_D\)</span> and <span class="math inline">\(r_o \gg 1/g'_m\)</span>, the input resistance becomes approximately</p>
<p><span id="eq-4.17"><span class="math display">\[
R_{in} ≅ \frac{1}{g'_m}
\tag{4.17}\]</span></span></p>
<p>which is identical to the value postulated in the approximate model of the previous subsection. The approximation applied to the denominator of <a href="#eq-4.16" class="quarto-xref">Equation&nbsp;<span>4.16</span></a> is always valid, since <span class="math inline">\(g'_m r_o \gg 1\)</span> for a typical MOSFET. The approximation made in the numerator may not hold when the drain is terminated with a very large incremental resistance, as, for instance, found in a current source. In this case, care must be taken to use the exact numerator of <a href="#eq-4.16" class="quarto-xref">Equation&nbsp;<span>4.16</span></a>.</p>
<p>&nbsp;&nbsp;&nbsp;Next, to calculate the output resistance (<span class="math inline">\(R_{out}\)</span>), we set the small-signal input current source is equal to zero (open circuit) but leave the effect of its source resistance (<span class="math inline">\(r_s\)</span>) in place as shown in <a href="#fig-4.11" class="quarto-xref">Figure&nbsp;<span>4.13</span></a>(b). As before, we place a test voltage source at the port of interest, and write KCL for the two nodes of the circuit.</p>
<p><span id="eq-4.18"><span class="math display">\[
0 = g'_m v_s + \frac{v_s - v_{out}}{r_o} + \frac{v_s}{r_s}
\tag{4.18}\]</span></span></p>
<p><span id="eq-4.19"><span class="math display">\[
i_t = -g'_m v_s - \frac{v_s - v_{out}}{r_o}
\tag{4.19}\]</span></span></p>
<p>After solving for <span class="math inline">\(v_t\)</span> and <span class="math inline">\(i_t\)</span>, we obtain</p>
<p><span id="eq-4.20"><span class="math display">\[
R_{out} = \frac{v_t}{i_t} = r_o + r_s \left[ 1 + g'_m r_o \right]
\tag{4.20}\]</span></span></p>
<p>Utilizing the fact that <span class="math inline">\(g'_m r_o \gg 1\)</span>, we can approximate</p>
<p><span id="eq-4.21"><span class="math display">\[
R_{out} ≅ r_o \left[ 1 + g'_m r_s \right]
\tag{4.21}\]</span></span></p>
<p>Under the condition that <span class="math inline">\(g'_m r_s \gg 1\)</span>, the expression further simplifies to</p>
<p><span id="eq-4.22"><span class="math display">\[
R_{out} ≅ g'_m r_o r_s
\tag{4.22}\]</span></span></p>
<p>From this result, we note that the source resistance <span class="math inline">\(r_s\)</span> is multiplied by a term that is on the order of the intrinsic voltage gain of the transistor (<span class="math inline">\(g_mr_o\)</span>), which is typically greater than 100 in our technology (see <a href="partI.2.html#common-source-voltage-amplifier-analysis-using-the-lambda-model">Section 2-3-2</a>). Thus, a CG stage can essentially be used to turn a current source with moderate source resistance (<span class="math inline">\(r_s\)</span>) into a “better” current source with very high source resistance. This feature is widely used in a variety of circuit configurations, some of which will be discussed later in this module.</p>
<p>&nbsp;&nbsp;&nbsp;Using the above results, we can now construct a complete circuit model that includes the CG core as a unilateral current amplifier two-port (see <a href="#fig-4.12" class="quarto-xref">Figure&nbsp;<span>4.14</span></a>). Using this model, the transresistance gain from the input current source (<span class="math inline">\(i_s\)</span>) to the circuit’s output voltage (<span class="math inline">\(v_{out}\)</span>) can be written as</p>
<p><span id="eq-4.23"><span class="math display">\[
\frac{v_{out}}{i_s} =
\frac{i_{in}}{i_s} \cdot \frac{v_{out}}{i_{in}} =
\frac{r_s}{r_s + R_{in}} \cdot
\left( \frac{1}{R_D} + \frac{1}{R_{out}} \right)^{-1}
\tag{4.23}\]</span></span></p>
<p>where the first term represents the current divider formed by <span class="math inline">\(r_s\)</span> and <span class="math inline">\(R_{in}\)</span> and the second term is the parallel combination of <span class="math inline">\(R_D\)</span> and <span class="math inline">\(R_{out}\)</span>.<br>
For a typical application of this circuit, where <span class="math inline">\(R_{in} \ll r_s\)</span> and <span class="math inline">\(R_D \ll R_{out}\)</span>, <a href="#eq-4.23" class="quarto-xref">Equation&nbsp;<span>4.23</span></a> simplifies to</p>
<p><span id="eq-4.24"><span class="math display">\[
\frac{v_{out}}{i_s} \equiv R_D
\tag{4.24}\]</span></span></p>
<p>In words, the transresistance of the circuit is approximately equal to the drain resistance. This makes intuitive sense since the CG core acts a current amplifier with a gain near unity. That is, the CG stage absorbs all (or most) of the current from the input source, and it passes this current to the termination resistance (<span class="math inline">\(R_D\)</span>), causing a proportional change in the output voltage.</p>
<div id="fig-4.12" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.12.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.14: Small-signal unilateral two-port model of the CG stage.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;When employing the model of <a href="#fig-4.12" class="quarto-xref">Figure&nbsp;<span>4.14</span></a>, it is important to remember that we are approximating a bilateral circuit using a unilateral model. We have investigated the resulting error for this particular configuration in <a href="#example-1-3">Example 1-3</a> and found that the unilateral model is guaranteed to be accurate as long as the coupling resistance between the input and output ports (<span class="math inline">\(R_2\)</span> in <a href="#example-1-3">Example 1-3</a> and <span class="math inline">\(r_o\)</span> in the analyzed CG circuit) is larger than the termination resistance (<span class="math inline">\(R_L\)</span> in <a href="#example-1-3">Example 1-3</a> and <span class="math inline">\(R_D\)</span> in the analyzed CG circuit). Thus, the result stated in <a href="#eq-4.23" class="quarto-xref">Equation&nbsp;<span>4.23</span></a> holds with good accuracy as long as <span class="math inline">\(R_D \ll r_o\)</span>, a condition that is satisfied in many relevant applications.</p>
</section>
<section id="high-frquency-analysis" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="high-frquency-analysis"><span class="header-section-number">4.3.4</span> High-Frequency Analysis</h3>
<p>In order to model the frequency response of the CG amplifier, we now include the capacitances of the MOSFET into the small-signal model constructed in the previous section (see <a href="#fig-4.13" class="quarto-xref">Figure&nbsp;<span>4.15</span></a>).</p>
<p>&nbsp;&nbsp;&nbsp;Since both the gate and bulk of the MOSFET are AC-grounded, <span class="math inline">\(C_{gs}\)</span> and C_{sb}$, as well as <span class="math inline">\(C_{gd}\)</span> and <span class="math inline">\(C_{db}\)</span> appear from source and drain, respectively, to ground. For notational convenience, we abbreviate <span class="math inline">\(C_{gs} + C_{sb} = C_s\)</span> and <span class="math inline">\(C_{gd} + C_{db} = C_d\)</span> in the following treatment.</p>
<div id="fig-4.13" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.13-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.13.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.13-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.15: High-frequency small-signal model of the CG stage.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;One way to analyze the circuit of <a href="#fig-4.13" class="quarto-xref">Figure&nbsp;<span>4.15</span></a> is to reuse the results obtained in the low-frequency analysis, but now with <span class="math inline">\(C_s\)</span> and <span class="math inline">\(C_d\)</span> added in parallel to <span class="math inline">\(r_s\)</span> and <span class="math inline">\(R_D\)</span>, respectively. In this spirit, we begin by considering the effect of the added capacitances on the circuit’s input impedance, <span class="math inline">\(Z_{in}\)</span>. Reusing the result from <a href="#eq-4.16" class="quarto-xref">Equation&nbsp;<span>4.16</span></a>, we can write</p>
<p><span id="eq-4.25"><span class="math display">\[
Z_{in} ≅
\frac{1 + \frac{R_D \parallel \frac{1}{s C_d}}{r_o}}{g'_m}
\ \Big\| \ \frac{1}{s C_s}
\tag{4.25}\]</span></span></p>
<p>As long as <span class="math inline">\(R_D \ll r_o\)</span>, regardless of the added term due to <span class="math inline">\(C_d\)</span>, the numerator can be approximated as unity. Therefore, it follows that</p>
<p><span id="eq-4.26"><span class="math display">\[
Z_{in} ≅ \frac{1}{g'_m} \ \Big\| \ \frac{1}{s C_s}
\tag{4.26}\]</span></span></p>
<p>In other words, this result simply says that <span class="math inline">\(Z_{in}\)</span> is typically well approximated by the parallel impedance connection of <span class="math inline">\(1 / g'_m\)</span> and <span class="math inline">\(C_s\)</span>.</p>
<p>&nbsp;&nbsp;&nbsp;Finding the (exact) output impedance (<span class="math inline">\(Z_{out}\)</span>) proves algebraically more difficult. However, provided that <span class="math inline">\(g'_m r_s \gg 1\)</span> and for frequencies below the MOSFET’s cutoff frequency <span class="math inline">\(\omega_T\)</span>, it follows that (see <a href="#p4.6">Problem P4.6</a>)</p>
<p><span id="eq-4.27"><span class="math display">\[
Z_{out} \equiv g'_m r_o r_s \ \Big\| \ \frac{g'_m r_o}{s C_s} \ \Big\| \ \frac{1}{s C_d}
\tag{4.27}\]</span></span></p>
<p>Thus, <span class="math inline">\(Z_{out}\)</span> consists of the parallel combination of:<br>
(1) <span class="math inline">\(r_s\)</span>, increased by the factor <span class="math inline">\(g'_m r_o\)</span> (this is simply <span class="math inline">\(R_{out}\)</span> from the low-frequency analysis),<br>
(2) the explicit capacitance present at the output (<span class="math inline">\(C_d\)</span>), and<br>
(3) the reactance of the source side capacitance (<span class="math inline">\(C_s\)</span>) increased by the factor <span class="math inline">\(g'_m r_o\)</span>.</p>
<p>From the second term, we see that the MOSFET not only boosts the resistance of <span class="math inline">\(r_s\)</span> seen from the output, but also the reactance of <span class="math inline">\(C_s\)</span>. Since usually <span class="math inline">\(C_s / g'_m r_o \ll C_d\)</span>, we can safely neglect the second term of@eq-4.27 and conclude</p>
<p><span id="eq-4.28"><span class="math display">\[
Z_{out} \equiv g'_m r_o r_s \ \Big\| \ \frac{1}{s C_d}
\tag{4.28}\]</span></span></p>
<p>&nbsp;&nbsp;&nbsp;In summary, the overall conclusion is that, to first order, the drain and source side capacitances can simply be added to the ports of the already obtained low-frequency model of <a href="#fig-4.12" class="quarto-xref">Figure&nbsp;<span>4.14</span></a>. Thus, we have once again arrived at a relatively simple unilateral model for the circuit that holds for high frequencies. The corresponding circuit model is drawn out in <a href="#fig-4.12" class="quarto-xref">Figure&nbsp;<span>4.14</span></a>, incorporating the assumptions <span class="math inline">\(g'_m r_s \gg 1\)</span> and <span class="math inline">\(R_D \ll r_o\)</span>.</p>
<p>Also, for generality, we have included a load capacitor (<span class="math inline">\(C_L\)</span>) and a load resistor. (<span class="math inline">\(R_L\)</span>). Note that whenever <span class="math inline">\(R_L\)</span> carries a DC current, this resistor must also be included in the bias point calculations of the circuit.</p>
<p>&nbsp;&nbsp;&nbsp;Similar to the low-frequency analysis of the previous subsection, the overall transfer function of the circuit in <a href="#fig-4.14" class="quarto-xref">Figure&nbsp;<span>4.16</span></a> is found by considering the current division at the input node, and the parallel impedance at the output node:</p>
<p><span class="math display">\[
\frac{v_{out}}{i_s} =
\frac{i_{in}}{i_s} \cdot \frac{v_{out}}{i_{in}}
\]</span></p>
<p><span class="math display">\[
= \frac{g'_m}{g'_m + s C_s} \cdot
\left( \frac{1}{R_D} + \frac{1}{R_L} + s C_d + s C_L \right)^{-1}
\]</span></p>
<p><span class="math display">\[
= [R_D \parallel R_L] \cdot \frac{1}{1 + s \frac{C_s}{g'_m}} \cdot
\frac{1}{\left( [R_D \parallel R_L][C_d + C_L] \right)}
\]</span></p>
<p><span id="eq-4.29"><span class="math display">\[
= [R_D \parallel R_L] \cdot \frac{1}{1 - \frac{s}{p_1}} \cdot \frac{1}{1 - \frac{s}{p_2}}
\tag{4.29}\]</span></span></p>
<p>In this expression, the leading term <span class="math inline">\([R_D \parallel R_L]\)</span> corresponds to the low-frequency transresistance and <span class="math inline">\(p_1 = -g'_m / C_s\)</span> and <span class="math inline">\(p_2 = -1 / \left[ (R_D \parallel R_L)(C_d + C_L) \right]\)</span><br>
are the poles of the circuit.</p>
<p>The pole <span class="math inline">\(p_1\)</span> is associated with the input of the circuit and captures the frequency dependence of the current transfer from the input current to the drain current of the transistor (<span class="math inline">\(i_x / i_{in}\)</span> in <a href="#fig-4.14" class="quarto-xref">Figure&nbsp;<span>4.16</span></a>). The corresponding pole frequency <span class="math inline">\(g'_m / C_s\)</span> is very close to <span class="math inline">\(\omega_T\)</span> (the cutoff frequency of the transistor) and will rarely limit the bandwidth of the overall circuit. The pole <span class="math inline">\(p_2\)</span> depends on the component values in the load network. If the added <span class="math inline">\(C-L\)</span> is small, this pole will typically also lie at a very high frequency.</p>
<div id="fig-4.14" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.14-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.14.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.14-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.16: Approximate unilateral two-port model of the CG transresistance amplifier for high frequencies..
</figcaption>
</figure>
</div>
<p>From the result of <a href="#eq-4.29" class="quarto-xref">Equation&nbsp;<span>4.29</span></a>, it is important to note that the circuit has two distinct and conveniently isolated poles that are not “entangled,” as for instance in the frequency response of the CS stage [see <a href="partI.3.html#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a>]. This is a direct result of the fact that the input and output networks of the model in <a href="partI.3.html#fig-3.14" class="quarto-xref">Figure&nbsp;<span>3.17</span></a> are decoupled, i.e., the networks that define the time constants on each side of the circuit do not interact. Note also that for approximate 3-dB bandwidth calculations, the method of open-circuit time constants can be applied. This will give the sum of the two time constants that make up the poles contained in <a href="#eq-4.29" class="quarto-xref">Equation&nbsp;<span>4.29</span></a>.</p>
<p><strong><span id="example-4-4">Example 4-4</span>: Bandwidth Calculation for a Common-Gate Stage</strong></p>
<p>Consider the CG circuit of <a href="#fig-4.7" class="quarto-xref">Figure&nbsp;<span>4.9</span></a> using the same parameters used in <a href="#example-4-3">Example 4-3</a>: <span class="math inline">\(I_B = 400\ \mu\mathrm{A}\)</span>, <span class="math inline">\(R_D = 3\ \mathrm
{k\Omega}\)</span>, <span class="math inline">\(W = 100\ \mu\mathrm{m}\)</span>, and <span class="math inline">\(L = 1\ \mu\mathrm{m}\)</span>. Using he bias point information from <a href="#example-4-3">Example 4-3</a>, compute all device capacitances and estimate the bandwidth of the circuit’s transfer function using the method of open-circuit time constants.</p>
<p><strong>SOLUTION</strong></p>
<p>From <a href="#example-4-3">Example 4-3</a>, we know that <span class="math inline">\(V_{OUT} = 3.8\ \mathrm{V}\)</span> and <span class="math inline">\(V_S = 1.273\ \mathrm{V}\)</span>. Using <a href="partI.3.html#eq-3.15" class="quarto-xref">Equation&nbsp;<span>3.15</span></a> and <a href="partI.3.html#eq-3.32" class="quarto-xref">Equation&nbsp;<span>3.32</span></a>-<a href="partI.3.html#eq-3.34" class="quarto-xref">Equation&nbsp;<span>3.34</span></a> we can therefore compute all device capacitances.</p>
<p><span class="math display">\[
C_{gs}
= \frac{2}{3}\,(100 \cdot 1\,\mu\mathrm{m}^2)\!\left(2.3\,\frac{\mathrm{fF}}{\mu\mathrm{m}^2}\right)
+ 100\,\mu\mathrm{m}\!\left(0.5\,\frac{\mathrm{fF}}{\mu\mathrm{m}}\right)
= 203.3\,\mathrm{fF}
\]</span></p>
<p><span class="math display">\[
C_{gd} = 100\,\mu\mathrm{m}\!\left(0.5\,\frac{\mathrm{fF}}{\mu\mathrm{m}}\right) = 50\,\mathrm{fF}
\]</span></p>
<p>Evaluating <a href="partI.3.html#eq-3.34" class="quarto-xref">Equation&nbsp;<span>3.34</span></a>, using the source junction bias voltage of <span class="math inline">\(V_{SB} = 1.273\ \mathrm{V}\)</span> yields</p>
<p><span class="math display">\[
C_{sb} = 19.6\,\mathrm{fF}
\]</span></p>
<p>The drain junction has a reverse bias voltage of <span class="math inline">\(V_{DB} = V_{OUT} = 3.8\ \mathrm{V}\)</span>.<br>
Evaluating Eq. (3.33) with this value and the given parameters gives</p>
<p><span class="math display">\[
C_{db} = 13.4\,\mathrm{fF}
\]</span></p>
<p>The total capacitances for the model in <a href="#fig-4.14" class="quarto-xref">Figure&nbsp;<span>4.16</span></a> are therefore</p>
<p><span class="math display">\[
C_s = C_{gs} + C_{sb} = 223\,\mathrm{fF}
\]</span></p>
<p><span class="math display">\[
C_d = C_{gd} + C_{db} = 63.4\,\mathrm{fF}
\]</span></p>
<p>Now, using <span class="math inline">\(V_{OV} = 0.4\ \mathrm{V}\)</span> from <a href="#example-4-3">Example 4-3</a>, we have</p>
<p><span class="math display">\[
g_m = \frac{2 I_D}{V_{OV}} = 2\,\mathrm{mS}
\]</span></p>
<p>Furthermore, using <a href="#eq-4.6" class="quarto-xref">Equation&nbsp;<span>4.6</span></a></p>
<p><span class="math display">\[
g_{mb} =
\frac{2\,\mathrm{mS}\cdot 0.6\,\mathrm{V}^{1/2}}{2\sqrt{0.8\,\mathrm{V} + 1.273\,\mathrm{V}}}
= 0.417\,\mathrm{mS}
\]</span></p>
<p>and therefore</p>
<p><span class="math display">\[
\frac{1}{g'_m} = \frac{1}{2\,\mathrm{mS} + 0.417\,\mathrm{mS}} = 413.8\,\Omega
\]</span></p>
<p>The time constants of the circuit are</p>
<p><span class="math display">\[
\tau_{so} = 413.8\,\Omega \cdot 257.6\,\mathrm{fF} = 92.25\,\mathrm{ps}
\]</span></p>
<p><span class="math display">\[
\tau_{do} = 3\,\mathrm{k}\Omega \cdot 87.1\,\mathrm{fF} = 190.2\,\mathrm{ps}
\]</span></p>
<p>The bandwidth estimate is therefore</p>
<p><span class="math display">\[
f_{3\mathrm{dB}} = \frac{1}{2\pi}\cdot \frac{1}{107\,\mathrm{ps} + 261\,\mathrm{ps}}
= 563\,\mathrm{MHz}
\]</span></p>
<p>By comparing the two time constants, we see that the bandwidth is limited by the drain network. This situation will be even more pronounced when an external load capacitance <span class="math inline">\(C_L\)</span> is added to the output node.</p>
</section>
</section>
<section id="analysis-of-the-common-drain-stage" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="analysis-of-the-common-drain-stage"><span class="header-section-number">4.4</span> Analysis of the Common-Drain Stage</h2>
<p>A practical configuration of a common-drain (CD) circuit is shown in <a href="#fig-4.15" class="quarto-xref">Figure&nbsp;<span>4.17</span></a>. Similar to the CG stage discussed in the previous section, other configurations for the input and output network exist; we will analyze the given circuit as a representative example.</p>
<div id="fig-4.15" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.15-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.15.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.15-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.17: Practical realization of a CD amplifier with biasing circuitry included.
</figcaption>
</figure>
</div>
<section id="bias-point-analysis" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="bias-point-analysis"><span class="header-section-number">4.4.1</span> Bias Point Analysis</h3>
<p>For a first-pass bias point analysis, consider the circuit in <a href="#fig-4.16" class="quarto-xref">Figure&nbsp;<span>4.18</span></a> first with <span class="math inline">\(R_L\)</span> disconnected, ensuring that the MOSFET drain current <span class="math inline">\(I_D = I_B\)</span>. Since no current flows into the gate of the MOSFET, we have <span class="math inline">\(V_{IN} = V_S\)</span>. The output voltage quiescent point in this circuit can thus be calculated as already analyzed in the context of the CG stage, using <a href="#eq-4.12" class="quarto-xref">Equation&nbsp;<span>4.12</span></a> with <span class="math inline">\(V_{IN}\)</span> and <span class="math inline">\(V_{OUT}\)</span> substituted for <span class="math inline">\(V_B\)</span> and <span class="math inline">\(V_S\)</span>, respectively.</p>
<p><span id="eq-4.30"><span class="math display">\[
V_{OUT} = V_{IN} - V_{Tn}(V_{OUT}) -
\sqrt{\frac{I_B}{\frac{1}{2} \mu_n C_{ox} \frac{W}{L}}}
\tag{4.30}\]</span></span></p>
<p>If <span class="math inline">\(V_B\)</span> at the bottom of <span class="math inline">\(R_L\)</span> is chosen equal to <span class="math inline">\(V_{OUT}\)</span> as given in <a href="#eq-4.30" class="quarto-xref">Equation&nbsp;<span>4.30</span></a>, no current will flow in this resistor when reconnected and <span class="math inline">\(I_D = I_B\)</span> is maintained. In cases where this condition is not met, the OSFET’s drain current differs from <span class="math inline">\(I_B\)</span>, but can be computed using iterative calculations. For simplicity in our discussion, we will assume that <span class="math inline">\(V_B\)</span> (or <span class="math inline">\(V_{IN}\)</span>) is properly adjusted such that <span class="math inline">\(I_D = I_B\)</span> is guaranteed.</p>
<div id="fig-4.16" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.16.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.18: Simplified schematic of the CD amplifier for bias point calculations.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;As far as the MOSFET’s operating region is concerned, it is interesting to note that the device will essentially always operate in the saturation region. This is the case since</p>
<p><span id="eq-4.31"><span class="math display">\[
V_{DS} = V_{DD} - V_{OUT}
= V_{DD} - (V_{IN} - V_{GS})
\tag{4.31}\]</span></span></p>
<p>and thus</p>
<p><span id="eq-4.32"><span class="math display">\[
V_{DS} - (V_{GS} - V_{Tn}(V_{OUT})) =
V_{DD} - (V_{IN} - V_{Tn}(V_{OUT}))
\tag{4.32}\]</span></span></p>
<p>is greater than zero as long as <span class="math inline">\(V_{IN} &lt; V_{DD} + V_{Tn}(V_{OUT})\)</span>, which is almost always the case in a practical realization.</p>
</section>
<section id="low-frequency-analysis" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="low-frequency-analysis"><span class="header-section-number">4.4.2</span> Low-Frequency Analysis</h3>
<p>To analyze the circuit’s transfer characteristics at low frequencies, we draw its small-signal model (without any capacitances) as shown in <a href="#fig-4.17.1" class="quarto-xref">Figure&nbsp;<span>4.19</span></a>(a). While this circuit can be analyzed directly by writing nodal equations, it is worth considering a few basic equivalent transformations. First, note that we can split the source controlled by <span class="math inline">\(v_{gs}\)</span> into two components, <span class="math inline">\(g_m v_g\)</span> and <span class="math inline">\(-g_m v_s\)</span>, where <span class="math inline">\(v_g = v_{in}\)</span> and <span class="math inline">\(v_s = v_{out}\)</span> [see <a href="#fig-4.17.1" class="quarto-xref">Figure&nbsp;<span>4.19</span></a>]. Similarly, the backgate generator is split into <span class="math inline">\(g_{mb} v_b\)</span> and <span class="math inline">\(-g_{mb} v_s\)</span>, where <span class="math inline">\(v_b = 0\)</span> (which means that this source can be discarded) and <span class="math inline">\(v_s = v_{out}\)</span>.</p>
<div id="fig-4.17.1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.17.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.17.1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.17.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.19: (a) CD small-signal, low-frequency circuit model. (b) Split of controlled current source.
</figcaption>
</figure>
</div>
<p>Finally, recognizing that the two sources controlled by <span class="math inline">\(v_{out}\)</span> are simply resistors of value <span class="math inline">\(1/g_m\)</span> and <span class="math inline">\(1/g_{mb}\)</span>, we arrive at the final circuit in <a href="#fig-4.17.2" class="quarto-xref">Figure&nbsp;<span>4.20</span></a>.</p>
<div id="fig-4.17.2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.17.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.17.2.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.17.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.20: (c) Representation of output-controlled current generators using a resistor.
</figcaption>
</figure>
</div>
<p>From this simplified representation, we can immediately see</p>
<p><span id="eq-4.33"><span class="math display">\[
R_{in} \to \infty
\tag{4.33}\]</span></span></p>
<p><span id="eq-4.34"><span class="math display">\[
R_{out} = r_o \parallel \frac{1}{g_m} \parallel \frac{1}{g_{mb}}
\equiv \frac{1}{g_m + g_{mb}} = \frac{1}{g'_m}
\tag{4.34}\]</span></span></p>
<p>&nbsp;&nbsp;&nbsp;Consequently, the CD circuit core most closely resembles the properties of a voltage amplifier (high <span class="math inline">\(R_{in}\)</span>, low <span class="math inline">\(R_{out}\)</span>) and is thus most appropriately modeled using the two-port representation shown in Figure <a href="#fig-4.18" class="quarto-xref">Figure&nbsp;<span>4.21</span></a>. The final parameter needed for this model is the open-circuit voltage gain <span class="math inline">\(A_v\)</span>. To find <span class="math inline">\(A_v\)</span>, we apply an ideal test voltage to the circuit of <a href="#fig-4.17.2" class="quarto-xref">Figure&nbsp;<span>4.20</span></a>(c) (i.e., a voltage source with <span class="math inline">\(R_S = 0\)</span>) and measure the voltage at the open-circuited output port (<span class="math inline">\(R_L\)</span> disconnected). Neglecting <span class="math inline">\(r_o\)</span> in this analysis, the reader can prove that</p>
<p><span id="eq-4.35"><span class="math display">\[
A_v = \frac{g_m}{g_m + g_{mb}} = \frac{1}{1 + \frac{g_{mb}}{g_m}} &lt; 1
\tag{4.35}\]</span></span></p>
<p>With <span class="math inline">\(g_{mb}/g_m\)</span> values on the order of 20% (see <a href="#example-4-2">Example 4-2</a>), the open-circuit voltage gain of the analyzed n-channel CD stage is on the order of 0.8.</p>
<div id="fig-4.18" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.18-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.18.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.18-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.21: Unilateral two-port model for the CD stage at low frequencies.
</figcaption>
</figure>
</div>
<p><span class="math inline">\(A_v\)</span> can approach unity when the source is tied to the bulk of the MOSFET. In this case, <span class="math inline">\(v_{bs} = 0\)</span>, and the <span class="math inline">\(1/g_{mb}\)</span> resistor in <a href="#fig-4.17.2" class="quarto-xref">Figure&nbsp;<span>4.20</span></a> is eliminated. Note that for the technology considered in this module, this option is available only for the p-channel version of the circuit. Accordingly, <a href="#fig-4.19" class="quarto-xref">Figure&nbsp;<span>4.22</span></a> summarizes the three different CD configurations that are possible in the assumed technology. In practice, the designer will decide case by case if a source-bulk connection (for the p-channel circuit) is advantageous in the intended application. A disadvantage of the configuration in <a href="#fig-4.19" class="quarto-xref">Figure&nbsp;<span>4.22</span></a>(c) is that the bulk-to-substrate (<span class="math inline">\(C_{bsub}\)</span>) capacitance contributes to the capacitive load of the stage (see <a href="#bulk-connection-scenarios-and-required-model-extensions">Section 4-2</a> and also <a href="#fig-4.22" class="quarto-xref">Figure&nbsp;<span>4.26</span></a>).</p>
<p>Since the CD stage achieves a positive voltage gain near unity, this circuit is often called <strong>source follower</strong>. The output (the source of the transistor) carries a signal that closely follows the applied input voltage.</p>
<div id="fig-4.19" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.19.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.22: Possible configurations for CD amplifiers.
</figcaption>
</figure>
</div>
<p><strong><span id="example-4-5">Example 4-5</span>: Low-Frequency Analysis of a CD Amplifier</strong></p>
<p>Consider the CD stage shown in Figure Ex4-5 with the following parameters:<br>
<span class="math inline">\(V_{DD} = 5 \ \text{V}\)</span>, <span class="math inline">\(V_S = 2.5 \ \text{V}\)</span>, <span class="math inline">\(I_B = 400 \ \mu\text{A}\)</span>, <span class="math inline">\(R_S = 100 \ \text{k}\Omega\)</span> and <span class="math inline">\(R_L = 5 \ \text{k}\Omega\)</span>.<br>
For the MOSFET, assume <span class="math inline">\(W = 100 \ \mu\text{m}\)</span>, <span class="math inline">\(L = 1 \ \mu\text{m}\)</span>, and the standard technology parameters given in <a href="#tbl-4.1">Table 4-1</a>. Assume that <span class="math inline">\(V_B\)</span> is adjusted such that no DC bias current flows in <span class="math inline">\(R_L\)</span>. Calculate <span class="math inline">\(A_v\)</span>, <span class="math inline">\(R_{out}\)</span>, and the overall voltage gain <span class="math inline">\(v_{out} / v_s\)</span>.</p>
<div id="fig-ex-4.5" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ex-4.5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-ex-4.5.png" id="fig-ex-4.5" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ex-4.5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.23
</figcaption>
</figure>
</div>
<p><strong>SOLUTION</strong></p>
<p>Since the transistor is sized and biased exactly as in the CG stage of <a href="#example-4-3">Examples 4-3</a> and <a href="#example-4-4">Examples 4-4</a>, we know that <span class="math inline">\(V_{OUT} = 1.273 \ \text{V}\)</span>, <span class="math inline">\(g_m = 2 \ \text{mS}\)</span>, and <span class="math inline">\(g_{mb} = 0.417 \ \text{mS}\)</span>.<br>
The resulting open-circuit voltage gain is</p>
<p><span class="math display">\[
A_v = \frac{g_m}{g_m + g_{mb}} = 0.828
\]</span></p>
<p>and</p>
<p><span class="math display">\[
R_{out} = \frac{1}{g_m + g_{mb}} = 413.8 \ \Omega
\]</span></p>
<p>The overall voltage gain can be computed using <a href="#fig-4.18" class="quarto-xref">Figure&nbsp;<span>4.21</span></a>:</p>
<p><span class="math display">\[
A_v' = \frac{v_{out}}{v_s} = A_v \frac{R_L}{R_{out} + R_L} = 0.764
\]</span></p>
<p>Based on this result, the reader may wonder why the analyzed circuit is useful, as it provides no voltage gain. The benefit of using the stage becomes apparent by comparing to the case where the stage is omitted and <span class="math inline">\(R_L\)</span> is directly driven by the source. In this case, the voltage gain from <span class="math inline">\(v_s\)</span> to <span class="math inline">\(v_{out}\)</span> is given by the resistive divider between <span class="math inline">\(R_S\)</span> and <span class="math inline">\(R_L\)</span>:</p>
<p><span class="math display">\[
\frac{v_{out}}{v_s} = \frac{R_L}{R_S + R_L} = \frac{5 \ \text{k}\Omega}{100 \ \text{k}\Omega + 5 \ \text{k}\Omega} = 0.048
\]</span></p>
<p>As we see from this calculation, even though the CD stage does not have voltage gain, it allows us to interface a relatively small load resistance to a source with high source resistance.</p>
</section>
<section id="high-frequency-analysis" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3" class="anchored" data-anchor-id="high-frequency-analysis"><span class="header-section-number">4.4.3</span> High-Frequency Analysis</h3>
<p>To predict the high-frequency behavior of the CD stage, we consider the circuit shown in <a href="#fig-4.20" class="quarto-xref">Figure&nbsp;<span>4.24</span></a>. This circuit was constructed using the model of <a href="#fig-4.17.2" class="quarto-xref">Figure&nbsp;<span>4.20</span></a>(c), with all relevant MOSFET capacitances included. Note that <span class="math inline">\(C_{db}\)</span> is not part of this model, since this capacitance is connected between <span class="math inline">\(V_{DD}\)</span> and GND (bulk node) and does not influence the signal path. For notational convenience, we define <span class="math inline">\(C_{tot} = C_L + C_{sb}\)</span> and <span class="math inline">\(R_{tot} = R_L \parallel \frac{1}{g_m'}\)</span>.</p>
<p>The following analysis is partitioned into several steps. First, we will carry out a full KCL-based derivation of the frequency response from first principles. To simplify, we will then customize the obtained general expressions for a specific and typical range of component values. This will greatly simplify the result and also make it amenable for an intuitive interpretation using the Miller theorem. Finally, for the simplified circuit, we will inspect the input and output impedances to construct a two-port model that is valid up to high frequencies.</p>
<p>We begin by noting that the model of <a href="#fig-4.20" class="quarto-xref">Figure&nbsp;<span>4.24</span></a> resembles the CS circuit analyzed in <a href="partI.3.html#frequency-response-with-intrinsic-and-extrinsic-gate-capacitances">Section 3-3-3</a>: the input and output network are coupled through a capacitor, they contain an RC network on each side, and use a controlled current source in the output network. The main difference lies in the polarity of the controlled source, which reflects the fact that the CD stage is a non-inverting amplifier, whereas a CS stage is an inverting amplifier (i.e., the low-frequency voltage gain is a negative number). This difference has a profound impact on the Miller amplification of the coupling capacitor between the input and output (see <a href="partI.3.html#the-miller-theorem-and-miller-approximation">Section 3-3-5</a>). We will analyze this in more detail below, after interpreting the general KCL-based result.</p>
<div id="fig-4.20" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.20.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.24: Circuit model for high-frequency analysis of the CD stage.
</figcaption>
</figure>
</div>
<p>Based on the general similarity with the circuit analyzed in <a href="partI.3.html#frequency-response-with-intrinsic-and-extrinsic-gate-capacitances">Section 3-3-3</a>, we expect that the full transfer function of the CD stage resembles the 2-pole, 1-zero response expressed in <a href="partI.3.html#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a>. Indeed, the reader can prove (see <a href="#p4.9">Problem 4.9</a>) that carrying out a full KCL-based analysis of the circuit in <a href="#fig-4.20" class="quarto-xref">Figure&nbsp;<span>4.24</span></a> yields</p>
<p><span id="eq-4.36"><span class="math display">\[
\frac{v_{out}}{v_s} = A_v' \frac{\left(1 + s \frac{C_{gs}}{g_m}\right)}{1 + b_1 s + b_2 s^2}  
\tag{4.36}\]</span></span></p>
<p>where</p>
<p><span id="eq-4.37"><span class="math display">\[
b_1 = R_s C_{gs} (1 - A_v') + R_s C_{gd} + R_{tot} C_{gs} + R_{tot} C_{tot}
\tag{4.37}\]</span></span></p>
<p><span id="eq-4.38"><span class="math display">\[
b_2 = R_s R_{tot} ( C_{gs} C_{gd} + C_{gs} C_{tot} + C_{gd} C_{tot} )
\tag{4.38}\]</span></span></p>
<p>and</p>
<p><span id="eq-4.39"><span class="math display">\[
A_v' = \frac{g_m}{g_m' + \frac{1}{R_L}}
\tag{4.39}\]</span></span></p>
<p>is the overall low-frequency voltage gain from <span class="math inline">\(v_s\)</span> to <span class="math inline">\(v_{out}\)</span>.</p>
<p>Once again, while this result is algebraically complex, it is possible to draw a few basic conclusions. First note that the zero in the transfer function occurs at approximately <span class="math inline">\(\omega_T\)</span>, the MOSFET’s cutoff frequency. Hence, the zero will only rarely be relevant for the behavior of the circuit within typical frequencies of interest. Second, if we assume that a dominant pole condition exists, the bandwidth of the circuit will be approximately equal to <span class="math inline">\(1 / b_1\)</span> (see <a href="partI.3.html#the-dominant-pole-approximation">Section 3-3-4</a>). Note also that the derived <span class="math inline">\(b_1\)</span> term can alternatively be found using the method of open-circuit time constants (see <a href="partI.3.html#open-circuit-time-contant-analysis">Section 3-4</a> and <a href="#p4.5">Problem 4-5</a>).</p>
<p>Inspecting <a href="#eq-4.37" class="quarto-xref">Equation&nbsp;<span>4.37</span></a> further, we can consider several approximations. First note that <span class="math inline">\(R_{tot}\)</span> is a very small resistance <span class="math inline">\(&lt; 1 / g_m\)</span>. Consequently, the time constants <span class="math inline">\(R_{tot} C_{gs}\)</span> and <span class="math inline">\(R_{tot} C_{sb}\)</span> (contained in <span class="math inline">\(R_{tot} C_{tot}\)</span>) are typically not dominant, and we can approximate</p>
<p><span id="eq-4.40"><span class="math display">\[
b_1 \cong R_s C_{gs} (1 - A_v') + R_s C_{gd} + R_{tot} C_L  
\tag{4.40}\]</span></span></p>
<p>To simplify further, we need to make assumptions about the relative values of <span class="math inline">\(R_s\)</span> and <span class="math inline">\(C_L\)</span>. This will lead to a result that is no longer general, but useful to capture an important subset of applications for the CD stage. Specifically, consider the circuit shown in <a href="partI.1.html#fig-1.5" class="quarto-xref">Figure&nbsp;<span>1.5</span></a>, where the output resistance of a CS stage defines <span class="math inline">\(R_s\)</span> for the subsequent CD stage. In such an scenario, <span class="math inline">\(R_s\)</span> will be relatively large and certainly much larger than <span class="math inline">\(R_{tot}\)</span>. Assuming this use case, we can argue that the time constants associated with <span class="math inline">\(R_s\)</span> will dominate unless a very large load capacitance (greater than <span class="math inline">\(C_{gs}\)</span>) is connected to the output of the CD stage. Excluding the latter scenario, we arrive at the final approximation <span id="eq-4.41"><span class="math display">\[
b_1 \cong R_s C_{gs}(1 - A_v') + R_s C_{gd}
\tag{4.41}\]</span></span></p>
<p>With this approximation, the circuit’s bandwidth is <span id="eq-4.42"><span class="math display">\[
\omega_{3\text{dB}} \cong \frac{1}{b_1} \cong \frac{1}{R_s C_{gs}(1 - A_v') + R_s C_{gd}}
\tag{4.42}\]</span></span></p>
<p>&nbsp;&nbsp;&nbsp;While this result does not hold in general, it applies to an interesting subset of applications, and it also can be interpreted and understood intuitively. Specifically, note that <span class="math inline">\(C_{gs}\)</span> is modified by a Miller effect multiplier as already seen in <a href="partI.3.html#eq-3.51" class="quarto-xref">Equation&nbsp;<span>3.51</span></a>. We can explain the Miller effect multiplier intuitively using <a href="#fig-4.21" class="quarto-xref">Figure&nbsp;<span>4.25</span></a>. First note that under the assumption that <span class="math inline">\(C_L\)</span> is small, the voltage gain from <span class="math inline">\(v_{in}\)</span> to <span class="math inline">\(v_{out}\)</span> is constant up to very high frequencies. Hence, this gain can be approximated by its low-frequency value <span class="math inline">\(A_v'\)</span> (we call this “Miller approximation,” as explained in <a href="#(#the-miller-theorem-and-miller-approximation)">Section 3-3-5</a>). According to <a href="partI.3.html#eq-3.51" class="quarto-xref">Equation&nbsp;<span>3.51</span></a>, the equivalent shunt input capacitance due to <span class="math inline">\(C_{gs}\)</span> is therefore simply given by <span class="math inline">\(C_{gs}(1 - A_v')\)</span>. Since <span class="math inline">\(A_v'\)</span> is positive, the portion of <span class="math inline">\(C_{gs}\)</span> that is seen from the input is reduced by the Miller effect. Circuit designers sometimes referred to as bootstrapping, this effect represents the effective reduction of <span class="math inline">\(C_{gs}\)</span> in the CD stage, which strongly contrasts with the undesired multiplication of <span class="math inline">\(C_{gd}\)</span> in a CS stage [see <a href="partI.3.html#eq-3.56" class="quarto-xref">Equation&nbsp;<span>3.56</span></a>]. Because of this difference, the bandwidth of a CD stage is often significantly larger than that of a CS stage.</p>
<div id="fig-4.21" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.21.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.25: Circuit model for explaining the Miller effect in a common-drain stage.
</figcaption>
</figure>
</div>
<p><strong><span id="example-4-6">Example 4-6</span>: Bandwidth estimate of a CD Amplifier</strong></p>
<p>Estimate the bandwidth of the CD stage in <a href="#fig-ex-4.5" class="quarto-xref">Figure&nbsp;<span>4.23</span></a> assuming the following parameters: <span class="math inline">\(R_s = 5\ \text{k}\Omega\)</span>, <span class="math inline">\(R_L = 5\ \text{k}\Omega\)</span>, <span class="math inline">\(g_m = 2\ \text{mS}\)</span>, <span class="math inline">\(g_{mb} = 0.417\ \text{mS}\)</span> (from <a href="#example-4-5">Example 4-5</a>) and <span class="math inline">\(C_L = 0\)</span>, <span class="math inline">\(C_{gs} = 203\ \text{fF}\)</span>, <span class="math inline">\(C_{gd} = 50\ \text{fF}\)</span>, and <span class="math inline">\(C_{sb} = 54.3\ \text{fF}\)</span> (from <a href="#example-4-4">Example 4-4</a>). First perform an estimate on the exact <span class="math inline">\(b_1\)</span> term given in <a href="#eq-4.37" class="quarto-xref">Equation&nbsp;<span>4.37</span></a>, then repeat with the approximate value of <a href="#eq-4.41" class="quarto-xref">Equation&nbsp;<span>4.41</span></a> and compute the discrepancy in percent.</p>
<p><strong>SOLUTION</strong></p>
<p>From <a href="#example-4-4">Example 4-4</a>, we know that <span class="math inline">\(A_v'=0.764\)</span>. <span class="math inline">\(R_{tot}\)</span> is the parallel combination of <span class="math inline">\(1/g_m\)</span>, <span class="math inline">\(1/g_{mb}\)</span>, and <span class="math inline">\(R_L\)</span>, which amounts to <span class="math inline">\(382\ \Omega\)</span>. Using <a href="#eq-4.37" class="quarto-xref">Equation&nbsp;<span>4.37</span></a>, we can determine the exact value of <span class="math inline">\(b_1\)</span> as</p>
<p><span class="math display">\[
b_1=R_sC_{gs}(1-A_v')+R_sC_{gd}+R_{tot}C_{gs}+R_{tot}C_{sb}
\]</span> <span class="math display">\[
=240\ \text{ps}+250\ \text{ps}+78\ \text{ps}+21\ \text{ps}=589\ \text{ps}
\]</span></p>
<p>The corresponding bandwidth estimate is</p>
<p><span class="math inline">\(f_{3dB} ≅ \frac{1}{2\pi} \cdot \frac{1}{b_1} = \frac{1}{2\pi} \cdot \frac{1}{589\text{ ps}} = 271 \text{ MHz}\)</span></p>
<p>According to the approximation of <a href="#eq-4.41" class="quarto-xref">Equation&nbsp;<span>4.41</span></a>, we have</p>
<p><span class="math display">\[
b_1 ≅ R_s C_{gs}(1 - A'_v) + R_s C_{gd} = 240\text{ ps} + 250\text{ ps} = 490\text{ ps}
\]</span></p>
<p>Now the corresponding bandwidth estimate is</p>
<p><span class="math display">\[
f_{3dB} ≅ \frac{1}{2\pi} \cdot \frac{1}{b_1} = \frac{1}{2\pi} \cdot \frac{1}{490\text{ ps}} = 325 \text{ MHz}
\]</span></p>
<p>The percent difference between the two estimates is</p>
<p><span class="math display">\[
\frac{325 - 271}{271} = 19.9\%
\]</span></p>
<p>From this result, we see that the simple expression of <a href="#eq-4.41" class="quarto-xref">Equation&nbsp;<span>4.41</span></a> yields a reasonable first-order estimate of the circuit’s bandwidth. The time constants associated with <span class="math inline">\(R_{tot}\)</span> do not play a significant role in setting the circuit’s bandwidth.</p>
<p>As a final step in our analysis, we now consider the input and output impedances of the CD stage (<span class="math inline">\(Z_{in}\)</span> and <span class="math inline">\(Z_{out}\)</span> in <a href="#fig-4.20" class="quarto-xref">Figure&nbsp;<span>4.24</span></a>). For <span class="math inline">\(Z_{in}\)</span>, it is clear from the above treatment that</p>
<p><span id="eq-4.43"><span class="math display">\[
Z_{in} ≅ \frac{1}{s[C_{gs}(1 - A'_v) + C_{gd}]}
\tag{4.43}\]</span></span></p>
<p>for the given assumptions. An interesting situation arises when a p-channel CD stage with source-bulk tie and purely capacitive load is considered (see <a href="#fig-4.20" class="quarto-xref">Figure&nbsp;<span>4.24</span></a>). Since <span class="math inline">\(A'_v \equiv 1\)</span> in this circuit, the input capacitance is well approximated by <span class="math inline">\(C_{gd}\)</span> alone, with no significant contribution from <span class="math inline">\(C_{gs}\)</span>. This follows mathematically from <a href="#eq-4.43" class="quarto-xref">Equation&nbsp;<span>4.43</span></a>, but, more importantly, makes intuitive sense. When <span class="math inline">\(A'_v \equiv 1\)</span>, the input and output nodes precisely follow the same AC voltage. This means that no AC current can flow through <span class="math inline">\(C_{gs}\)</span>, and hence this capacitance becomes irrelevant.</p>
<div id="fig-4.22" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.22.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.26: P-channel common-drain stage with source-bulk tie.
</figcaption>
</figure>
</div>
<p>In order to find <span class="math inline">\(Z_{out}\)</span>, further analysis is needed, and we therefore onsider the setup shown in <a href="#fig-4.23" class="quarto-xref">Figure&nbsp;<span>4.27</span></a>. First consider a special situation where <span class="math inline">\(R_S = 0\)</span>. In this case, <span class="math inline">\(v_{in} = 0\)</span> and the controlled current source is inactive. Thus, we see by inspection</p>
<p><span class="math display">\[
Z_{out} = \frac{1}{g'_m} \, \| \, \frac{1}{s(C_{gs} + C_{sb})}
= \frac{1}{g'_m + s(C_{gs} + C_{sb})}
\]</span></p>
<p><span id="eq-4.44"><span class="math display">\[
= \frac{1}{g'_m} \cdot \frac{1}{1 + s \left( \frac{C_{gs} + C_{sb}}{g'_m} \right)}
\equiv \frac{1}{g'_m}
\tag{4.44}\]</span></span></p>
<div id="fig-4.23" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.23-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.23.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.23-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.27: Circuit for finding Zout of the common-drain stage.
</figcaption>
</figure>
</div>
<p>Here, the final approximation is justified based on the fact that the pole in the preceding expression lies near <span class="math inline">\(\omega_T\)</span> and is therefore negligible in many cases. Consequently, for the special case of <span class="math inline">\(R_S = 0\)</span>, the output impedance of a CD stage is purely resistive up to very high frequencies and closely approximated by <span class="math inline">\(1 / g'_m\)</span>.</p>
<p>&nbsp;&nbsp;&nbsp;For the case of finite <span class="math inline">\(R_S\)</span>, we write KCL at the two nodes of the circuit and solve for <span class="math inline">\(Z_{out} = v / i_t\)</span>. Approximating <span class="math inline">\(g'_m \equiv 1 / g_m\)</span> and neglecting <span class="math inline">\(C_{sb}\)</span> (as justified above) for algebraic simplicity, this yields</p>
<p><span class="math display">\[
Z_{out} \equiv \frac{1}{g_m}
\cdot \frac{1 + s(C_{gs} + C_{gd})R_S}
{1 + s\left(\frac{C_{gs}}{g_m} + R_S C_{gd}\right) + s^2\left(\frac{R_S C_{gs} C_{gd}}{g_m}\right)}
\]</span></p>
<p><span id="eq-4.45"><span class="math display">\[
= \frac{1}{g'_m} \cdot
\frac{\left( 1 - \frac{s}{z} \right)}
{\left( 1 - \frac{s}{p_1} \right) \left( 1 - \frac{s}{p_2} \right)}
\tag{4.45}\]</span></span></p>
<p>Again, this result is algebraically complex, but can be used to gain some insight into the basic behavior. First, we note that the zero in this expression occurs at a frequency below the approximate bandwidth of the circuit <a href="#eq-4.42" class="quarto-xref">see&nbsp;<span>4.42</span></a>. If a dominant pole condition exists, we see that the dominant pole will occur approximately at <span class="math inline">\(1 / (R_S C_{gd})\)</span> (neglecting <span class="math inline">\(C_{gs} / g_m = 1 / \omega_T\)</span>). That is, the first pole occurs <em>after</em> the zero in the overall impedance function. This situation is sketched out in <a href="#fig-4.24" class="quarto-xref">Figure&nbsp;<span>4.28</span></a>. With the zero occurring first, there is a region in which <span class="math inline">\(|Z_{out}|\)</span> increases with frequency. This behavior is characteristic of an inductor (the reactance of an inductor is given by <span class="math inline">\(X = \omega L\)</span>). Consequently, the output impedance</p>
<p><a href="#eq-4.45" class="quarto-xref">Equation&nbsp;<span>4.45</span></a> can be accurately represented by an equivalent <em>RLC</em> network, see <a href="#reference4">Reference 2</a> and <a href="#p4.16s">Problem 4.16</a>. In some practical scenarios, the inductive nature of the output impedance can be problematic due to possible signal oscillations (“ringing”) in response to step-like signals. However, when properly tuned, the inductive component can be used to extend the bandwidth in certain situations. These interesting design topics are unfortunately beyond the scope of the introductory treatment of this module.</p>
<div id="fig-4.24" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.24-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.24.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.24-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.28: Frequency dependence of the common-drain stage’s output impedance.
</figcaption>
</figure>
</div>
<p>In summary, and for the purpose of the multi-stage circuit analysis in <a href="partI.6.html">Chapter 6</a>, an appropriate (but approximate) two-port model that includes the most relevant impedances is shown in <a href="#fig-4.25" class="quarto-xref">Figure&nbsp;<span>4.29</span></a>. This model is reasonably accurate up to frequencies close to the bandwidth of the stage when driven with a relatively large source resistance <span class="math inline">\(R_S &gt; 1/g_m\)</span>. Inductive effects are omitted for simplicity. When confronted with applications that necessitate a different set of approximations, the reader is encouraged to revisit the accurate transfer function result of <a href="#eq-4.36" class="quarto-xref">Equation&nbsp;<span>4.36</span></a> and recustomize it as needed for the specific use case.</p>
<div id="fig-4.25" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.25-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.25.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.25-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.29: Two-port model of the CD stage, including relevant frequency dependent elements (assuming relatively large <span class="math inline">\(R_S &gt; 1/g_m\)</span>) and small CL).
</figcaption>
</figure>
</div>
</section>
</section>
<section id="application-examples-of-common-gate-and-common-drain-stages" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="application-examples-of-common-gate-and-common-drain-stages"><span class="header-section-number">4.5</span> Application Examples of Common-Gate and Common-Drain Stages</h2>
<p>In this section we will discuss a few common applications of the CG and CD stages. The discussion is mostly qualitative and is meant to help solidify the qualitative understanding of the basic properties for all stage configurations discussed so far. Further analytical details for a subset of these applications is covered in <a href="partI.6.html">Chapter 6</a>.</p>
<section id="cs-cg-cascade-cascode-amplifier" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="cs-cg-cascade-cascode-amplifier"><span class="header-section-number">4.5.1</span> CS-CG Cascade (Cascode Amplifier)</h3>
<p>A commonly used circuit called the <strong>cascode amplifier</strong> combines a CS and CG stage as shown in <a href="#fig-4.26" class="quarto-xref">Figure&nbsp;<span>4.30</span></a>. This configuration comes with several benefits, both in terms of low- and high-frequency behavior. From a low-frequency perspective, a key benefit is that the resistance (<span class="math inline">\(R_{out}\)</span>) looking into the drain of the CG device (<span class="math inline">\(M_2\)</span>) is extremely high. This follows directly from <a href="#eq-4.22" class="quarto-xref">Equation&nbsp;<span>4.22</span></a>, with <span class="math inline">\(r_s\)</span> substituted by <span class="math inline">\(r_{o1}\)</span> (the output resistance of MOSFET <span class="math inline">\(M_1\)</span>), which leads to</p>
<p><span class="math display">\[
R_{out} \equiv r_{o1} \cdot g'_m m_2 r_{o2}
\]</span></p>
<p>Furthermore, note that <span class="math inline">\(M_1\)</span> essentially operates as a transconductance stage, since its output is taken as a current that feeds into the CG stage formed by <span class="math inline">\(M_2\)</span>. The short-circuit transconductance of the overall cascode circuit is approximately equal to <span class="math inline">\(g_{m1}\)</span>, since M2 merely acts as a unity gain current buffer.</p>
<div id="fig-4.26" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.26-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.26.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.26-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.30: The cascode configuration and its low-frequency equivalent circuit.
</figcaption>
</figure>
</div>
<p>The net effect is that the product <span class="math inline">\(G_m R_{out}\)</span> of the compound device rmed by <span class="math inline">\(M_1\)</span> and <span class="math inline">\(M_2\)</span> is on the order of <span class="math inline">\((g_m r_o)^2\)</span>, the intrinsic voltage gain of a single MOSFET squared. Thus, an important application of the cascode stage turns out to be in operational amplifiers that implement very large voltage gains. An additional application that takes advantage of the large <span class="math inline">\(R_{out}\)</span> alone is a precision current mirror, discussed in <a href="partI.5.html">Chapter 5</a>.</p>
<p>Interestingly, the cascode configuration offers high-frequency benefits as well. To see this, consider the two-port model of the cascode stage in <a href="#fig-4.27" class="quarto-xref">Figure&nbsp;<span>4.31</span></a>. The capacitance looking into the stage is <span class="math inline">\(C_{gs1}\)</span> plus the Miller amplified <span class="math inline">\(C_{gd1}\)</span>. However, with <span class="math inline">\(M_2\)</span> present, the low-frequency voltage gain from the input to the drain node (<span class="math inline">\(v_x\)</span>) of <span class="math inline">\(M_1\)</span> (i.e., the Miller gain <span class="math inline">\(A_{vM}\)</span>) is limited to approximately the ratio of the two device transconductances (provided that <span class="math inline">\(R_D \ll r_{o2}\)</span>). This means that only a relatively insignificant amount of Miller multiplication occurs; the voltage swing at the circuit output is effectively isolated from the drain node of <span class="math inline">\(M_1\)</span>.</p>
<div id="fig-4.27" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.27-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.27.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.27-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.31: Mitigation of the Miller effect in the cascode configuration.
</figcaption>
</figure>
</div>
<p>A more subtle but welcome high-frequency benefit comes from reduced feedthrough via <span class="math inline">\(C_{gd1}\)</span> at very high frequencies. From <a href="partI.3.html#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a>, we know that a conventional CS stage comes with a high-frequency zero, defined by the ratio <span class="math inline">\(g_m' / C_{gd}\)</span>. Detailed analysis shows that the pact of this zero on the overall transfer function is largely mitigated with the placement of <span class="math inline">\(M_2\)</span> between the input and the overall circuit output.</p>
</section>
<section id="cs-cd-cascade" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="cs-cd-cascade"><span class="header-section-number">4.5.2</span> CS-CD Cascade</h3>
<p>Another popular two-transistor configuration is the CS-CD cascade shown in <a href="#fig-4.28" class="quarto-xref">Figure&nbsp;<span>4.32</span></a>. The main idea here is to employ the CD stage as a voltage buffer to decouple the output resistance of the overall circuit from its voltage gain. Specifically, a relatively large value for <span class="math inline">\(R_D\)</span> can be used to maximize the voltage gain of the CS stage. Yet, the circuit can drive relatively small load resistors <span class="math inline">\(R_L\)</span>, since the resistance looking into <span class="math inline">\(M_2\)</span> is small (<span class="math inline">\(R_{out} \sim 1 / g'_m m_2\)</span>). If <span class="math inline">\(R_L\)</span> was connected directly to the output of CS stage (<span class="math inline">\(v_x\)</span>), the voltage gain would reduce significantly (depending on the specific component values).</p>
<div id="fig-4.28" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.28-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.28.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.28-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.32: Common-source common-drain cascade.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;A disadvantage of using a CD voltage buffer is that the available swing is reduced considerably; this is because the CD device requires a voltage drop of <span class="math inline">\(V_{Tn} + V_{OV}\)</span> from the gate to the source. This voltage drop reduces the voltage range between <span class="math inline">\(V_{DD}\)</span> and ground that can be used for the signal.</p>
</section>
<section id="cg-stage-as-a-load-device" class="level3" data-number="4.5.3">
<h3 data-number="4.5.3" class="anchored" data-anchor-id="cg-stage-as-a-load-device"><span class="header-section-number">4.5.3</span> CG Stage as a Load Device</h3>
<p>An interesting combination of a CS and CG stage is shown in <a href="#fig-4.29" class="quarto-xref">Figure&nbsp;<span>4.33</span></a>. Here, the CG stage essentially emulates the drain resistor <span class="math inline">\(R_D\)</span> that is shown for example in the stage of <a href="#fig-4.28" class="quarto-xref">Figure&nbsp;<span>4.32</span></a> and used in the CS circuits throughout <a href="partI.2.html">Chapters 2</a> and <a href="#frequency-response-of-the-common-souyrce-amplifier">Chapter 3</a>. The small-signal resistance looking into the source of <span class="math inline">\(M_2\)</span> is approximately <span class="math inline">\(1 / g'_{m2}\)</span> and therefore the low-frequency voltage gain of the full circuit is approximately equal to <span class="math inline">\(-g_{m1}/g'_{m2}\)</span>. This means that the ain is typically not very large, since there are limits on how small <span class="math inline">\(g'_{m2}\)</span> can be made while maintaining a reasonable device size.</p>
<div id="fig-4.29" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.29-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.29.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.29-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.33: Common-source common-drain cascade.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;An advantage of using a MOSFET over a resistor is that the voltage gain is defined by two components of the same type. Circuit designers refer to this concept as <strong>ratiometric design</strong>. Even if the transconductance of each MOSFET varies substantially (e.g., due to a large temperature change), the voltage gain will remain relatively constant. This concept will be better appreciated once we have discussed sources of parameter variations in <a href="partI.5.html">Chapter 5</a>.</p>
<p>&nbsp;&nbsp;&nbsp;Similar to the CD buffer discussed in the previous subsection, a disadvantage of this circuit topology is that it does not support a very large output swing. In addition to the voltage drop from the gate to the ource of <span class="math inline">\(M_2\)</span>, note that the output can swing from the quiescent point in the positive direction by at most <span class="math inline">\(V_{OV2}\)</span> before <span class="math inline">\(M_2\)</span> enters cutoff.</p>
</section>
</section>
<section id="summary" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="summary"><span class="header-section-number">4.6</span> Summary</h2>
<p>In this chapter, we discussed the common-gate and common-drain stage configurations. As we have seen, the core sections of these circuits operate as a current buffer and voltage buffer, respectively. <a href="#fig-4.30" class="quarto-xref">Figure&nbsp;<span>4.34</span></a> summarizes the corresponding low-frequency model structure in comparison with the common-source stage. Focusing only on the core circuits and cting any auxiliary elements such as drain resistance <span class="math inline">\(R_D\)</span>, <a href="#tbl-4.2">Table 4-2</a> lists the main model parameters. As exemplified in <a href="#application-examples-of-common-gate-and-common-drain-stages">Section 4-5</a>, combining these three configurations with their different characteristics gives the designer the freedom to construct a wide range of application-optimized amplifiers. This idea is studied further in <a href="partI.6.html">Chapter 6</a>.</p>
<div id="fig-4.30" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.30-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure4.30.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.30-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.34: Summary of low-frequency two-port model structures for the CS, CG, and CD configurations.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;As far as the frequency response of the CG and CD stages is concerned, we have seen that several approximations are necessary to capture their essential behavior in simplified, low-complexity expressions. In performing these simplifications and intuitively understanding results that are in their raw form algebraically complex, it pays to master the basic tool set covered in this module so far. Important techniques include the concept of working with unilateral two-port approximations, the dominant pole approximation, the method of open-circuit time constants, and a general feel for the relative magnitudes of MOSFET capacitances, transconductance, and output resistance.</p>
<p>The main finding from the detailed frequency response analysis of the CG and CD stages is that these circuits can operate (under certain conditions) up to very high frequencies, nearing the cutoff frequency (<span class="math inline">\(\omega_T\)</span>) of the constituent MOSFET.</p>
<p>An important detail in the design of CG and CD stages is the connection of the MOSFET’s bulk. The circuit designer must understand the various options afforded by the process technology and then decide about a suitable configuration that helps maximize performance. As we have shown, it is typically advantageous to connect the bulk to the supply voltage (GND for an n-channel, and <span class="math inline">\(V_{DD}\)</span> for a p-channel) in a CG stage. In a CD stage, it is sometimes advantageous to opt for a source-bulk tie, especially when a voltage gain as close as possible to unity is required.</p>
<div class="table striped hover">
<div id="tbl-4.2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-4.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.2: Comparison of low-frequency stage characteristics.
</figcaption>
<div aria-describedby="tbl-4.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 40%">
<col style="width: 20%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Property</strong></th>
<th><strong>CS</strong></th>
<th><strong>CG</strong></th>
<th><strong>CD</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-port model</td>
<td>Transconductance or Voltage Amplifier</td>
<td>Current Amplifier</td>
<td>Voltage Amplifier</td>
</tr>
<tr class="even">
<td>Gain</td>
<td><span class="math inline">\(g_m\)</span> or <span class="math inline">\(A_v = g_m r_o\)</span></td>
<td><span class="math inline">\(A_i  ≅ -1\)</span></td>
<td><span class="math inline">\(A_v  ≅  0.7 \dots 1\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(R_{in}\)</span></td>
<td><span class="math inline">\(\infty\)</span></td>
<td><span class="math inline">\(≅  1 / g'_m\)</span></td>
<td><span class="math inline">\(\infty\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(R_{out}\)</span></td>
<td><span class="math inline">\(r_o\)</span></td>
<td><span class="math inline">\(r_o(1 +g'_m r_s)\)</span></td>
<td><span class="math inline">\(≅  1 / g'_m\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</section>
<section id="references4" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="references4"><span class="header-section-number">4.7</span> References</h2>
<ol type="1">
<li><p>R. F. Pierret, <em>Semiconductor Device Fundamentals</em>, Prentice Hall, 1995.</p></li>
<li><p>P. R. Gray, P. J. Hurst, S. H. Lewis, and R. G. Meyer, <em>Analysis and Design of Analog Integrated Circuits</em>, 5th Edition, Wiley, 2008.</p></li>
</ol>
</section>
<section id="problems" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="problems"><span class="header-section-number">4.8</span> Problems</h2>
<p>Unless otherwise stated, use the standard model parameters specified in <a href="#tbl-4.1">Table 4-1</a> for the problems given below. Consider only first-order MOSFET behavior and include channel-length modulation (as well as any other second-order effects) only where explicitly stated.</p>
<p><strong>P4.1</strong> In the circuit of <a href="#fig-p4-1" class="quarto-xref">Figure&nbsp;<span>4.35</span></a>, the MOSFET has a channel length of <span class="math inline">\(2\ \mu\text{m}\)</span> and the width was chosen such that <span class="math inline">\(V_{OUT} = 1.5\ \text{V}\)</span> with <span class="math inline">\(I_B = 200\ \mu\text{A}\)</span>. Neglect channel-length modulation.</p>
<ol type="a">
<li><p>Draw the complete small-signal model of the circuit and eliminate capacitances that will not affect the circuit operation. Be sure to include the well-to-substrate capacitance.</p></li>
<li><p>Calculate the MOSFET’s gate-source (<span class="math inline">\(C_{gs}\)</span>) and the well-to-substrate (<span class="math inline">\(C_{bsub}\)</span>) capacitance using the same approach as in <a href="#example-4-1">Example 4-1</a>. Compute the ratio <span class="math inline">\(C_{bsub} / C_{gs}\)</span>.</p></li>
</ol>
<div id="fig-p4-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-p4-1.png" id="fig-p4-1" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-p4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.35
</figcaption>
</figure>
</div>
<p><strong>P4.2</strong> Repeat <a href="#example-4-3">Example 4-3</a> using <span class="math inline">\(I_B =200\ \text{µA}\)</span> and assuming that the bulk is tied to the source of the MOSFET, i.e., <span class="math inline">\(V_{SB} = 0\)</span>. Recompute <span class="math inline">\(V_{OUT}\)</span>, <span class="math inline">\(V_S\)</span>, as well as <span class="math inline">\(V_{DS}\)</span> and <span class="math inline">\(V_{OV} = V_{GS} - V_{Tn}\)</span> of the transistor.</p>
<p><strong>P4.3</strong> The p-channel common-gate amplifier shown in <a href="#fig-p4-3" class="quarto-xref">Figure&nbsp;<span>4.36</span></a> has a power dissipation of 1 mW. The MOSFET has a channel length of <span class="math inline">\(2\ \mu\text{m}\)</span> and the current gain <span class="math inline">\(i_{out} / i_s = 0.8\)</span>. The circuit is biased such that no DC current flows into the resistor connected to the drain.</p>
<p><strong>(a)</strong> What is the required <span class="math inline">\(W\)</span>? For simplicity, neglect the backgate effect in this part of the problem. Also explain why channel-length modulation can be safely ignored.</p>
<p><strong>(b)</strong> Re-compute the current gain taking the backgate effect into account (bulk connected to the positive supply). You will need to perform numerical iterations to solve this problem. Based on the results from your first 1–2 iterations, is including the backgate effect worth the effort? Does the current gain increase or decrease relative to part (a)?</p>
<div id="fig-p4-3" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p4-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-p4-3.png" id="fig-p4-3" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-p4-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.36
</figcaption>
</figure>
</div>
<p><strong>P4.4</strong> Repeat <a href="#example-4-4">Example 4-4</a> using a channel length of <span class="math inline">\(3\ \mu\text{m}\)</span> and all other parameters left unchanged. Comment on any changes in the dominant time constants. Note that you will need to recompute the quiescent point voltages of the circuit.</p>
<p><strong>P4.5</strong> The circuit shown in <a href="#fig-p4-5" class="quarto-xref">Figure&nbsp;<span>4.37</span></a> is used as a transresistance amplifier for small-signal currents coming from a photodiode, modeled using the equivalent circuit as shown. For simplicity, ignore the backgate effect in all calculations. Parameters:<br>
<span class="math inline">\(R_{diode} = 50\ \text{k}\Omega\)</span>, <span class="math inline">\(C_{diode} = 70\ \text{fF}\)</span>, <span class="math inline">\(C_L = 150\ \text{fF}\)</span>, <span class="math inline">\(R_L = 1\ \text{k}\Omega\)</span>, and <span class="math inline">\(L = 1\ \mu\text{m}\)</span> for the MOSFET.</p>
<ol type="a">
<li><p>Assuming <span class="math inline">\(I_D = 150\ \mu\text{A}\)</span>, calculate the required gate overdrive voltage (<span class="math inline">\(V_{OV}\)</span>) to achieve a transconductance of <span class="math inline">\(0.75\ \text{mS}\)</span> and size the width of the transistor accordingly. Determine the proper value needed for <span class="math inline">\(I_B\)</span> taking <span class="math inline">\(R_{diode}\)</span> into account. Note that <span class="math inline">\(R_{diode}\)</span> is a large signal resistance.</p></li>
<li><p>Considering only the intrinsic capacitance and ignoring <span class="math inline">\(r_o\)</span>, construct the small-signal model of the circuit.</p></li>
<li><p>Calculate the low-frequency transresistance gain <span class="math inline">\(v_{out} / i_{light}\)</span>.</p></li>
<li><p>Estimate the circuit’s bandwidth using the method of open-circuit time constants assuming <span class="math inline">\(R_G = 0\)</span>.</p></li>
<li><p>Repeat part (d) assuming <span class="math inline">\(R_G = 500\ \Omega\)</span>.</p></li>
</ol>
<div id="fig-p4-5" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p4-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-p4-5.png" id="fig-p4-5" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-p4-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.37
</figcaption>
</figure>
</div>
<p><strong>P4.6</strong> Derive the approximate result for the output impedance of a CG stage as given in <a href="#eq-4.27" class="quarto-xref">Equation&nbsp;<span>4.27</span></a>. Using the circuit of <a href="#fig-4.13" class="quarto-xref">Figure&nbsp;<span>4.15</span></a>, apply a test source at e output and solve for <span class="math inline">\(Z_{out} = v / i_t\)</span>. Simplify the resulting expressions assuming <span class="math inline">\(\omega \ll \omega_T\)</span> and <span class="math inline">\(g'_m r_s \gg 1\)</span>.</p>
<p><strong>P4.7</strong> Consider the CD circuits shown in <a href="#fig-p4-7" class="quarto-xref">Figure&nbsp;<span>4.38</span></a>(a) and (b). Ignore channel length modulation.</p>
<ol type="a">
<li><p>Suppose that the output voltage swings from <span class="math inline">\(2\ \text{V}\)</span> to <span class="math inline">\(4.5\ \text{V}\)</span> in both circuits. Calculate the corresponding voltage swings at the gate nodes for <span class="math inline">\(R_L = 1\ \text{k}\Omega\)</span> and <span class="math inline">\(R_L = 1\ \text{M}\Omega\)</span>. Determine these values using the transistor’s large signal model. Summarize your results in a table and explain how different values for <span class="math inline">\(R_L\)</span> and the two bulk connection schemes affect the required input voltages.</p></li>
<li><p>Draw a low-frequency small-signal model for the circuit of <a href="#fig-p4-7" class="quarto-xref">Figure&nbsp;<span>4.38</span></a>(a). ind an analytical expression for the low-frequency small-signal voltage gain <span class="math inline">\(v_{out} / v_{in}\)</span> as a function of <span class="math inline">\(R_L\)</span> and the quiescent point voltages <span class="math inline">\(V_{IN}\)</span> and <span class="math inline">\(V_{OUT}\)</span>. Calculate the small-signal gain at <span class="math inline">\(V_{OUT} = 2\ \text{V}\)</span> and <span class="math inline">\(V_{OUT} = 4.5\ \text{V}\)</span> using <span class="math inline">\(R_L = 1\ \text{k}\Omega\)</span>.</p></li>
</ol>
<div id="fig-p4-7" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p4-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-p4-7.png" id="fig-p4-7" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-p4-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.38
</figcaption>
</figure>
</div>
<p><strong>P4.8</strong> In the circuit of <a href="#fig-p4-8" class="quarto-xref">Figure&nbsp;<span>4.39</span></a> ignore backgate effect and channel length modulation. Parameters: <span class="math inline">\(R = 1\ \text{k}\Omega\)</span>, <span class="math inline">\(W/L = 40\)</span>.</p>
<ol type="a">
<li><p>Calculate the input voltage and corresponding output voltage at which the device enters the triode region.</p></li>
<li><p>Sketch <span class="math inline">\(V_{OUT}\)</span> versus <span class="math inline">\(V_{IN}\)</span> (<span class="math inline">\(0 \dots 5\ \text{V}\)</span>). Calculate and annotate pertinent asymptotes and breakpoints, including the voltages calculated in part (a).</p></li>
</ol>
<div id="fig-p4-8" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p4-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-p4-8.png" id="fig-p4-8" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-p4-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.39
</figcaption>
</figure>
</div>
<p><strong>P4.9</strong> Derive <a href="#eq-4.36" class="quarto-xref">Equation&nbsp;<span>4.36</span></a> through <a href="#eq-4.39" class="quarto-xref">Equation&nbsp;<span>4.39</span></a> using a KCL-based analysis of the circuit in <a href="#fig-4.20" class="quarto-xref">Figure&nbsp;<span>4.24</span></a>.</p>
<p><strong>P4.10</strong> Derive <a href="#eq-4.37" class="quarto-xref">Equation&nbsp;<span>4.37</span></a> by performing an open-circuit time constant analysis for the circuit of <a href="#fig-4.20" class="quarto-xref">Figure&nbsp;<span>4.24</span></a>.</p>
<p><strong>P4.11</strong> Consider the p-channel CD circuit of <a href="#fig-4.22" class="quarto-xref">Figure&nbsp;<span>4.26</span></a>. Assuming <span class="math inline">\(C_{gs} = 200\ \text{fF}\)</span> and <span class="math inline">\(g_m r_o = 50\)</span>, what is the contribution of <span class="math inline">\(C_{gs}\)</span> to the overall input capacitance of the circuit (in fF)?</p>
<p><strong>P4.12</strong> In the circuit of <a href="#fig-p4-12" class="quarto-xref">Figure&nbsp;<span>4.40</span></a>, the input quiescent point voltage is adjusted such that <span class="math inline">\(V_{OUT} = 1\ \text{V}\)</span>. The MOSFET is sized such that <span class="math inline">\(V_{OV} = 400\ \text{mV}\)</span> and <span class="math inline">\(f_T = 1\ \text{GHz}\)</span>. In your analysis, neglect backgate effect, finite output resistance, and all extrinsic device capacitances.</p>
<ol type="a">
<li><p>Calculate the circuit’s low-frequency small-signal voltage gain <span class="math inline">\(v_{out} / v_{in}\)</span>.</p></li>
<li><p>After playing in the lab for many hours, your friend found that for a certain value of <span class="math inline">\(C_L\)</span>, the circuit achieves a perfectly “flat” frequency response and essentially “infinite” small-signal bandwidth. Calculate the value of <span class="math inline">\(C_L\)</span> that causes this behavior in <span class="math inline">\(v_{out}(s)/v_{in}(s)\)</span>. Assume that the input of the circuit is driven by an ideal voltage source (<span class="math inline">\(R_S = 0\)</span>).</p></li>
<li><p>Suppose we let <span class="math inline">\(C_L = 0\)</span>. Under this condition, what is the small-signal voltage gain when the input frequency approaches “infinity”? Sketch a Bode plot of the circuit transfer function to justify your answer.</p></li>
</ol>
<div id="fig-p4-12" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p4-12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-p4-12.png" id="fig-p4-12" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-p4-12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.40
</figcaption>
</figure>
</div>
<p><strong>P4.13</strong> In <a href="#example-4-6">Example 4-6</a>, we estimated the bandwidth of a CD circuit using the term <span class="math inline">\(b_1\)</span> in the circuit’s transfer function. Given the parameter values used in Example 4-6, plot the magnitude of the exact transfer function given by Eq. (4.36) (using any computer program that is available to you).Find the 3dB bandwidth using a numerical solver. Compare the obtained value with the numbers found in Example 4-6.</p>
<p><strong>P4.14</strong> In <a href="#fig-4.21" class="quarto-xref">Figure&nbsp;<span>4.25</span></a>, we used a qualitative reasoning to explain the Miller multiplication term of <span class="math inline">\(C_{gs}\)</span> in a CD stage. Specifically, we argued that the Miller gain for this capacitance will be constant up to very high frequencies. Following the same approach that was taken to derive <a href="partI.3.html#eq-3.54" class="quarto-xref">Equation&nbsp;<span>3.54</span></a> for the CS stage, derive an exact expression for the Miller gain across <span class="math inline">\(C_{gs}\)</span> with relevant poles and zeros included. Show that these poles and zeros can be disregarded as long as <span class="math inline">\(C_L\)</span> is small.</p>
<p><strong>P4.15</strong> Derive <a href="#eq-4.45" class="quarto-xref">Equation&nbsp;<span>4.45</span></a> using a KCL-based analysis. As shown in the circuit of <a href="#fig-4.23" class="quarto-xref">Figure&nbsp;<span>4.27</span></a>, apply a test source at the output and solve for <span class="math inline">\(Z_{out} = v / i_t\)</span>. Approximate <span class="math inline">\(g_m \equiv g'_m\)</span> and neglect <span class="math inline">\(C_{sb}\)</span>.</p>
<p><strong>P4.16</strong> Consider the CD circuit shown in <a href="#fig-p4-16" class="quarto-xref">Figure&nbsp;<span>4.41</span></a>(a). Neglect finite output resistance and all extrinsic device capacitances, as well as the bulk-to-substrate capacitance.</p>
<ol type="a">
<li><p>Draw the small-signal model of the circuit and find a symbolic expression for the output impedance <span class="math inline">\(Z_{out}(s)\)</span>.</p></li>
<li><p>Show that for <span class="math inline">\(R_S &gt; 1 / g_m\)</span>, the output impedance can be modeled as an <span class="math inline">\(RL\)</span> circuit as shown in <a href="#fig-p4-16" class="quarto-xref">Figure&nbsp;<span>4.41</span></a>(b). Express <span class="math inline">\(L\)</span>, <span class="math inline">\(R_1\)</span>, and <span class="math inline">\(R_2\)</span> in terms of <span class="math inline">\(R_S\)</span>, <span class="math inline">\(g_m\)</span>, and <span class="math inline">\(C_{gs}\)</span>.</p></li>
<li><p>Calculate numerical values for <span class="math inline">\(L\)</span>, <span class="math inline">\(R_1\)</span>, and <span class="math inline">\(R_2\)</span> assuming the following arameters: <span class="math inline">\(I_B = 1\ \text{mA}\)</span>, <span class="math inline">\(R_S = 1\ \text{M}\Omega\)</span>, <span class="math inline">\(W = 20\ \mu\text{m}\)</span>, and <span class="math inline">\(L = 1\ \mu\text{m}\)</span>. Verify that <span class="math inline">\(R_S &gt; 1 / g_m\)</span>.</p></li>
</ol>
<div id="fig-p4-16" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p4-16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-p4-16.png" id="fig-p4-16" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-p4-16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.41
</figcaption>
</figure>
</div>
</section>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../contents/partI/partI.3.html" class="pagination-link" aria-label="Frequency Response of the Common-Source Voltage Amplifier">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Frequency Response of the Common-Source Voltage Amplifier</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../contents/partI/partI.5.html" class="pagination-link" aria-label="Biasing Circuits">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Biasing Circuits</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Curated by Boris Murmann</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions"><ul><li><a href="https://github.com/bmurmann/COCOA/edit/main/contents/partI/partI.4.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/bmurmann/COCOA/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/bmurmann/COCOA/blob/main/contents/partI/partI.4.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>