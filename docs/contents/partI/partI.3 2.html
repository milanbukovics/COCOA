<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Frequency Response of the Common-Source Voltage Amplifier – COCOA: Collaborative Compendium on Analog Integrated Circuits</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../contents/partI/partI.4.html" rel="next">
<link href="../../contents/partI/partI.2.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-86daaaaad7353f9cc0c554efc1dd6d94.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-f8dc6eab18fde03278982b0b35885446.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-68f2a1e86eb87956d0dce9a9876931f0.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-e33efa0a5593d9d8adcbebffb5cac9ec.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "~",
    "/"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">COCOA: Collaborative Compendium on Analog Integrated Circuits</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-wide tools-end">
    <a href="https://github.com/bmurmann/COCOA" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../../COCOA--Collaborative-Compendium-on-Analog-Integrated-Circuits.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../contents/partI/partI.1.html">Learn to Crawl — Square-Law Transistors, Biasing and Small-Signal Analysis</a></li><li class="breadcrumb-item"><a href="../../contents/partI/partI.3.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><span id="frequency-response-of-the-common-souyrce-amplifier">Frequency Response of the Common-Source Voltage Amplifier</span></span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgements</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/contributors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/copyright.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Copyright</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/conventions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conventions</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Learn to Crawl — Square-Law Transistors, Biasing and Small-Signal Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partI/partI.1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partI/partI.2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Transfer Characteristic of the Common-Source Voltage Amplifier</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partI/partI.3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><span id="frequency-response-of-the-common-souyrce-amplifier">Frequency Response of the Common-Source Voltage Amplifier</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partI/partI.4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Common-Gate and Common-Drain Stages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partI/partI.5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Biasing Circuits</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Learn to Walk — Real Transistors, Noise, Mismatch, and Distortion</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partII/partII.1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partII/partII.2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to Feedback</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Dare to Run — Knowledge Base for State-of-the-Art Circuits</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/partIII/partIII.1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../contents/partI/partI.1.html">Learn to Crawl — Square-Law Transistors, Biasing and Small-Signal Analysis</a></li><li class="breadcrumb-item"><a href="../../contents/partI/partI.3.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><span id="frequency-response-of-the-common-souyrce-amplifier">Frequency Response of the Common-Source Voltage Amplifier</span></span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><span id="frequency-response-of-the-common-souyrce-amplifier">Frequency Response of the Common-Source Voltage Amplifier</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div style="text-align: justify">
<p>In the previous chapter, we have analyzed the common-source stage in terms of its static voltage transfer characteristic and did not consider any dynamic effects in the relationship between the circuit’s input and output. The obtained results are therefore applicable only in the limit of slowly varying signals, and further analysis is needed to predict limits in the circuit’s operating speed.</p>
<p>&nbsp;&nbsp;&nbsp;In most electronic circuits, the speed of operation is fundamentally limited by the presence of undesired capacitive elements. Therefore, for the purpose of including dynamic effects in the common-source voltage amplifier, we will expand the MOSFET model with its capacitive elements. In the spirit of the just-in-time modeling approach followed in this module, we first consider primary effects related to <strong>intrinsic capacitance</strong>, i.e., capacitance that is unavoidable and required for the operation of a MOSFET. We then refine our analysis to include <strong>extrinsic capacitances</strong>. Extrinsic capacitances are not required for the operation of a MOSFET, but nonetheless exist due to limitations or properties of a certain device structure or manufacturing process.</p>
<p>&nbsp;&nbsp;&nbsp; The analysis and inclusion of device capacitance will follow the small-signal modeling approach used in <a href="partI.2.html">Chapter 2</a>. That is, even though most MOSFET device capacitances are inherently nonlinear, we will approximate them using linear elements at the MOSFET’s operating point. At the various stages of the model development, we consider the dynamics of the amplifier for small-signal, sinusoidal inputs in the steady-state. Specifically, we evaluate the phase and magnitude of the amplifier’s output signal to quantify its behavior as a function of frequency.</p>
<p>&nbsp;&nbsp;&nbsp; Even though the small-signal abstraction greatly simplifies the analysis of circuit dynamics, we will find that further simplifications and tools are needed to reason quickly and intuitively about the limiting effects. Therefore, this chapter includes a treatment of the <strong>dominant pole approximation</strong>, the <strong>Miller theorem</strong>, the <strong>Miller approximation</strong>, and the <strong>open-circuit time constant</strong> (OCT) analysis. These techniques are broadly applicable and useful for the analysis of a wide range of circuits, going far beyond the motivational common-source stage example treated in this chapter.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Chapter Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Review the basic concepts of frequency domain analysis.</li>
<li>Extend the small-signal MOSFET model with intrinsic and extrinsic device capacitances.</li>
<li>Derive the sinusoidal steady-state frequency response of the common-source stage at various levels of capacitance modeling and circuit abstraction.</li>
<li>Review and develop tools and approximation methods that help simplify the frequency response analysis of a circuit: dominant pole approximation, Miller theorem, Miller approximation, and open-circuit time constant analysis.</li>
</ul>
</div>
</div>
<section id="review-of-frequency-domain-analysis" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="review-of-frequency-domain-analysis"><span class="header-section-number">3.1</span> Review of Frequency Domain Analysis</h2>
<p>In this section, we will review important pre-requisite material using the RC circuit shown in <a href="#fig-3.1" class="quarto-xref">Figure&nbsp;<span>3.1</span></a> as a driving example. Our objective is to gain insight into the circuit’s behavior when a sinusoidal signal of a given frequency is applied at its input. Since the circuit consists of linear elements, it follows that the output can only contain a sinusoid at the same frequency that is applied. Therefore, all we need to determine is the amplitude and phase of the output sinusoid. Note that even though we restrict ourselves to sine waves, the analysis results are generally useful since arbitrary periodic signals can be constructed from a sum of sinusoids</p>
<div id="fig-3.1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: RC circuit example.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;From first principles, we could approach this problem by applying <span class="math inline">\(KCL\)</span> and <span class="math inline">\(KVL\)</span>, noting that the current flowing through a capacitor is given by <span class="math inline">\(C \cdot dv/dt\)</span>. The result of this analysis is a linear differential equation that links <span class="math inline">\(v_{in}(t)\)</span> and <span class="math inline">\(v_{out}(t)\)</span>. This equation can be solved for a sinusoidal input, yielding in general two components that make up the output. The first is called the transient part; it decays to zero for <span class="math inline">\(t → ∞\)</span> . The second is called the <strong>steady-state</strong> component, and it persists for all <span class="math inline">\(t\)</span>. This latter component is what we are interested in.</p>
<p>&nbsp;&nbsp;&nbsp;A convenient shortcut to obtain the steady-state response is to work with <strong>Laplace transform</strong> models for each circuit element and to determine the transfer functions in the <span class="math inline">\(s\)</span>-domain. Once an <span class="math inline">\(s\)</span>-transfer function is created, the circuit’s steady-state response to a sinusoidal input is found by letting <span class="math inline">\(s\)</span> = <span class="math inline">\(j\omega\)</span> and by computing the phase and the magnitude of the output as a function of frequency (<span class="math inline">\(\omega\)</span>). The resulting characteristic is called the <strong>frequency response</strong> of the circuit and is usually plotted in the format of a <strong>Bode plot</strong>. The involved variables that capture how the magnitude and phase vary with frequency are called <strong>phase vectors</strong> or <strong>phasors</strong>. In this module, the notation for phasors uses an uppercase variable name and lowercase subscripts such as <span class="math inline">\(V_{in}\)</span> and <span class="math inline">\(I_{out}\)</span>. &nbsp;&nbsp;&nbsp;We will now illustrate the flow of such an analysis using the <span class="math inline">\(RC\)</span> circuit example</p>
<p><strong><span id="example-3-1">Example 3-1</span>: Frequency Response of an RC Circuit</strong></p>
<p>Find the magnitude and phase of the transfer function <span class="math inline">\(V_{out}\)</span> /<span class="math inline">\(V_{in}\)</span> in for the <span class="math inline">\(RC\)</span> circuit in <a href="#fig-3.1" class="quarto-xref">Figure&nbsp;<span>3.1</span></a>.</p>
<p><strong>SOLUTION</strong></p>
<p>We begin by noting that in the <span class="math inline">\(s\)</span>-domain, the reactance of a capacitor is given by <span class="math inline">\(1/sC\)</span>. By applying the voltage divider rule, we can therefore write a transfer function that links <span class="math inline">\(v_{out}\)</span> and <span class="math inline">\(v_{in}\)</span> in the <span class="math inline">\(s\)</span>-domain as follows</p>
<p><span class="math display">\[
\frac{v_{out}}{v_{in}} = \frac{\frac{1}{sC}}{\frac{1}{sC} + R} = \frac{1}{1 + sRC}
\]</span></p>
<p>In order to evaluate this transfer function for steady-state sinusoids, we let <span class="math inline">\(s\)</span> = <span class="math inline">\(j\omega\)</span> and obtain</p>
<p><span class="math display">\[
\frac{V_{out}}{V_{in}} = \left. \frac{v_{out}}{v_{in}}\right|_{s=j\omega} = \frac{1}{1+sRC}
\]</span></p>
<p>Following the rules for determining the magnitude and phase of a complex number, we obtain</p>
<p><span class="math display">\[
\left| \frac{V_{out}}{V_{in}} \right| = \sqrt{\frac{1}{1 + (\omega RC)^2}}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\angle \frac{V_{out}}{V_{in}} = \tan^{-1}(-\omega RC)
\]</span></p>
<p>From this result, we see that for <span class="math inline">\(\omega RC \gg 1\)</span> the sinusoid is attenuated and shifted by <span class="math inline">\(–90^\circ\)</span>, i.e.</p>
<p><span class="math display">\[
\left| \frac{V_{out}}{V_{in}} \right| = \frac{1}{\omega RC}
\quad\quad\quad
\angle \frac{V_{out}}{V_{in}} \simeq -90^\circ
\]</span></p>
<p>For <span class="math inline">\(\omega RC \ll 1\)</span>, the sinusoid is passed unattenuated and with no phase shift, i.e.,</p>
<p><span class="math display">\[
\left| \frac{V_{out}}{V_{in}} \right|  \simeq 1
\quad\quad\quad
\angle \frac{V_{out}}{V_{in}} \simeq 0^\circ
\]</span></p>
<p>This result makes intuitive sense, since the capacitor carries a larger current for high frequencies, increasingly “shorting” the output port and attenuating the signal. At high frequencies, the phase approaches <span class="math inline">\(–90^\circ\)</span> due to the signal differentiation that takes place in the capacitor. Its current is given by <span class="math inline">\(C \cdot dv/dt\)</span>, and differentiation of a sine wave yields a cosine wave that is <span class="math inline">\(–90^\circ\)</span> shifted in phase.</p>
<section id="bode-plots" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="bode-plots"><span class="header-section-number">3.1.1</span> <span id="bode-plots">Bode Plots</span></h3>
<p>In order to gain further insight from the magnitude and phase of a circuit, it is customary to plot the response in the form of a Bode plot, which shows the log of the magnitude versus the log of the frequency, and the phase angle versus the log of the frequency. In this representation, the magnitude and phase can be inspected over many orders of magnitude in frequency.</p>
<div id="fig-3.2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.2.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: Bode plot for the RC circuit example of <a href="#fig-3.1" class="quarto-xref">Figure&nbsp;<span>3.1</span></a>. (a) Log magnitude vs.&nbsp;log frequency. (b) Phase vs.&nbsp;log frequency.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;A Bode plot for the circuit of <a href="#fig-3.1" class="quarto-xref">Figure&nbsp;<span>3.1</span></a> is shown in <a href="#fig-3.2" class="quarto-xref">Figure&nbsp;<span>3.2</span></a>. A few interesting features can be identified from this plot as follows. First, recall from the analysis of the circuit that for very high frequencies, where <span class="math inline">\(\omega \gg 1/RC\)</span>, the magnitude of the transfer function becomes inversely proportional to frequency. This is seen in the high-frequency region of the plot where the magnitude decreases by a factor of <span class="math inline">\(10\)</span> for every factor of <span class="math inline">\(10\)</span> increase in <span class="math inline">\(\omega\)</span>. Second, an interesting point in the Bode plot is where <span class="math inline">\(\omega= 1/RC\)</span>, also called the <strong>breakpoint frequency</strong>. At the breakpoint, the magnitude is given by</p>
<p><span id="eq-3.1"><span class="math display">\[
\left| \frac{V_{out}}{V_{in}} \right| = \left| \frac{1}{1+j\omega RC} \right| = \left| \frac{1}{1+j} \right| = \frac{1}{\sqrt 2} = 0.707
\tag{3.1}\]</span></span></p>
<p>and the phase is</p>
<p><span id="eq-3.2"><span class="math display">\[
\angle \frac{V_{out}}{V_{in}} = \tan^{-1}(-\omega RC) = \tan^{-1}(-1) = -45^\circ
\tag{3.2}\]</span></span></p>
<p>&nbsp;&nbsp;&nbsp;It is customary to express the logarithmic magnitude scale on a Bode plot with a dimensionless unit called a <strong>decibel</strong> (dB). The magnitude of the ratio of voltages in units of dB is:</p>
<p>&nbsp;&nbsp;&nbsp;Ratio of voltages in decibels: <span class="math inline">\(20\ \log \left| \frac{V_{out}}{V_{in}} \right|\)</span> dB</p>
<p>Therefore, in terms of decibels (indicated on the right-hand <span class="math inline">\(y\)</span>-axis in <a href="#fig-3.2" class="quarto-xref">Figure&nbsp;<span>3.2</span></a>) the magnitude falls at –20 dB/decade at high frequencies. Expressed in decibels, the magnitude of the voltage at the breakpoint frequency <span class="math inline">\(\omega = 1/RC\)</span> is <span class="math inline">\(20 \log (1/ \sqrt 2) \simeq -3\)</span> dB.</p>
<p>&nbsp;&nbsp;&nbsp;The bandwidth of a circuit is a measure for the frequency range across which it exhibits only a small amount of attenuation. For a low-pass circuit (such as the RC circuit under investigation), the bandwidth is defined as the frequency for which the magnitude has dropped by a factor of <span class="math inline">\(1/\sqrt 2\)</span> relative to its value at <span class="math inline">\(\omega = 0\)</span> (DC gain). Since <span class="math inline">\(1/\sqrt 2\)</span> corresponds to <span class="math inline">\(-3\)</span> decibels, we refer to this quantity as the 3-dB bandwidth, or symbolically</p>
<p><span id="eq-3.3"><span class="math display">\[
\omega_{3dB} = \frac{1}{RC}
\tag{3.3}\]</span></span></p>
<p>As an additional example, we will now look at the frequency response of the RC circuit with an additional resistor added in series with the capacitor <span class="math inline">\(C\)</span>, as shown in <a href="#fig-3.3" class="quarto-xref">Figure&nbsp;<span>3.3</span></a>.</p>
<div id="fig-3.3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.3.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: RC circuit with series resistor.
</figcaption>
</figure>
</div>
<p><strong><span id="example-3-2">Example 3-2</span>: RC Circuit with Additional Resistor</strong></p>
<p>Find the magnitude and phase of the voltage transfer function for the circuit in <a href="#fig-3.3" class="quarto-xref">Figure&nbsp;<span>3.3</span></a> and draw the corresponding Bode plot.</p>
<p><strong>SOLUTION</strong></p>
<p>By applying the voltage divider rule, we find</p>
<p><span class="math display">\[
\frac{v_{out}}{v_{in}} = \frac{\frac{1}{sC} + R }{\frac{1}{sC} + R + R} = \frac{1 + sRC}{1 + 2sRC}
\]</span></p>
<p>Next, we let <span class="math inline">\(s = j\omega\)</span> and obtain <!-- TYPO: omega and "and" is together  --> <span class="math display">\[
\frac{V_{out}}{V_{in}} = \left. \frac{v_{out}}{v_{in}}\right|_{s=j\omega} = \frac{1 + j\omega RC}{1 + 2 j\omega RC}
\]</span></p>
<p>and finally</p>
<p><span class="math display">\[
\left| \frac{V_{out}}{V_{in}} \right| = \sqrt{ \frac{1 + (\omega RC)^2 }{1 + 2 (\omega RC)^2}}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\angle \frac{V_{out}}{V_{in}} = \tan^{-1}(-\omega RC) + tan^{-1}(-2\omega RC)
\]</span></p>
<p>The Bode plot for these expressions is found in <a href="#fig-ex-3.2" class="quarto-xref">Figure&nbsp;<span>3.4</span></a>. As we can see, the plot is similar to the previous example in terms of the low-frequency behavior and first breakpoint. There is, however, a second breakpoint beyond which the magnitude approaches a constant value of <span class="math inline">\(–6\)</span> dB (<span class="math inline">\(= 0.5\)</span>), and the phase begins to return back to <span class="math inline">\(0^\circ\)</span>. This behavior is intuitively understood by inspection of the circuit. At high frequencies, the capacitor becomes a short, essentially leaving a resistive voltage divider. Since the resistors are of equal value, the voltage attenuation approaches <span class="math inline">\(0.5\)</span> at high frequencies. Similarly, the phase returns to <span class="math inline">\(0^\circ\)</span> because the resistive division at high frequencies has no impact on the signal’s phase.</p>
<div id="fig-ex-3.2" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ex-3.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-ex-3.2.png" id="fig-ex-3.2" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ex-3.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4
</figcaption>
</figure>
</div>
</section>
<section id="poles-and-zeros" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="poles-and-zeros"><span class="header-section-number">3.1.2</span> <span id="poles-and-zeros">Poles and Zeros</span></h3>
<p>In linear system theory, <strong>poles</strong> and <strong>zeros</strong> are the <span class="math inline">\(s\)</span>-values for which the value of the <span class="math inline">\(s\)</span>-domain transfer function becomes infinity or zero, respectively. Since the behavior of a linear system is fully determined by the location of its poles and zeros, it is desirable to factor the transfer function in the following general format:</p>
<p><span id="eq-3.4"><span class="math display">\[
H(s) = K \frac{\left( 1 - \frac{s}{z_1} \right) \left( 1 - \frac{s}{z_2} \right) \dots \left( 1 - \frac{s}{z_m} \right)}{\left( 1 - \frac{s}{p_1} \right) \left( 1 - \frac{s}{p_2} \right) \dots \left( 1 - \frac{s}{p_n} \right)}
\tag{3.4}\]</span></span></p>
<p>where <span class="math inline">\(K\)</span> is a constant DC gain term, <span class="math inline">\(p_1, p_2,... p_n\)</span> are the poles and <span class="math inline">\(z_1, z_2,..., z_m\)</span> are the zeros. For example, the <span class="math inline">\(s\)</span>-domain transfer function of <a href="#example-3-2">Example 3-2</a> is given by</p>
<p><span id="eq-3.5"><span class="math display">\[
H(s) = \frac{v_{out}}{v_{in}} = \frac{\left( 1 - \frac{s}{z_1} \right)}{\left( 1 - \frac{s}{p_1} \right)}
\tag{3.5}\]</span></span></p>
<p>where</p>
<p><span id="eq-3.6"><span class="math display">\[
z_1 = -\frac{1}{RC} \quad and \quad p_1 = -\frac{1}{2RC}
\tag{3.6}\]</span></span></p>
<p>The reason why <span class="math inline">\(p_1\)</span> and <span class="math inline">\(z_1\)</span> are called poles and zeros can be understood from the plot in <a href="#fig-3.4" class="quarto-xref">Figure&nbsp;<span>3.5</span></a>, which evaluates <a href="#eq-3.5" class="quarto-xref">Equation&nbsp;<span>3.5</span></a> using the complex argument <span class="math inline">\(s = σ+ j\omega\)</span>. At <span class="math inline">\(s = p_1\)</span>, the magnitude of <span class="math inline">\(H(s)\)</span> becomes infinite, resembling the pole of a tent holding up the 2-dimensional sheet in this representation. Likewise, at <span class="math inline">\(s = z_1\)</span>, the magnitude of <span class="math inline">\(H(s)\)</span> becomes zero; this could be viewed as pegs pinning down the tent at this particular location.</p>
<div id="fig-3.4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.4.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5: 3-D plot of the magnitude of <a href="#eq-3.5" class="quarto-xref">Equation&nbsp;<span>3.5</span></a>, evaluated for <span class="math inline">\(s = σ + j\omega\)</span>.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;Since the steady-state magnitude response of the circuit is obtained by letting <span class="math inline">\(s = j\omega\)</span>, it simply corresponds to the bold line marked at the front edge of the plot. In other words, evaluating <span class="math inline">\(H(s)\)</span> for the magnitude response corresponds to “walking” on the sheet of <a href="#fig-3.4" class="quarto-xref">Figure&nbsp;<span>3.5</span></a> along the <span class="math inline">\(\omega\)</span> axis.</p>
<p>&nbsp;&nbsp;&nbsp;As we can see from <a href="#eq-3.6" class="quarto-xref">Equation&nbsp;<span>3.6</span></a>, the poles and zeros of the example considered here are (negative) real numbers. For arbitrary ratios of polynomials in <span class="math inline">\(s\)</span>, the poles and zeros as expressed in <a href="#eq-3.4" class="quarto-xref">Equation&nbsp;<span>3.4</span></a> can be complex numbers. For all circuits considered in this module, however, the poles and zeros will be real. Furthermore, all poles will be negative, as required for a stable system. The zeros encountered in this module can be either positive or negative <a href="#eq-3.6" class="quarto-xref">as in&nbsp;<span>3.6</span></a>. A negative zero is called a <strong>left half plane (LHP) zero</strong>, since it lies on the left side of the <span class="math inline">\(s\)</span>-plane. A positive zero is called a <strong>right half plane (RHP) zero</strong>, since it lies on the right hand side of the <span class="math inline">\(s\)</span>-plane.</p>
<p>When all the poles and zeros of a system are real, it is possible to create a set of rules that allow the construction of a bode plot by inspection. These rules are summarized in the next section.</p>
</section>
<section id="bode-plots-of-arbitrary-system-functions-with-real-poles-and-zeros" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="bode-plots-of-arbitrary-system-functions-with-real-poles-and-zeros"><span class="header-section-number">3.1.3</span> <span id="bode-plots-of-arbitary-system-functions-with-real-poles-and-zeros">Bode Plots of Arbitrary System Functions with Real Poles and Zeros</span></h3>
<p>For the case of real negative poles and zeros, and letting <span class="math inline">\(s = j\omega\)</span> , <a href="#eq-3.4" class="quarto-xref">Equation&nbsp;<span>3.4</span></a> becomes</p>
<p><span id="eq-3.7"><span class="math display">\[
H(j\omega) = K \frac{\left( 1 + j\frac{\omega}{\omega_{z1}} \right) \left( 1 + j\frac{\omega}{\omega_{z2}} \right) \dots \left( 1 + j\frac{\omega}{\omega_{zm}} \right)}{\left( 1 + j\frac{\omega}{\omega_{p1}} \right) \left( 1 + j\frac{\omega}{\omega_{p2}} \right) \dots \left( 1 + j\frac{\omega}{\omega_{pn}} \right)}
\tag{3.7}\]</span></span></p>
<p>where <span class="math inline">\(\omega_{p1}, \omega_{p2},... \omega_{pn}\)</span> are the pole frequencies and <span class="math inline">\(\omega_{z1}, \omega_{z2},..., \omega_{zm}\)</span> are the zero frequencies. For instance, in <a href="#example-3-2">Example 3-2</a>, we have</p>
<p><span id="eq-3.8"><span class="math display">\[
H(j\omega) = K \frac{\left( 1 + j\frac{\omega}{\omega_{z1}} \right) }{\left( 1 + j\frac{\omega}{\omega_{p1}} \right) }
\tag{3.8}\]</span></span></p>
<p>where</p>
<p><span id="eq-3.9"><span class="math display">\[
\omega_{z1} = \frac{1}{RC} \quad and \quad \omega_{p1} = \frac{1}{2RC}
\tag{3.9}\]</span></span></p>
<p>To determine the Bode plot from <a href="#eq-3.7" class="quarto-xref">Equation&nbsp;<span>3.7</span></a>, we must assess the effect of each binomial term on the magnitude and phase of the system function. If the frequency is such that <span class="math inline">\(\omega \ll \omega_{zi}\)</span> or <span class="math inline">\(\omega_{pi}\)</span>, then the respective binomial term will have little effect on the magnitude and phase of the system function, as it will simply multiply it by unity. On the other hand, if the frequency is such that <span class="math inline">\(\omega \ll \omega_{zi}\)</span> or <span class="math inline">\(\omega_{pi}\)</span>, the system function, magnitude, and phase will be altered. To see this, we evaluate the magnitude and phase of a general binomial term for a left half plane pole or zero and <span class="math inline">\(\omega \gg \omega_i\)</span></p>
<p><span id="eq-3.10"><span class="math display">\[
\left| 1 + j\frac{\omega}{\omega_i}\right| = \sqrt{1 + \left(\frac{\omega}{\omega_i}\right)^2} \simeq \frac{\omega}{\omega_i}
\tag{3.10}\]</span></span></p>
<p><span id="eq-3.11"><span class="math display">\[
\angle \left(1+ j \frac{\omega}{\omega_i}\right) = tan^{-1} \left(\frac{\omega}{\omega_i}\right) \simeq 90^\circ
\tag{3.11}\]</span></span></p>
<p>Therefore, if the binomial term is in the numerator of the generalized system function (corresponding to a LHP zero), the magnitude will be multiplied by <span class="math inline">\({\omega}/{\omega_i}\)</span>, and a phase angle of <span class="math inline">\(90^\circ\)</span> will be added to the total phase. If the binomial term is located in the denominator (LHP pole), the magnitude will be multiplied by <span class="math inline">\(1/({\omega}/{\omega_i})\)</span> and a phase angle of <span class="math inline">\(90^\circ\)</span> will be subtracted from the total phase. For a RHP zero, it follows that the magnitude will be multiplied by <span class="math inline">\({\omega}/{\omega_i}\)</span>, and a phase angle of <span class="math inline">\(90^\circ\)</span> will be subtracted from the total phase.</p>
<p>&nbsp;&nbsp;&nbsp;When <span class="math inline">\(\omega = \omega_i\)</span>, the magnitude and phase are</p>
<p><span id="eq-3.12"><span class="math display">\[
\left| 1 + j\frac{\omega}{\omega_i}\right| = |1+j| = \sqrt 2
\tag{3.12}\]</span></span></p>
<p><span id="eq-3.13"><span class="math display">\[
\angle (1+j) = 45^\circ
\tag{3.13}\]</span></span></p>
<p>Therefore, if these binomial terms for the breakpoints are located in the numerator, the magnitude of the system function in the numerator is multiplied by <span class="math inline">\(\sqrt 2\)</span> and a phase of <span class="math inline">\(45^\circ\)</span> is added to (for a LHP zero) or subtracted from (for a RHP zero) the overall phase. If it is located in the denominator, the magnitude is multiplied by <span class="math inline">\(1/\sqrt 2\)</span> and a phase of <span class="math inline">\(45^\circ\)</span> is subtracted from the overall phase of the system function.</p>
<p>&nbsp;&nbsp;&nbsp;Given these results, a Bode plot can be constructed by referring to the following step-by-step procedure.</p>
<ul>
<li>Identify all the breakpoint frequencies <span class="math inline">\(\omega_{pi}\)</span> and <span class="math inline">\(\omega_{zi}\)</span> and list them in increasing order. Apply the following rules, beginning with the lowest breakpoint frequency.</li>
<li>If the corresponding binomial term appears in the numerator of the system function, the magnitude slope will be increased by <span class="math inline">\(20\)</span> dB/decade, when the frequency is greater than the breakpoint frequency.</li>
<li>If the corresponding binomial term appears in the denominator of the system function, the magnitude of the slope will be reduced by <span class="math inline">\(20\)</span> dB/decade when the frequency is greater than the breakpoint frequency.</li>
<li>To plot the phase, we know that the binomial term will contribute <span class="math inline">\(+45^\circ\)</span> for a LHP zero, and <span class="math inline">\(-45^\circ\)</span> for a RHP zero at <span class="math inline">\(\omega= \omega_i\)</span>. If it is in the denominator, it will contribute <span class="math inline">\(-45^\circ\)</span>. We assume that the <span class="math inline">\(\pm 90^\circ\)</span> phase changes linearly over the interval <span class="math inline">\(0.1\omega i &lt; \omega &lt; 10\omega_i\)</span>.</li>
</ul>
<p><strong><span id="example-3-3">Example 3-3</span>: Bode Plot Construction</strong></p>
<p>Construct a Bode plot for a system with the following parameters: <span class="math inline">\(K = 100\)</span>, <span class="math inline">\(\omega_{p1} = 10\)</span> <span class="math inline">\(rad/s\)</span>, <span class="math inline">\(\omega_{p2}\)</span> = <span class="math inline">\(100\)</span> <span class="math inline">\(krad/s\)</span>, left half plane zero: <span class="math inline">\(\omega_{z1}\)</span> = <span class="math inline">\(1\)</span> <span class="math inline">\(krad/s\)</span>, right half plane zero: <span class="math inline">\(\omega_{z2}\)</span> = <span class="math inline">\(10\)</span> <span class="math inline">\(Mrad/s\)</span>.</p>
<p><strong>SOLUTION</strong></p>
<p>First we note that the DC gain <span class="math inline">\(K = 100 = 40\)</span> dB. Next we recognize that <span class="math inline">\(\omega_{p1}\)</span> is the lowest frequency term, creating a change of slope in the magnitude plot toward <span class="math inline">\(–20\)</span> dB/decade. The phase is <span class="math inline">\(0^\circ\)</span> at the lowest frequency plotted, <span class="math inline">\(-45^\circ\)</span> at <span class="math inline">\(\omega_{p1}\)</span> and has reached <span class="math inline">\(-90^\circ\)</span> at approximately <span class="math inline">\(10\)</span> <span class="math inline">\(\omega_{p1}\)</span>. Applying the given rules in a similar fashion to the remaining poles and zeros yields the Bode plot shown in <a href="#fig-ex-3.3" class="quarto-xref">Figure&nbsp;<span>3.6</span></a>.</p>
<div id="fig-ex-3.3" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ex-3.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-ex-3.3.png" id="fig-ex-3.3" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ex-3.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.6
</figcaption>
</figure>
</div>
</section>
</section>
<section id="frequency-response-of-the-common-source-voltage-amplifier-first-pass-analysis" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="frequency-response-of-the-common-source-voltage-amplifier-first-pass-analysis"><span class="header-section-number">3.2</span> <span id="frequency-response-of-the-common-source-voltage-amplifier-first-pass-analysis">Frequency Response of the Common-Source Voltage Amplifier — First-Pass Analysis</span></h2>
<p>We now wish to apply the analysis tools reviewed in the previous section to get a handle on the frequency response of the common-source voltage amplifier discussed in <a href="partI.2.html">Chapter 2</a>. Since the exact frequency behavior of this circuit is quite complex when taking all aspects into account, we partition this discussion into two steps. This section presents the first analysis step and uses the simplest possible model extension for the MOSFET that can be used to take capacitive effects, and thus frequency dependence, into account.</p>
<p>&nbsp;&nbsp;&nbsp;In the context of MOSFET capacitance modeling, it is useful to distinguish between intrinsic and extrinsic capacitances. Here, the term extrinsic refers to capacitances that are not needed to operate a MOSFET, but rather exist due to limitations or properties of a certain device structure or manufacturing process. As we shall see in <a href="#frequency-response-of-the-common-source-voltage-amplifier-second-pass-analysis">Section 3-3</a>, stray capacitances between the gate and source/drain terminals are examples of extrinsic capacitors. Intrinsic capacitance is unavoidable and required to operate the device. The oxide capacitance of a MOSFET falls into this category: without a capacitance between the gate and channel, no mobile charges can be induced (<span class="math inline">\(Q = CV\)</span>), and the MOSFET would not function. In this section, we will look at frequency dependence effects due to the intrinsic capacitance only, beginning with a derivation of a circuit model that can be used to model this capacitance in the frequency response calculations.</p>
<section id="modeling-intrinsic-mosfet-capacitance" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="modeling-intrinsic-mosfet-capacitance"><span class="header-section-number">3.2.1</span> <span id="modeling-intrinsic-mosfet-capacitance">Modeling Intrinsic MOSFET Capacitance</span></h3>
<p>Just as in the derivation of device transconductance and output conductance, the operating point must be considered when calculating small-signal capacitances. We begin by analyzing the intrinsic capacitance of a MOSFET in the triode region, with its cross-section shown in <a href="#fig-3.5" class="quarto-xref">Figure&nbsp;<span>3.7</span></a>(a). To first-order, the gate and the conductive channel can be viewed as a parallel plate capacitor, resulting in a gate-to-channel capacitance of</p>
<p><span id="eq-3.14"><span class="math display">\[
C_{gc} = WL \frac{\epsilon_{ox}}{t_{ox}} = WLC_{ox}
\tag{3.14}\]</span></span></p>
<p>where <span class="math inline">\(WL\)</span> is the capacitor plate area and <span class="math inline">\(C_{ox}\)</span> is the oxide capacitance per unit area.</p>
<div id="fig-3.5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.5.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.7: (a) MOSFET cross-section showing the intrinsic capacitance between the gate and the channel (<span class="math inline">\(C_{gc}\)</span>). (b) Capacitance model for the triode region.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;If the source and drain were connected together, the small signal capacitance from the gate to source/drain would be equal to <span class="math inline">\(C_{gc}\)</span> as given in <a href="#eq-3.14" class="quarto-xref">Equation&nbsp;<span>3.14</span></a>. How can we model the capacitance when source and drain are not connected, i.e., how is the capacitance distributed between the two terminals?</p>
<p>&nbsp;&nbsp;&nbsp;A common first-order approximation is to assign half of <span class="math inline">\(C_{gc}\)</span> to the capacitance between the gate and the source and the remaining half between the gate and the drain. This is schematically illustrated in <a href="#fig-3.5" class="quarto-xref">Figure&nbsp;<span>3.7</span></a>(b). A qualitative argument that supports this approximation is that small changes in either the drain or source voltage must induce the same change in charge at the gate; therefore, the capacitance must be split equally.</p>
<p>&nbsp;&nbsp;&nbsp;A case that is more relevant to the analysis of a common-source stage is the behavior in the saturation region. For this case, we know that the conductive channel does not extend all the way from the source to the drain, but is pinched off at some coordinate <span class="math inline">\(L – ΔL\)</span>. When the channel is pinched-off, the drain potential (to first-order) no longer influences the charge under the gate. Therefore, the intrinsic capacitance from the gate to the drain is approximately zero in this region of operation.</p>
<p>&nbsp;&nbsp;&nbsp;In saturation, the channel charge is therefore controlled primarily by the potential between the gate and the source, and a significant capacitance is present between these two terminals. At first glance, one might expect that <span class="math inline">\(C_{gs}\)</span> is equal to <span class="math inline">\(C_{gc}\)</span>. However, this is not quite correct due to the pinch-off effect. Imagine applying a small voltage change to the source terminal. This will change the voltage across the oxide (and charge) near the source, but at the pinch-off point, the voltage across the oxide remains at <span class="math inline">\(V_{Tn}\)</span>. This means that the capacitance in the saturation egion must be less than <span class="math inline">\(C_{gc}\)</span>, because the charge does not see a uniform change as in the case of a simple parallel plate capacitor. Further analysis (see <a href="#reference-3.1">Reference 1</a>) reveals that the capacitance between the gate and the source in the saturation region is given by</p>
<p><span id="eq-3.15"><span class="math display">\[
C_{gs} = \frac{2}{3} C_{gc} = \frac{2}{3}WLC_{ox}
\tag{3.15}\]</span></span></p>
<p>The resulting small-signal MOSFET model that includes this capacitance is shown in <a href="#fig-3.6" class="quarto-xref">Figure&nbsp;<span>3.8</span></a>.</p>
<div id="fig-3.6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.6.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.8: MOSFET small-signal model for the saturation region, including the intrinsic gate capacitance.
</figcaption>
</figure>
</div>
</section>
<section id="frequency-response-with-intrinsic-gate-capacitance" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="frequency-response-with-intrinsic-gate-capacitance"><span class="header-section-number">3.2.2</span> <span id="frequency-response-with-intrinsic-gate-capacitance">Frequency Response with Intrinsic Gate Capacitance</span></h3>
<p>To analyze the frequency response of the common-source amplifier with the intrinsic gate capacitance, we insert the model of <a href="#fig-3.6" class="quarto-xref">Figure&nbsp;<span>3.8</span></a> into the small-signal circuit model of the amplifier, as shown in <a href="#fig-3.7" class="quarto-xref">Figure&nbsp;<span>3.9</span></a>.</p>
<div id="fig-3.7" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.7.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.9: (a) Common-source amplifier driven by a transducer with finite source resistance. (b) Small-signal model with the intrinsic gate capacitance.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;Note that if the circuit were driven by an ideal voltage source at its input port (<span class="math inline">\(v_{in}\)</span>), the added capacitance would have no effect on the circuit’s operation. The ideal voltage source would provide any current that is needed to charge and discharge the gate capacitance without introducing any frequency dependence. The model in <a href="#fig-3.7" class="quarto-xref">Figure&nbsp;<span>3.9</span></a> therefore considers a more realistic input source with finite resistance (<span class="math inline">\(R_s\)</span>). At this point in the analysis, we purposely do not include any capacitive loading at the output of the amplifier, primarily to keep the first pass analysis simple and transparent.</p>
<p>&nbsp;&nbsp;&nbsp; In order to analyze the frequency response of the circuit in <a href="#fig-3.7" class="quarto-xref">Figure&nbsp;<span>3.9</span></a>, we first realize that the overall transfer function can be split into a product of two terms</p>
<p><span id="eq-3.16"><span class="math display">\[
\frac{v_{out}}{v_s} = \frac{v_{out}}{v_{in}} \cdot \frac{v_{in}}{v_s}
\tag{3.16}\]</span></span></p>
<p>In this expression, the first term on the right-hand side corresponds to the DC voltage gain given in <a href="partI.2.html#eq-2.51" class="quarto-xref">Equation&nbsp;<span>2.51</span></a>, and is equal to <span class="math inline">\(–g_mR_{out}\)</span>. The second term can be found by writing the voltage divider expression that relates node <span class="math inline">\(v_{in}\)</span> to <span class="math inline">\(v_s\)</span></p>
<p><span id="eq-3.17"><span class="math display">\[
\frac{v_{in}}{v_s} = \frac{\frac{1}{sC_{gs}}}{\frac{1}{sC_{gs}} + R_s} = \frac{1}{1+ sR_sC_{gs}}
\tag{3.17}\]</span></span></p>
<p>With this result, the complete s-domain transfer function from the input source to the output becomes</p>
<p><span id="eq-3.18"><span class="math display">\[
A_v(s) = \frac{v_{out}}{v_s} = \frac{-g_mR_{out}}{1 + sR_sC_{gs}} = \frac{A_{v0}}{1+ sR_sC_{gs}}
\tag{3.18}\]</span></span></p>
<p>where <span class="math inline">\(A_{v0}\)</span> = <span class="math inline">\(A_v(0)\)</span> is a generalized placeholder for the DC gain of the circuit. From this result, we see that the transfer function has a DC gain corresponding to the result of <a href="partI.2.html">Chapter 2</a>, and a single pole that is set by the source resistance and the intrinsic gate capacitance. As explained in <a href="#review-of-frequency-domain-analysis">Section 3-1</a>, we can now evaluate this transfer function for steady-state sinusoids by letting <span class="math inline">\(s = j\omega\)</span> . This will allow us to draw a Bode plot and compute the bandwidth of the circuit.</p>
<p><strong><span id="example-3-4">Example 3-4</span>: Common-Source Amplifier Bandwidth Calculation</strong></p>
<p>Calculate the 3-dB bandwidth for the amplifier in <a href="#fig-3.7" class="quarto-xref">Figure&nbsp;<span>3.9</span></a>, assuming <span class="math inline">\(W\)</span> = <span class="math inline">\(20 μm\)</span>, <span class="math inline">\(L\)</span> = <span class="math inline">\(1 μm\)</span>, <span class="math inline">\(C_{ox}\)</span> = <span class="math inline">\(2.3\)</span> <span class="math inline">\(fF/μm^2\)</span> and <span class="math inline">\(R_s = 50\)</span> <span class="math inline">\(k\Omega\)</span>. Express the result in units of Hertz.</p>
<p><strong>SOLUTION</strong></p>
<p>For the given parameters, the gate-source capacitance is</p>
<p><span class="math display">\[
C_{gs} = \frac{2}{3} WLC_{ox} = 30.67 fF
\]</span></p>
<p>The 3-dB bandwidth is</p>
<p><span class="math display">\[
\omega_{3dB} = \frac{1}{R_sC_{gs}} = 652.3 Mrad/s
\]</span></p>
<p>and therefore <!-- TYPO there is a dot after therefore in the book --></p>
<p><span class="math display">\[
f_{3dB} = \frac{\omega_{3dB}}{2\pi} = 103.8 MHz
\]</span></p>
<!-- TYPO hz unit changed to Hz -->
<p>&nbsp;&nbsp;&nbsp;An important question to ask at this point of the discussion is whether there is anything we can do to maximize the bandwidth of our amplifier. Assuming that we cannot change the source resistance <span class="math inline">\(R_s\)</span>, the only remaining option is to minimize <span class="math inline">\(C_{gs}\)</span>. This can be achieved by choosing a smaller transistor width or length [see <a href="#eq-3.15" class="quarto-xref">Equation&nbsp;<span>3.15</span></a>]. How will this affect the other performance metrics in the circuit? In the next subsection, we will show that there exists a direct tradeoff in the achievable bandwidth versus supply current for the circuit in consideration.</p>
</section>
<section id="tradeoff-between-bandwidth-and-supply-current" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="tradeoff-between-bandwidth-and-supply-current"><span class="header-section-number">3.2.3</span> <span id="tradeoff-between-bandwidth-and-supply-current">Tradeoff Between Bandwidth and Supply Current</span></h3>
<p>Consider a design problem involving the circuit of <a href="#fig-3.7" class="quarto-xref">Figure&nbsp;<span>3.9</span></a> and assume that the general objective is to maximize the circuit’s 3-dB bandwidth while minimizing the transistor’s drain current. For this analysis, we assume that <span class="math inline">\(R_s\)</span>, <span class="math inline">\(R_{out}\)</span> and <span class="math inline">\(A_{v0}\)</span> are given through specifications, and that these parameters cannot be varied. This assumption is not atypical in practical circuit design. <span class="math inline">\(R_s\)</span> might be fixed by the physical properties of the input transducer. <span class="math inline">\(R_{out}\)</span> could be set by an output resistance requirement that allows the circuit to interface with subsequent circuit stages, while the DC gain <span class="math inline">\(A_{v0}\)</span> could be determined by application requirements. Furthermore, for simplicity, we neglect channel-length-modulation in this analysis.</p>
<p>&nbsp;&nbsp;&nbsp;In order to study the tradeoff between bandwidth and current consumption, we will now write expressions for these quantities that rely on common parameters. For the 3-dB bandwidth, we begin by inserting <a href="#eq-3.15" class="quarto-xref">Equation&nbsp;<span>3.15</span></a> into <a href="#eq-3.15" class="quarto-xref">Equation&nbsp;<span>3.15</span></a> and obtain</p>
<p><span id="eq-3.19"><span class="math display">\[
\omega_{3dB} = \frac{3}{2} \cdot \frac{1}{R_sWLC_{ox}}
\tag{3.19}\]</span></span></p>
<p>By using the following expression to eliminate <span class="math inline">\(C_{ox}\)</span>:</p>
<p><span id="eq-3.20"><span class="math display">\[
g_m = \mu_n C_{ox} \frac{W}{L}(V_{GS}-V_{Tn}) = \mu_n C_{ox} \frac{W}{L}V_{OV}
\tag{3.20}\]</span></span></p>
<p>and subsequently substituting <span class="math inline">\(g_m = |A_{v0}| / R_{out}\)</span>, <a href="#eq-3.19" class="quarto-xref">Equation&nbsp;<span>3.19</span></a> becomes</p>
<p><span id="eq-3.21"><span class="math display">\[
\omega_{3dB} = \frac{3}{2} \cdot \frac{\mu_n}{L^2}\cdot \frac{1}{|A_{v0}|} \cdot \frac{R_{out}}{R_s} \cdot V_{OV}
\tag{3.21}\]</span></span></p>
<p>The above expression is now in a form that contains only technology parameters, design constraints (<span class="math inline">\(R_s,
R_{out}\)</span>,and <span class="math inline">\(A_{v0}\)</span>) and the gate overdrive voltage <span class="math inline">\(V_{OV}\)</span> as a single design parameter. From this result, it is clear that in order to maximize bandwidth, we would like to use a technology that offers high mobility and short channels. The mobility is largely determined by material properties, while <span class="math inline">\(L\)</span> is usually bounded by some <span class="math inline">\(L = L_{min}\)</span> that is specific to a certain process technology, for example, <span class="math inline">\(1\)</span> <span class="math inline">\(\mu m\)</span> for the transistors used in this module.</p>
<p>&nbsp;&nbsp;&nbsp;From <a href="#eq-3.21" class="quarto-xref">Equation&nbsp;<span>3.21</span></a>, we also see that we should maximize <span class="math inline">\(V_{OV}\)</span>. However, a potential problem with this is due to the output signal range of the amplifier. As we know from <a href="partI.2.html">Chapter 2</a>, larger <span class="math inline">\(V_{OV}\)</span> means that <span class="math inline">\(V_{DSsat}\)</span> is also increased, and this means that the transistor enters the triode region at higher <span class="math inline">\(v_{OUT}\)</span>. This could lead to clipping, as discussed previously.</p>
<p>An additional, and more fundamental issue relates to the current consumption of the circuit. To see this, we rewrite <a href="partI.2.html#eq-2.31" class="quarto-xref">Equation&nbsp;<span>2.31</span></a> as</p>
<p><span id="eq-3.22"><span class="math display">\[
I_D = \frac{1}{2} \cdot g_m \cdot V_{OV}
\tag{3.22}\]</span></span></p>
<p>and substitute <span class="math inline">\(g_m = |A_v| / R_{out}\)</span> to find</p>
<p><span id="eq-3.23"><span class="math display">\[
I_D = \frac{1}{2} \cdot \frac{|A_{v0}|}{R_{out}} \cdot V_{OV}
\tag{3.23}\]</span></span></p>
<p>This result shows that a larger <span class="math inline">\(V_{OV}\)</span> unfortunately requires a larger bias current for the transistor, and this is highly undesired in many applications, as for instance battery-powered devices.</p>
<p>&nbsp;&nbsp;&nbsp;While the above-observed tradeoff was discovered in the context of a particular circuit example, we will see throughout this module that the same tradeoff holds for all analog circuits. For a given technology and target specifications, current consumption directly scales with the circuit’s 3-dB bandwidth requirements. An alternative, and more general way to capture the fundamental connection between supply current and bandwidth is to inspect the tradeoffs that pertain to the MOSFET in isolation of a specific circuit example, as discussed next.</p>
<p>&nbsp;&nbsp;&nbsp;To begin, note that the model in <a href="#fig-3.6" class="quarto-xref">Figure&nbsp;<span>3.8</span></a> comes with “desired” and “undesired” elements and properties. The only aspect of the transistor that we value is its transconductance. The associated intrinsic capacitance and the supply current needed to create the transconductance are undesired. Mathematically, we can identify the following figures of merit that capture the ratios between the desired and undesired quantities, in particular:</p>
<p><span id="eq-3.24"><span class="math display">\[
\frac{g_m}{I_D}= \frac{2}{V_{OV}} \propto \frac{1}{\sqrt I_D}
\tag{3.24}\]</span></span></p>
<p>and</p>
<p><span id="eq-3.25"><span class="math display">\[
\frac{g_m}{C_{gs}} = \frac{3}{2} \cdot \frac{\mu_n}{L^2} \cdot V_{OV} \propto \sqrt I_D
\tag{3.25}\]</span></span></p>
<p>The transconductance-to-current ratio, which is sometimes called the transconductance efficiency, deteriorates for larger <span class="math inline">\(V_{OV}\)</span> (and larger <span class="math inline">\(I_D\)</span>). On the other hand, the ratio of transconductance per intrinsic capacitance improves for larger <span class="math inline">\(V_{OV}\)</span> (and larger <span class="math inline">\(I_D\)</span>). This tradeoff is graphically illustrated in <a href="#fig-3.8" class="quarto-xref">Figure&nbsp;<span>3.10</span></a>. Note that as already pointed out in <a href="partI.2.html#modeling-bounds-for-the-gate-overdrive-voltage">Section 2-2-7</a>, the proportionality of <span class="math inline">\(g_m/I_D\)</span> to <span class="math inline">\(1/V_{OV}\)</span> extends only down to a certain minimum gate overdrive, defined as <span class="math inline">\(V_{OVmin}\)</span> in this module [see <a href="partI.2.html#eq-2.35" class="quarto-xref">Equation&nbsp;<span>2.35</span></a>].</p>
<div id="fig-3.8" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.8.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.10: Tradeoff between <span class="math inline">\(g_m / I_D\)</span> and <span class="math inline">\(g_m / C_{gs}\)</span>.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;In essence, the gate overdrive voltage <span class="math inline">\(V_{OV}\)</span> can be considered as a “knob” that lets us adjust the tradeoff between the two figures of merit. For a chosen <span class="math inline">\(V_{OV}\)</span> and channel length, <span class="math inline">\(g_m / I_D\)</span> and <span class="math inline">\(g_m / C_{gs}\)</span> are fixed, and these parameters directly affect the speed and current consumption of the overall circuit. The gate overdrive <span class="math inline">\(V_{OV}\)</span> has therefore been recognized by designers as an important parameter that affects most of the tradeoffs encountered in the optimization of a given circuit (see <a href="#reference-3.2">Reference 2</a>). We will see examples of this throughout this module.</p>
<p>Interestingly, the product of the two figures of merit in <a href="#eq-3.24" class="quarto-xref">Equation&nbsp;<span>3.24</span></a> and <a href="#eq-3.25" class="quarto-xref">Equation&nbsp;<span>3.25</span></a> is given by</p>
<p><span id="eq-3.26"><span class="math display">\[
\frac{g_m}{C_{gs}} \cdot \frac{g_m}{I_D} = 3 \cdot \frac{\mu_n}{L^2}
\tag{3.26}\]</span></span></p>
<p>From this result, it is clear that for high speed and low current consumption, the best we can hope for is a technology that provides high mobility and short channels. In this context, it is interesting to note that improvements in device engineering and manufacturing processes have provided tremendous improvements in manufacturable channel lengths. Since the 1970s, <span class="math inline">\(L_{min}\)</span> has been improved from <span class="math inline">\(10\)</span> <span class="math inline">\(\mu m\)</span> to approximately <span class="math inline">\(22\)</span> <span class="math inline">\(nm\)</span> today; a <span class="math inline">\(~400x\)</span> reduction!</p>
</section>
<section id="transit-frequency" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="transit-frequency"><span class="header-section-number">3.2.4</span> <span id="transit-frequency">Transit Frequency</span></h3>
<p>The figure of merit given in <a href="#eq-3.25" class="quarto-xref">Equation&nbsp;<span>3.25</span></a> is also known as the <strong>transit frequency</strong> of the transistor and coincidentally quantifies the frequency for which the magnitude of the transistor’s current gain drops to unity. To determine the transit frequency, the transistor is operated in the common-source configuration and the input is driven by an ideal current source (see <a href="#fig-3.9" class="quarto-xref">Figure&nbsp;<span>3.11</span></a>). The output is short-circuited, and the current gain <span class="math inline">\(i_{out}/i_{in}\)</span> is measured.</p>
<div id="fig-3.9" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.9.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.11: Small-signal circuit model for finding the MOSFET’s transit frequency.
</figcaption>
</figure>
</div>
<p>From the circuit, it follows that</p>
<p><span id="eq-3.27"><span class="math display">\[
i_{out} = g_m \cdot v_{gs} = g_m \cdot \frac{i_{in}}{sC_{gs}}
\tag{3.27}\]</span></span></p>
<p>Substituting <span class="math inline">\(s = j\omega\)</span> and rearranging yields</p>
<p><span id="eq-3.28"><span class="math display">\[
\frac{I_{out}}{I_{in}} = \frac{g_m}{j\omega C_{gs}}
\tag{3.28}\]</span></span></p>
<p>The transit frequency then follows by setting</p>
<p><span id="eq-3.29"><span class="math display">\[
\left| \frac{I_{out}}{I_{in}}\right| = 1 =  \frac{g_m}{\omega_T C_{gs}}
\tag{3.29}\]</span></span></p>
<p>and therefore</p>
<p><span id="eq-3.30"><span class="math display">\[
\omega_T = \frac{g_m}{C_{gs}} \propto \sqrt{I_D}
\tag{3.30}\]</span></span></p>
<p>The above quantity represents the transit frequency in rad/s. The symbol for the corresponding quantity in units of Hertz is <span class="math inline">\(f_T = \omega_T/2\pi\)</span>.</p>
<p>&nbsp;&nbsp;&nbsp;The transit frequency gives the designer a feel for the maximum frequency at which a circuit can operate. The bandwidth of most practical circuit configurations is limited to a fraction of <span class="math inline">\(\omega_T\)</span>, often about one order of magnitude below.</p>
</section>
</section>
<section id="frequency-response-of-the-common-source-voltage-amplifier-second-pass-analysis" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="frequency-response-of-the-common-source-voltage-amplifier-second-pass-analysis"><span class="header-section-number">3.3</span> <span id="frequency-response-of-the-common-source-voltage-amplifier-second-pass-analysis">Frequency Response of the Common-Source Voltage Amplifier— Second-Pass Analysis</span></h2>
<p>We will now extend the results from the previous section to obtain a more accurate understanding of the frequency response of a realistic common-source amplifier. To begin, we will extend the MOSFET model to include extrinsic capacitances.</p>
<section id="modeling-extrinsic-mosfet-capacitance" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="modeling-extrinsic-mosfet-capacitance"><span class="header-section-number">3.3.1</span> <span id="modeling-extrinsic-mosfet-capacitance">Modeling Extrinsic MOSFET Capacitance</span></h3>
<p><a href="#fig-3.10" class="quarto-xref">Figure&nbsp;<span>3.12</span></a> shows the cross section of a MOSFET device for further study of its associated capacitive elements. The first component of extrinsic capacitance that we will consider is called <strong>overlap capacitance</strong>; it is due to overlap of the source and drain diffusions and the gate and the contribution of the fringe electric fields from the gate. The overlap capacitance <span class="math inline">\(C_{ov}\)</span> is quantified as a linear capacitance proportional to the gate width, with units of <span class="math inline">\(fF/\mu m\)</span>.</p>
<div id="fig-3.10" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.10.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.12: MOSFET cross section in saturation showing the overlap and fringe contributions to <span class="math inline">\(C_{ov}\)</span>. The source-bulk and drain-bulk depletion capacitances are also shown qualitatively.
</figcaption>
</figure>
</div>
<p>With overlap capacitance included, the total gate-source capacitance in saturation is the sum of <a href="#eq-3.15" class="quarto-xref">Equation&nbsp;<span>3.15</span></a> and the overlap capacitance</p>
<p><span id="eq-3.31"><span class="math display">\[
C_{gs} = \frac{2}{3} WLC_{ox} + WC_{OV}
\tag{3.31}\]</span></span></p>
<p>&nbsp;&nbsp;&nbsp; Since the drain has no influence on the channel charge, the only contribution to the gate-drain capacitance is <span class="math inline">\(C_{OV}\)</span></p>
<p><span id="eq-3.32"><span class="math display">\[
C_{gd} =  WC_{OV}
\tag{3.32}\]</span></span></p>
<p>&nbsp;&nbsp;&nbsp;In addition to the overlap capacitance, other extrinsic capacitance components are due to the reverse-biased junctions of the MOSFET. The drain-bulk and source-bulk capacitances <span class="math inline">\(C_{db}\)</span> and <span class="math inline">\(C_{sb}\)</span> indicated in <a href="#fig-3.10" class="quarto-xref">Figure&nbsp;<span>3.12</span></a> originate from charge storage in the depletion regions between the drain and source n+ regions and the p-type bulk. The following expressions can be used to estimate these capacitances (see <a href="#reference-3.1">Reference 1</a> for a derivation):</p>
<p><span id="eq-3.33"><span class="math display">\[
C_{db} = \frac{C_J \cdot AD}{(1+ V_{DB}/PB)^{MJ}} = \frac{C_{JSW} \cdot PD}{(1+ V_{DB}/PB)^{MJSW}}
\tag{3.33}\]</span></span></p>
<p><span id="eq-3.34"><span class="math display">\[
C_{sb} = \frac{C_J \cdot AS}{(1+ V_{SB}/PB)^{MJ}} = \frac{C_{JSW} \cdot PS}{(1+ V_{SB}/PB)^{MJSW}}
\tag{3.34}\]</span></span></p>
<p>In these expressions, <span class="math inline">\(V_{DB}\)</span> and <span class="math inline">\(V_{SB}\)</span> are the reverse bias voltages of the junctions at the operating point. Note that with increasing reverse bias, the values of the junction capacitances decreases. The geometry parameters used in the expressions are related to the layout of the transistor as shown in <a href="#fig-3.11" class="quarto-xref">Figure&nbsp;<span>3.13</span></a>.</p>
<ul>
<li><p>AD = Drain area</p></li>
<li><p>AS = Source area</p></li>
<li><p>PD = Perimeter of the drain diffusion (not including the edge under the gate)</p></li>
<li><p>PS = Perimeter of the source diffusion (not including the edge under the gate)</p></li>
</ul>
<p>All other parameters are defined in <a href="#tbl-3.1">Table 3-1</a> along with the technology parameters introduced thus far.</p>
<div id="fig-3.11" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.11.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.13: Geometry parameters used for the calculation of junction capacitances.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;The extrinsic capacitances discussed above are added to the MOSFET small signal model as shown in <a href="#fig-3.12" class="quarto-xref">Figure&nbsp;<span>3.14</span></a>. For completeness, this model contains an additional capacitance <span class="math inline">\(C_{gb}\)</span> between gate and bulk. This capacitance is due to the overlap of the polysilicon gate onto the field oxide region that isolates the MOSFET, as well as field lines from the gate terminating in the bulk of the transistor through the channel. This capacitance is usually small, and we will neglect it throughout this module.</p>
<p>&nbsp;&nbsp;&nbsp; Last, it is important to note that we have only modeled capacitances associated with the MOSFET, that is, the device without interconnections. The parasitic capacitances of the interconnections between MOSFETs can be a limiting factor and must be estimated from the layout and cross section for accurate analysis of a design. Off-chip wiring and package capacitances are also critical for evaluating the performance of any integrated circuit.</p>
</section>
<section id="transit-frequency-with-extrinsic-capacitances" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="transit-frequency-with-extrinsic-capacitances"><span class="header-section-number">3.3.2</span> <span id="transit-frequency-with-extrensic-capacitances">Transit Frequency with Extrinsic Capacitances</span></h3>
<p>With extrinsic capacitances included in the model, the transit frequency expression of <a href="#eq-3.30" class="quarto-xref">Equation&nbsp;<span>3.30</span></a> modifies to</p>
<p><span id="eq-3.35"><span class="math display">\[
\omega_T = \frac{g_m}{C_{gs} + C_{gd}}
\tag{3.35}\]</span></span></p>
<p>This can be seen by inserting the model of <a href="#fig-3.12" class="quarto-xref">Figure&nbsp;<span>3.14</span></a> into the test setup of <a href="#fig-3.12" class="quarto-xref">Figure&nbsp;<span>3.14</span></a>. <span class="math inline">\(C_{sb}\)</span> and <span class="math inline">\(C_{db}\)</span> are shorted to ground (assuming the bulk terminal is also grounded), while <span class="math inline">\(C_{gd}\)</span> appears in parallel with <span class="math inline">\(C{gs}\)</span>.</p>
<div id="fig-3.12" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.12.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.14: Small-signal model for the n-channel MOSFET in saturation, including intrinsic and extrinsic capacitances.
</figcaption>
</figure>
</div>
<p><strong><span id="example-3-5">Example 3-5</span>: Mosfet Capacitance Calculation</strong></p>
<p>Consider an n-channel MOSFET biased in saturation with <span class="math inline">\(V_{DS}\)</span> = <span class="math inline">\(2.5\)</span> <span class="math inline">\(V\)</span>, <span class="math inline">\(I_D\)</span> = <span class="math inline">\(500\)</span> <span class="math inline">\(\mu A\)</span>, <span class="math inline">\(L\)</span>= <span class="math inline">\(1\)</span> <span class="math inline">\(\mu m\)</span>, and <span class="math inline">\(W\)</span>= <span class="math inline">\(20\)</span> <span class="math inline">\(\mu m\)</span>. Determine all the capacitances in the small-signal model of <a href="#fig-3.12" class="quarto-xref">Figure&nbsp;<span>3.14</span></a>, except the gate-bulk capacitance <span class="math inline">\(C_{gb}\)</span> that we consider negligible. Also calculate the transistor’s transit frequency. Use the standard technology parameters defined in <a href="#tbl-3.1">Table 3-1</a>.</p>
<p><strong>SOLUTION</strong></p>
<p>Substituting <span class="math inline">\(C_{ox}\)</span> and <span class="math inline">\(C_{ov}\)</span> = <span class="math inline">\(0.5\)</span> <span class="math inline">\(fF/\mu m\)</span> into <a href="#eq-3.31" class="quarto-xref">Equation&nbsp;<span>3.31</span></a>, together with the MOSFET dimensions, we find</p>
<p><span class="math display">\[
C_{gs} = \frac{2}{3}(20 \cdot 1\mu m^2)\left(2.3\frac{fF}{\mu m^2}\right) + 20\mu m\left(0.5\frac{fF}{\mu m}\right)
\]</span></p>
<p><span class="math display">\[
= 40.7fF
\]</span></p>
<p>For the gate-drain capacitance, we obtain</p>
<p><span class="math display">\[
C_{gd} = 20 \mu m \left(0.5 \frac{fF}{\mu m}\right) = 10 fF
\]</span></p>
<p>The remaining capacitances are the pn junction depletion capacitances <span class="math inline">\(C_{db}\)</span> between the n+ drain and the substrate and <span class="math inline">\(C_{sb}\)</span> between the n+ source and the substrate. Evaluating <a href="#eq-3.34" class="quarto-xref">Equation&nbsp;<span>3.34</span></a>, using the source junction bias voltage of <span class="math inline">\(V_{SB}\)</span> = <span class="math inline">\(0\)</span> <span class="math inline">\(V\)</span> yields</p>
<p><span class="math display">\[
C_{sb} = 19fF
\]</span></p>
<p>The drain junction has a bias voltage of <span class="math inline">\(V_{DB}\)</span> = <span class="math inline">\(V_{OUT}\)</span> = <span class="math inline">\(2.5\)</span> <span class="math inline">\(V\)</span>. Evaluating <a href="#eq-3.33" class="quarto-xref">Equation&nbsp;<span>3.33</span></a> with this value and the given parameters gives</p>
<!-- TYPO before "Evaluating" there is a , instead of a "." . Corrected in here -->
<p><span class="math display">\[
C_{db} = 11.6fF
\]</span></p>
<p>Note that <span class="math inline">\(C_{db}\)</span> is smaller than <span class="math inline">\(C_{sb}\)</span> due to the larger reverse bias across the drain-bulk junction. To calculate the transit frequency, we first compute <span class="math inline">\(g_m\)</span> using</p>
<p><span class="math display">\[
g_m = \sqrt {2\mu_n C_{ox}\frac{W}{L}I_D}
\]</span></p>
<p><span class="math display">\[
= \sqrt {2\cdot 50\frac{\mu A}{V^2} \cdot \frac{20}{1} \cdot 500 \mu A } = 1 mS
\]</span></p>
<p>Therefore</p>
<p><span class="math display">\[
f_T = \frac{1}{2\pi} \cdot \frac{g_m}{C_{gs} + C_{gd}} = \frac{1mS}{40.7fF + 10 fF} = 3.14GHz
\]</span></p>
<div class="table striped hover">
<div id="tbl-3.1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-3.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.1: Standard technology parameters for the <span class="math inline">\(\lambda\)</span>-model, with intrinsic and extrinsic capacitance parameters.
</figcaption>
<div aria-describedby="tbl-3.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 32%">
<col style="width: 32%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter</strong></th>
<th style="text-align: center;"><strong>n-channel MOSFET</strong></th>
<th style="text-align: center;"><strong>p-channel MOSFET</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Threshold voltage</td>
<td style="text-align: center;"><span class="math inline">\(V_{Tn}\)</span> = 0.5V</td>
<td style="text-align: center;"><span class="math inline">\(V_{Tp}\)</span> = -0.5V</td>
</tr>
<tr class="even">
<td>Transconductance parameter</td>
<td style="text-align: center;"><span class="math inline">\(μ_nC_{ox}= 50μA/V^2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(μ_pC_{ox}= 25μA/V^2\)</span></td>
</tr>
<tr class="odd">
<td>Chanel length modulation parameter</td>
<td style="text-align: center;"><p><span class="math inline">\(\lambda_n =0.1V^{-1}/L\)</span></p>
<p>(<span class="math inline">\(L\)</span> in <span class="math inline">\(\mu m\)</span>)</p></td>
<td style="text-align: center;"><p><span class="math inline">\(\lambda_p =0.1V^{-1}/L\)</span></p>
<p>(<span class="math inline">\(L\)</span> in <span class="math inline">\(\mu m\)</span>)</p></td>
</tr>
<tr class="even">
<td>Gate oxide capacitance per unit area</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(C_{ox} = 2.3fF/\mu m^2\)</span></td>
</tr>
<tr class="odd">
<td>Overlap Capacitance</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(C_{ov} = 0.5fF/\mu m\)</span></td>
</tr>
<tr class="even">
<td>Zero-bias planar bulk depletion capacitance</td>
<td style="text-align: center;"><span class="math inline">\(C_{Jn} = 0.1fF/\mu m^2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(C_{Jp} = 0.3fF/\mu m^2\)</span></td>
</tr>
<tr class="odd">
<td>Zero-bias sidewall bulk depletion capacitance</td>
<td style="text-align: center;"><span class="math inline">\(C_{JSWn}=0.5fF/\mu m\)</span></td>
<td style="text-align: center;"><span class="math inline">\(C_{JSWp}=0.35fF/\mu m\)</span></td>
</tr>
<tr class="even">
<td>Bulk junction potential</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(PB = 0.95\)</span> <span class="math inline">\(V\)</span></td>
</tr>
<tr class="odd">
<td>Planar bulk junction grading coefficient</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(MJ = 0.5\)</span></td>
</tr>
<tr class="even">
<td>Sidewall bulk junction grading coefficient</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(MJSW = 0.33\)</span></td>
</tr>
<tr class="odd">
<td>Length of source and drain diffusions</td>
<td colspan="2" style="text-align: center;"><span class="math inline">\(L_{diff} = 3\mu m\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<!-- QUESTION in the last row of the table, is that 3 µ "m" ?-->
</div>
</section>
<section id="frequency-response-with-intrinsic-and-extrinsic-gate-capacitances" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="frequency-response-with-intrinsic-and-extrinsic-gate-capacitances"><span class="header-section-number">3.3.3</span> <span id="frequency-response-with-intrinsic-and-extrinsic-gate-capacitances">Frequency Response with Intrinsic and Extrinsic Gate Capacitances</span></h3>
<p>To analyze the frequency response of the common-source amplifier with intrinsic and extrinsic capacitances, we insert the model of <a href="#fig-3.12" class="quarto-xref">Figure&nbsp;<span>3.14</span></a> into the small-signal circuit model of the amplifier, as shown in <a href="#fig-3.13" class="quarto-xref">Figure&nbsp;<span>3.15</span></a>(a). Note that we have neglected <span class="math inline">\(C_{gb}\)</span> and also discarded <span class="math inline">\(C_{sb}\)</span>, since this capacitor has both terminals shorted to ground.</p>
<div id="fig-3.13" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.13-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.13.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.13-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.15: Small-signal model of the common-source amplifier with both intrinsic and extrinsic capacitances included. With (a) Thevénin equivalent input source configuration, and (b) Norton equivalent input source configuration.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp; To simplify the full analysis of the amplifier, we redraw it as shown in <a href="#fig-3.13" class="quarto-xref">Figure&nbsp;<span>3.15</span></a>(b). We have taken the Norton equivalent at the input and combined the resistors at the input and output to reduce the number of terms carried in the algebra.</p>
<p>&nbsp;&nbsp;&nbsp; We begin the analysis by writing <span class="math inline">\(KCL\)</span> at nodes 1 and 2</p>
<p><span id="eq-3.36"><span class="math display">\[
0 = -\frac{v_s}{R_s} + \frac{v_{gs}}{R_s} + v_{gs}sC_{gs} + (v_{gs} - v_{out})sC_{gd}
\tag{3.36}\]</span></span></p>
<p><span id="eq-3.37"><span class="math display">\[
0 = g_m v_{gs} + sC_{gd}(v_{out} - v_{gs}) + \frac{v_{out}}{R_{out}} + sC_{db}v_{out}
\tag{3.37}\]</span></span></p>
<p>Next, solving <a href="#eq-3.36" class="quarto-xref">Equation&nbsp;<span>3.36</span></a> for <span class="math inline">\(v_{gs}\)</span>, substituting into <a href="#eq-3.37" class="quarto-xref">Equation&nbsp;<span>3.37</span></a>, and rearranging yields</p>
<p><span id="eq-3.38"><span class="math display">\[
\frac{v_{out}}{v_s} = \frac{-g_m R_{out} \left( 1 - s\frac{C_{gd}}{g_m} \right)}{1 + b_1 s + b_2 s^2}
\tag{3.38}\]</span></span></p>
<p>where</p>
<p><span id="eq-3.39"><span class="math display">\[
b_1 = R_s \left( C_{gs} + C_{gd} \right) + R_{out} \left( C_{db} + C_{gd} \right) + g_m R_{out} R_s C_{gd}
\tag{3.39}\]</span></span></p>
<p>and</p>
<p><span id="eq-3.40"><span class="math display">\[
b_2 = R_s R_{out} \left( C_{gs}C_{gd} + C_{gs}C_{db} + C_{gd}C_{db} \right)
\tag{3.40}\]</span></span></p>
<p>Although this result is algebraically complex, we can make a few preliminary observations about the terms in the numerator of <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a>:</p>
<ul>
<li><p>At DC (<span class="math inline">\(s = 0\)</span>, or all capacitors set to zero), the voltage gain of the circuit is <span class="math inline">\(–g_mR_{out}\)</span>, as we already concluded from the low-frequency analysis in <a href="partI.2.html">Chapter 2</a>.</p></li>
<li><p>The numerator contains a right half plane zero, <span class="math inline">\(z_1= g_m/C_{gd}\)</span>. Since obviously <span class="math inline">\(C_{gd} &lt; C_{gs} + C_{gd}\)</span>, we conclude [via comparison with <a href="#eq-3.35" class="quarto-xref">Equation&nbsp;<span>3.35</span></a>] that this zero occurs at frequencies beyond <span class="math inline">\(\omega_T\)</span>, and is therefore irrelevant in many practical scenarios.</p></li>
</ul>
<p>&nbsp;&nbsp;&nbsp;The denominator of the transfer function is a second-order polynomial in <span class="math inline">\(s\)</span> with complicated dependencies on all component values. All we can say at first glance from inspecting the denominator is that we expect to see two poles in the frequency response of this circuit, because it can (in principle) be factored into two binomial terms. Note that this factorization would yield an even more complicated expression.</p>
<p>&nbsp;&nbsp;&nbsp;The main issue with a result of this complexity is that it cannot be understood intuitively. Consequently, it is difficult to recognize the main parameters that are limiting the performance, which in turn prevents the designer from identifying ways to optimize the circuit. Even though <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a> is mathematically exact, we would rather like to work with an expression that sacrifices some accuracy and/or detail in return for transparency and focus on the main effects that limit the performance. In order to take steps in this direction, we begin by evaluating <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a> numerically, primarily to get a feel for the pole locations in a typical circuit.</p>
<p><strong><span id="example-3-6">Example 3-6</span>: Magnitude Response of the Common-Source Amplifier</strong></p>
<p>Evaluate and plot the steady-state magnitude response of <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a> numerically using the following transistor parameters: <span class="math inline">\(g_m = 1\)</span> <span class="math inline">\(mS\)</span>, <span class="math inline">\(C_{gs}\)</span> = <span class="math inline">\(40.7\)</span> <span class="math inline">\(fF\)</span>, <span class="math inline">\(C_{gd}\)</span> = <span class="math inline">\(10\)</span> <span class="math inline">\(fF\)</span> and <span class="math inline">\(C_{db}\)</span> = <span class="math inline">\(11.6\)</span> <span class="math inline">\(fF\)</span> (same as in <a href="#example-3-5">Example 3-5</a>). Assume <span class="math inline">\(R_{out}\)</span> = <span class="math inline">\(5\)</span> <span class="math inline">\(k\Omega\)</span> and <span class="math inline">\(R_s\)</span> = <span class="math inline">\(50\)</span> <span class="math inline">\(k\Omega\)</span>. For comparison, also plot the magnitude response of <a href="#eq-3.18" class="quarto-xref">Equation&nbsp;<span>3.18</span></a>, i.e., considering only the intrinsic gate capacitance.</p>
<p><strong>SOLUTION</strong></p>
<p>The plots are generated by letting <span class="math inline">\(s = j\omega\)</span> in <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a> and <a href="#eq-3.18" class="quarto-xref">Equation&nbsp;<span>3.18</span></a>, and subsequently plotting the magnitude of the expression as a function of frequency. The result is show in <a href="#fig-ex-3.6" class="quarto-xref">Figure&nbsp;<span>3.16</span></a>. From the plots, we conclude the following:</p>
<ul>
<li><p>In the response that uses intrinsic capacitance only, we see a pole at approximately <span class="math inline">\(100\)</span> <span class="math inline">\(MHz\)</span>; this number corresponds to the value obtained in <a href="#example-3-4">Example 3-4</a>.</p></li>
<li><p>As expected, the response with both intrinsic and extrinsic capacitances exhibits two poles. More importantly, we see that one of the poles occurs at relatively low frequencies, while the other occurs at very high frequencies.</p></li>
<li><p>The low-frequency pole of the case with extrinsic capacitance included lies significantly lower than <span class="math inline">\(100\)</span> <span class="math inline">\(MHz\)</span>. This tells us that extrinsic capacitance has a substantial impact on the bandwidth of this circuit.</p></li>
</ul>
<div id="fig-ex-3.6" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ex-3.6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-ex-3.6.png" id="fig-ex-3.6" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ex-3.6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.16
</figcaption>
</figure>
</div>
<p>From the result of this particular example, we see that the bandwidth of the common-source amplifier is primarily set by a single pole that lies far from any other breakpoint in the response. In this case, we call the bandwidth limiting pole of the circuit the dominant pole. When a dominant pole condition exists, we would like to work with an expression of the form</p>
<p><span id="eq-3.41"><span class="math display">\[
\frac{v_{out}}{v_s} = \frac{A_{v0}}{1-\frac{s}{p_1}}
\tag{3.41}\]</span></span></p>
<p>instead of evaluating <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a>. In some sense, <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a> contains too much information about irrelevant features of the response that have no impact on the 3-dB bandwidth. A commonly used technique that allows us to simplify expressions of the form of <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a> is therefore discussed in the next sub-section.</p>
</section>
<section id="the-dominant-pole-approximation" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="the-dominant-pole-approximation"><span class="header-section-number">3.3.4</span> <span id="the-dominant-pole-approximation">The Dominant Pole Approximation</span></h3>
<p>In general, the denominator of the transfer function given in <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a> can be factored into two binomial terms</p>
<p><span id="eq-3.42"><span class="math display">\[
\left(1-\frac{s}{p_1}\right)\left(1-\frac{s}{p_2}\right)= 1-s\left(\frac{1}{p_1}+ \frac{1}{p_2}\right) + \frac{s^2}{p_1p_2}
\tag{3.42}\]</span></span></p>
<p>Furthermore, we know from our numerical evaluation of the previous subsection that the magnitude of one of the poles is much larger than the other, i.e</p>
<p><span id="eq-3.43"><span class="math display">\[
|p_2| \gg |p_1|
\tag{3.43}\]</span></span></p>
<p>and therefore</p>
<p><span id="eq-3.44"><span class="math display">\[
|p_2| \ll |p_1|
\tag{3.44}\]</span></span></p>
<p>Consequently, we can eliminate the second term in s on the right hand side of <a href="#eq-3.42" class="quarto-xref">Equation&nbsp;<span>3.42</span></a> and approximate</p>
<p><span id="eq-3.45"><span class="math display">\[
\left(1-\frac{s}{p_1}\right)\left(1-\frac{s}{p_2}\right)\simeq 1- \left(\frac{s}{p_1}\right) + \frac{s^2}{p_1p_2}
\tag{3.45}\]</span></span></p>
<p>Now, comparing <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a> with <a href="#eq-3.45" class="quarto-xref">Equation&nbsp;<span>3.45</span></a>, we see that</p>
<p><span id="eq-3.46"><span class="math display">\[
- \frac{1}{p_1} = b_1
\tag{3.46}\]</span></span></p>
<p>and thus</p>
<p><span class="math display">\[
p_1 = -\frac{1}{b_1}
\]</span></p>
<p><span class="math display">\[
= - \frac{1}{R_s[C_{gs} + C_{gd}] + R_{out}[C_{db} + C_{gd}] + g_m R_{out} R_s C_{gd}}
\]</span></p>
<p><span id="eq-3.47"><span class="math display">\[
= - \frac{1}{R_s[C_{gs} + (1 + g_m R_{out})C_{gd}] + R_{out}[C_{db} + C_{gd}]}
\tag{3.47}\]</span></span></p>
<p>This result gives us a relatively handy expression for the dominant pole in the common-source amplifier, and the bandwidth can be estimated using</p>
<p><span id="eq-3.48"><span class="math display">\[
\omega_{3dB} = \frac{1}{R_s[C_{gs} + (1 + g_m R_{out})C_{gd}] + R_{out}[C_{db} + C_{gd}]}
\tag{3.48}\]</span></span></p>
<p>As opposed to <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a>, <a href="#eq-3.48" class="quarto-xref">Equation&nbsp;<span>3.48</span></a> is much more useful for evaluating which particular component of the circuit may limit the bandwidth. Specifically, the term <span class="math inline">\((1 + g_mR_{out})C_{gd}\)</span> looks like a potential problem. Whenever <span class="math inline">\(g_mR_{out}\)</span> is large (high gain), this term may dominate the denominator of <a href="#eq-3.48" class="quarto-xref">Equation&nbsp;<span>3.48</span></a>, and therefore limit the bandwidth. This is a very important conclusion, but unfortunately took us many lines of algebra (including the derivation of <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a>, which was not shown in detail) to develop. A more desirable approach would hint with very little algebra that the aforementioned term may limit the bandwidth. Such an approach is possible via the application of the Miller theorem and the Miller approximation, discussed in the next subsection.</p>
</section>
<section id="the-miller-theorem-and-the-miller-approximation" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="the-miller-theorem-and-the-miller-approximation"><span class="header-section-number">3.3.5</span> <span id="the-miller-theorem-and-miller-approximation">The Miller Theorem and the Miller Approximation</span></h3>
<p>The <strong>Miller theorem</strong> is a general linear circuit theorem that can be used to replace an impedance connected between two circuit nodes by two impedances, connected from each terminal to ground. This is illustrated in <a href="#fig-3.14" class="quarto-xref">Figure&nbsp;<span>3.17</span></a>. The impedance <span class="math inline">\(Z\)</span> in <a href="#fig-3.14" class="quarto-xref">Figure&nbsp;<span>3.17</span></a>(a) is replaced by the two impedances <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span> in <a href="#fig-3.14" class="quarto-xref">Figure&nbsp;<span>3.17</span></a>(b). For the two circuits to be equivalent, it can be shown that</p>
<p><span id="eq-3.49"><span class="math display">\[
Z_1 = \frac{Z}{1-A_{vM}} \quad and \quad Z_2 = \frac{A_{vM}Z}{A_{vM}-1}
\tag{3.49}\]</span></span></p>
<p>where <span class="math inline">\(A_{vM} = V_2/V_1\)</span> is the voltage gain across the impedance <span class="math inline">\(Z\)</span>, also called the <strong>Miller gain</strong>.</p>
<div id="fig-3.14" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.14-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.14.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.14-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.17: Illustration of the Miller theorem.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;The Miller theorem is useful for the simplification of a variety of circuits. In the context of the common-source amplifier analysis in this chapter, we will use the theorem to eliminate the coupling of the output and input through <span class="math inline">\(C_{gd}\)</span>, and thereby arrive at a circuit that is easier to analyze and understand. Before applying the Miller Theorem to the full circuit model of <a href="#fig-3.13" class="quarto-xref">Figure&nbsp;<span>3.15</span></a>, we will first consider its application to an ideal voltage amplifier circuit with a coupling capacitance between the input and output, as drawn in <a href="#fig-3.15" class="quarto-xref">Figure&nbsp;<span>3.18</span></a>.</p>
<div id="fig-3.15" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.15-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.15.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.15-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.18: Idealized voltage amplifier with coupling capacitance between its input and output.
</figcaption>
</figure>
</div>
<p>The goal of this example is to determine the effective shunt capacitance at the input port, when the signal is amplified by a gain of <span class="math inline">\(A_{vM}\)</span> across the coupling capacitor <span class="math inline">\(C\)</span>. Using <span class="math inline">\(Z = 1/sC\)</span>, and <span class="math inline">\(Z_{eff} = 1/sC_{eff}\)</span> we can apply <a href="#eq-3.49" class="quarto-xref">Equation&nbsp;<span>3.49</span></a> to find</p>
<p><span id="eq-3.50"><span class="math display">\[
\frac{1}{sC_{eff}} = \frac{\frac{1}{sC}}{1-A_{vM}}
\tag{3.50}\]</span></span></p>
<p>and therefore</p>
<p><span id="eq-3.51"><span class="math display">\[
C_{eff} = C(1- A_{vM})
\tag{3.51}\]</span></span></p>
<p>If the voltage gain <span class="math inline">\(A_{vM}\)</span> is a negative number (as in the case of a common-source amplifier), the capacitance <span class="math inline">\(C\)</span> is “amplified” by the factor <span class="math inline">\((1 + |A_{vM}|)\)</span>. Intuitively, without relying on a complete proof of the Miller Theorem, this result can be understood by examining the voltages and currents of the capacitor <span class="math inline">\(C\)</span> in <a href="#fig-3.15" class="quarto-xref">Figure&nbsp;<span>3.18</span></a>. The voltage across <span class="math inline">\(C\)</span> is</p>
<p><span id="eq-3.52"><span class="math display">\[
v_C = v_{in} - v_{out} = v_in(1-A_{vM})
\tag{3.52}\]</span></span></p>
<p>and the current flowing into <span class="math inline">\(C\)</span> from the input port is</p>
<p><span class="math display">\[
i_{in} = i_C = sCv_c = sC(1-A_{vM})v_in
\]</span></p>
<p><span id="eq-3.53"><span class="math display">\[
\frac{v_{in}}{v_{out}} = \frac{1}{sC(1-A_{vM})} = \frac{1}{sC_{eff}}
\tag{3.53}\]</span></span></p>
<div id="fig-3.16" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.16.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.19: Circuit to analyze the voltage gain across <span class="math inline">\(C_{gd}\)</span>.
</figcaption>
</figure>
</div>
<p>In essence, the capacitance is multiplied due to the large swing at the amplifier output; this increases the voltage across the capacitor and therefore forces a correspondingly multiplied current into the input port.</p>
<p>&nbsp;&nbsp;&nbsp;This result applies qualitatively also to the common-source amplifier studied in this chapter—i.e., the negative gain of the amplifier causes an amplification of <span class="math inline">\(C_{gd}\)</span>, which couples the input and output. However, a subtle difference is that the gain across the capacitor is not perfectly constant (as assumed above), but exhibits some frequency dependence.</p>
<p>&nbsp;&nbsp;&nbsp;To investigate, consider the circuit of <a href="#fig-3.16" class="quarto-xref">Figure&nbsp;<span>3.19</span></a>, which is the relevant section of the full common-source circuit needed to find the voltage gain across <span class="math inline">\(C_{gd}\)</span>. Applying KCL at node 2 and solving for <span class="math inline">\(A_{vM} = v_{out}/v_{gs}\)</span> yields</p>
<p><span id="eq-3.54"><span class="math display">\[
\frac{v_{out}}{v_{gs}} = -g_m R_{out} \left( \frac{1 - s \frac{C_{gd}}{g_m}}{1 + s R_{out}(C_{db} + C_{gd})} \right)
\tag{3.54}\]</span></span></p>
<p>In this expression, the bracketed term contains a zero and a pole. The zero occurs beyond <span class="math inline">\(\omega_T\)</span> and can be safely discarded. The situation is somewhat different for the pole. If <span class="math inline">\(R_{out}\)</span> is very large, or if an additional load capacitance is added to the circuit output (in parallel with <span class="math inline">\(C_{db}\)</span>), the pole can occur at relatively low frequencies, making the gain across <span class="math inline">\(C_{gd}\)</span> non-constant in the frequency range of interest. Provided that the pole in the bracketed term occurs outside the frequency band of interest, we can assume</p>
<p><span id="eq-3.55"><span class="math display">\[
\frac{v_{out}}{v_gs} \simeq -g_mR_{out}
\tag{3.55}\]</span></span></p>
<p>This assumption is known as the Miller approximation, and it allows us to utilize the result from <a href="#eq-3.51" class="quarto-xref">Equation&nbsp;<span>3.51</span></a>, which assumed a constant gain across the capacitor in question.</p>
<p>&nbsp;&nbsp;&nbsp;To complete this discussion, we will now apply the Miller approximation to the model of the common-source amplifier in <a href="#fig-3.13" class="quarto-xref">Figure&nbsp;<span>3.15</span></a>. The result is shown in <a href="#fig-3.17" class="quarto-xref">Figure&nbsp;<span>3.20</span></a>. The capacitor <span class="math inline">\(C_{gd}\)</span> is no longer connected between the input and output, but appears only across the input port, with its value multiplied by <span class="math inline">\((1+ g_mR_{out})\)</span>. From this model, the circuit bandwidth can be easily identified by inspection</p>
<p><span id="eq-3.56"><span class="math display">\[
\omega_{3dB} = \frac{1}{R_s [C_{gs} + (1+g_mR_{out})C_{gd}]}
\tag{3.56}\]</span></span></p>
<div id="fig-3.17" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.17-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.17.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.17-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.20: Small-signal model of the common-source amplifier after applying the Miller approximation.
</figcaption>
</figure>
</div>
<p>&nbsp;&nbsp;&nbsp;In comparison with <a href="#eq-3.48" class="quarto-xref">Equation&nbsp;<span>3.48</span></a>, this result is missing the term <span class="math inline">\(R_{out}(C_{gd} + C_{db})\)</span> in the denominator. This is not surprising and also inconsequential when the Miller Approximation is applied properly. As we pointed out above, the Miller approximation is justified only when this time constant is small in the first place, ensuring a constant Miller gain in the band where the dominant pole is expected to lie. Whenever the Miller approximation is applied, it must be verified that the neglected pole in the Miller gain occurs far beyond the frequency estimated by <a href="#eq-3.56" class="quarto-xref">Equation&nbsp;<span>3.56</span></a>. This leads to the following procedure for the proper application of the Miller approximation in common-source amplifiers:</p>
<ol type="1">
<li><p>Calculate the low-frequency gain across <span class="math inline">\(C_{gd}\)</span> and draw the simplified circuit model (as in <a href="#fig-3.17" class="quarto-xref">Figure&nbsp;<span>3.20</span></a>) with the Miller-amplified shunt capacitance at the input.</p></li>
<li><p>Estimate the bandwidth of the circuit using <a href="#eq-3.56" class="quarto-xref">Equation&nbsp;<span>3.56</span></a>.</p></li>
<li><p>Calculate the frequency of the pole in <a href="#eq-3.54" class="quarto-xref">Equation&nbsp;<span>3.54</span></a>. If and only if this pole frequency is far beyond the frequency calculated in step 2, the Miller approximation result is valid.</p></li>
</ol>
<p>In a typical common-source circuit without a large load capacitance as drawn in <a href="#fig-3.17" class="quarto-xref">Figure&nbsp;<span>3.20</span></a>, the Miller approximation typically holds. When a very large capacitor is connected to the output, the approximation becomes invalid and the dominant pole is set by the <span class="math inline">\(RC\)</span> time constant formed at the output.</p>
<p><strong><span id="example-3-7">Example 3-7</span>: Calculating the Common-Source Amplifier Bandwidth Using the Miller Approximation</strong></p>
<p>Calculate the 3-dB bandwidth for the common-source voltage amplifier of <a href="#fig-3.13" class="quarto-xref">Figure&nbsp;<span>3.15</span></a> using (a) the Miller approximation, and (b) the dominant pole approximation result of <a href="#eq-3.48" class="quarto-xref">Equation&nbsp;<span>3.48</span></a>. Parameters: <span class="math inline">\(g_m\)</span> = <span class="math inline">\(1\)</span> <span class="math inline">\(mS\)</span>, <span class="math inline">\(C_{gs}\)</span> = <span class="math inline">\(40.7\)</span> <span class="math inline">\(fF\)</span>, <span class="math inline">\(C_{gd}\)</span> = <span class="math inline">\(10\)</span> <span class="math inline">\(fF\)</span>, <span class="math inline">\(C_{db}\)</span> = <span class="math inline">\(11.6\)</span> <span class="math inline">\(fF\)</span>, <span class="math inline">\(R_{out}\)</span> = <span class="math inline">\(5\)</span> <span class="math inline">\(k\Omega\)</span> and <span class="math inline">\(R_s\)</span> = <span class="math inline">\(50\)</span> <span class="math inline">\(k\Omega\)</span> (same as in <a href="#example-3-6">Example 3-6</a>). Calculate the percent error in the result of part (a).</p>
<p><strong>SOLUTION</strong></p>
<ol type="a">
<li>Using the Miller approximation [i.e., <a href="#eq-3.56" class="quarto-xref">Equation&nbsp;<span>3.56</span></a>], we obtain</li>
</ol>
<p><span class="math display">\[
f_{3dB} = \frac{1}{2\pi} \cdot \frac{1}{R_s[C_{gs} + (1 + g_m R_{out})C_{gd}]}
\]</span> <span class="math display">\[
= \frac{1}{2\pi} \cdot \frac{1}{50k\Omega[40.7{fF} + (1 + 1{mS} \cdot 5k\Omega)10{fF}]}
\]</span> <span class="math display">\[
= 31.61{MHz}
\]</span></p>
<ol start="2" type="a">
<li>Using <a href="#eq-3.48" class="quarto-xref">Equation&nbsp;<span>3.48</span></a> we find</li>
</ol>
<p><span class="math display">\[
f_{3dB} = \frac{1}{2\pi} \cdot \frac{1}{R_s[C_{gs} + (1 + g_m R_{out})C_{gd}] + R_{out}[C_{db} + C_{gd}]}
\]</span> <span class="math display">\[
= \frac{1}{2\pi} \cdot \frac{1}{50k\Omega[40.7{fF} + (1 + 1{mS} \cdot 5k\Omega)10{fF}] + 5k\Omega \cdot 21.6{fF}}
\]</span> <span class="math display">\[
= 30.95{MHz}
\]</span></p>
<p>The error in the result of part (a) is therefore</p>
<p><span class="math display">\[
\frac{31.61-30.95}{30.95} = 2.1\%
\]</span></p>
<p>The error of <span class="math inline">\(2.1\%\)</span> seen in this example is acceptable and will in practice be overshadowed by uncertainty in the transistor model parameters.</p>
</section>
<section id="calculating-the-non-dominant-pole" class="level3" data-number="3.3.6">
<h3 data-number="3.3.6" class="anchored" data-anchor-id="calculating-the-non-dominant-pole"><span class="header-section-number">3.3.6</span> <span id="calculating-the-non-dominant-pole">Calculating the Non-Dominant Pole*</span></h3>
<p>The reader may wonder how the non-dominant pole frequency can be calculated within the above-discussed framework. A common misconception is to assume that after applying the Miller approximation, the non-dominant pole can be simply found from the time constant in the output network, i.e., <span class="math inline">\(R_{out}C_{db}\)</span>. This is incorrect, since the Miller approximation is not valid at the frequency where the non-dominant pole is located.</p>
<p>&nbsp;&nbsp;&nbsp;If a dominant pole condition exists, the proper way to estimate the non-dominant pole is by comparing the coefficients of Eqs. (3.45) and (3.38). Specifically, we utilize that</p>
<p><span id="eq-3.57"><span class="math display">\[
\frac{1}{p_1p_2} = b_2
\tag{3.57}\]</span></span></p>
<p>and thus</p>
<p><span class="math display">\[
p_2 = \frac{1}{p_1 b_2}
\]</span> <span id="eq-3.58"><span class="math display">\[
= - \frac{R_s[C_{gs} + C_{gd}] + R_{out}[C_{db} + C_{gd}] + g_m R_{out} R_s C_{gd}}{R_s R_{out}(C_{gs} C_{gd} + C_{gs} C_{db} + C_{gd} C_{db})}
\tag{3.58}\]</span></span></p>
<p>To simplify, let us assume that <span class="math inline">\(C_{gd}\)</span> <span class="math inline">\(\ll\)</span> <span class="math inline">\(C_{gs}\)</span> and <span class="math inline">\(C_{gd} \ll C_{db}\)</span>. Note that the latter assumption is not strictly true based on typical values for the technology assumed in this module (see <a href="#example-3-5">Example 3-5</a>). However, if a load capacitance is added to the circuit, the approximation is more easily justified, with Cdb replaced by <span class="math inline">\(C_{db} + C_L\)</span> (see <a href="#example-3-8">Example 3-8</a>), and we almost always have in practice <span class="math inline">\(C_{gd}\)</span> <span class="math inline">\(\ll\)</span> <span class="math inline">\(C_{db} +C_L\)</span>. Thus, under the stated conditions, we can write</p>
<p><span class="math display">\[
p_2 \simeq - \frac{R_sC_{gs}+R_{out}C_{db}+g_mR_{out}R_sC_{gd}}{R_sR_{out}C_{gs}C_{db}}
\]</span></p>
<p><span id="eq-3.59"><span class="math display">\[
= -\left ( \frac{1}{R_{out}C_{db}}+\frac{1}{R_sC_{gs}}+\frac{g_m}{C_{db}}\cdot \frac{C_{gd}}{C_{gs}}\right)
\tag{3.59}\]</span></span></p>
<p>This approximate result indicates that the non-dominant pole lies at a frequency that is higher than <span class="math inline">\(1/R_{out}C_{db}\)</span>, especially when <span class="math inline">\(g_m\)</span> is large. Note that <a href="#eq-3.59" class="quarto-xref">Equation&nbsp;<span>3.59</span></a> essentially represents a “parallel combination” of time constants (analogous to parallel connections of resistors)—that is, the smallest time constant in the expression sets the pole frequency.</p>
</section>
</section>
<section id="open-circuit-time-constant-analysis" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="open-circuit-time-constant-analysis"><span class="header-section-number">3.4</span> <span id="open-circuit-time-contant-analysis">Open-Circuit Time Constant Analysis</span></h2>
<section id="general-framework" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="general-framework"><span class="header-section-number">3.4.1</span> <span id="general-framework">General Framework</span></h3>
<p>In <a href="#the-dominant-pole-approximation">Section 3-3-4</a>, we derived an approximate expression for the 3-dB bandwidth of a common-source voltage amplifier, assuming that a dominant pole condition exists. In this analysis, we found that the bandwidth is fully determined by the coefficient <span class="math inline">\(b_1\)</span> in the numerator of <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a>.</p>
<p>&nbsp;&nbsp;&nbsp;The <strong>open-circuit time constant (OCT) analysis</strong> is a powerful and general technique that allows us to compute the term <span class="math inline">\(b_1\)</span> for arbitrary circuits, without the need to derive the full circuit transfer function with all high-order artifacts included. More importantly, it breaks the analysis into small and computationally manageable steps that provide insight about which circuit elements present the main bandwidth bottleneck. The step-by-step procedure for applying the OCT analysis method can be summarized as follows (see <a href="#reference-3.3">Reference 3</a> for a derivation)</p>
<ol type="1">
<li><p>Remove all but one capacitor in the circuit that is to be analyzed. Let us call this capacitor <span class="math inline">\(C_j\)</span>.</p></li>
<li><p>Short all independent voltage sources and remove all independent current sources in the circuit.</p></li>
<li><p>Calculate the Thévenin resistance <span class="math inline">\(R_{Tj}\)</span> seen by the capacitor <span class="math inline">\(C_j\)</span> and compute the time constant <span class="math inline">\(\tau_{j0} = R_{Tj}C_j\)</span>. Here, the subscript “<span class="math inline">\(o\)</span>” is used to emphasize the open-circuit condition.</p></li>
<li><p>Repeat the above steps 1-3 for all remaining capacitors in the circuit.</p></li>
<li><p>The sum of all time constants is exactly equal to <span class="math inline">\(b_1\)</span>. We can therefore estimate the circuit’s 3-dB bandwidth using</p></li>
</ol>
<p><span id="eq-3.60"><span class="math display">\[
\omega_{3dB} \simeq \frac{1}{b_1}
\tag{3.60}\]</span></span></p>
<p><span id="eq-3.61"><span class="math display">\[
b_1 = \sum_{{j=1}}^{{N}} \tau_{jo}
\tag{3.61}\]</span></span></p>
<p>where <span class="math inline">\(N\)</span> is the total number of capacitors in the circuit. The <span class="math inline">\(\tau_{jo}\)</span> jo are called <strong>open-circuit time</strong> constants, because these were determined with all other capacitors open circuited.</p>
<p>&nbsp;&nbsp;&nbsp;Once a circuit is analyzed using the OCT method, we can see which of the individual open-circuit time constants is contributing most heavily to <span class="math inline">\(b_1\)</span>. To increase the bandwidth, we can try to redesign the circuit by lowering the Thévenin resistance or the capacitor value of that time constant.</p>
</section>
<section id="oct-analysis-of-a-common-source-stage" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="oct-analysis-of-a-common-source-stage"><span class="header-section-number">3.4.2</span> <span id="oct-analysis-of-a-common-source-stage">OCT Analysis of a Common-Source Stage</span></h3>
<p>Consider the common-source amplifier shown in <a href="#fig-3.18" class="quarto-xref">Figure&nbsp;<span>3.21</span></a>(a) as an example to further understand the method of open-circuit time constants. We begin by considering <span class="math inline">\(C_{gs}\)</span> and therefore remove all other capacitors and short the input source as shown in <a href="#fig-3.18" class="quarto-xref">Figure&nbsp;<span>3.21</span></a>(b). As evident from this circuit, the Thévenin resistance seen by capacitor <span class="math inline">\(C_gs\)</span> is <span class="math inline">\(R_S\)</span> and the individual time constant contribution from <span class="math inline">\(C_{gs}\)</span> is</p>
<p><span id="eq-3.62"><span class="math display">\[
\tau_{gso} = R_SC_{gs}
\tag{3.62}\]</span></span></p>
<p>Similarly, redrawing the circuit with only Cdb present will yield</p>
<p><span id="eq-3.63"><span class="math display">\[
\tau_{dbo} = R_{out}C_{db}
\tag{3.63}\]</span></span></p>
<div id="fig-3.18" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.18-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.18.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.18-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.21: OCT analysis for a common-source amplifier. (a) Complete circuit. (b) Circuit for finding <span class="math inline">\(\tau_{gs}\)</span>. (c) Circuit for finding <span class="math inline">\(\tau_{gd}\)</span>.
</figcaption>
</figure>
</div>
<p>Next, we determine the individual time constant contribution from capacitor <span class="math inline">\(C_{gd}\)</span>. To perform this calculation, we consider the circuit as redrawn in <a href="#fig-3.18" class="quarto-xref">Figure&nbsp;<span>3.21</span></a>(c). From this circuit, the Thévenin resistance seen across <span class="math inline">\(C_{gd}\)</span> cannot be immediately determined by inspection. This is because of the <span class="math inline">\(g_m\)</span> element, which couples the nodes to the left and right of the capacitance. We therefore resort to determining the Thévenin resistance from first principles, using a nodal analysis. As shown in <a href="#fig-3.19" class="quarto-xref">Figure&nbsp;<span>3.22</span></a>, we apply a test current source (<span class="math inline">\(i_t\)</span>) and measure the resulting test voltage (<span class="math inline">\(v_t\)</span>). Applying <span class="math inline">\(KVL\)</span> and <span class="math inline">\(KCL\)</span>, we find that</p>
<p><span id="eq-3.64"><span class="math display">\[
v_t = v_{gs} + R_{out}(g_mV_{gs} + i_t)
\tag{3.64}\]</span></span></p>
<p><span id="eq-3.65"><span class="math display">\[
v_{gs} = i_tR_S
\tag{3.65}\]</span></span></p>
<p>After substituting <a href="#eq-3.65" class="quarto-xref">Equation&nbsp;<span>3.65</span></a> into <a href="#eq-3.64" class="quarto-xref">Equation&nbsp;<span>3.64</span></a>, we obtain</p>
<p><span class="math display">\[
R_{Tgd} = \frac{v_t}{i_t} = R_S + R_{out}(g_mR_S+1)
\]</span></p>
<p><span id="eq-3.66"><span class="math display">\[
= R_S + R_{out} + g_mR_SR_{out}
\tag{3.66}\]</span></span></p>
<div id="fig-3.19" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.19.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.22: Circuit to determine the Thévenin resistance seen across <span class="math inline">\(C_{gd}\)</span>.
</figcaption>
</figure>
</div>
<p>A common way to memorize this final result is “<span class="math inline">\(R_{left} + R_{right} + g_mR_{left} R_{right}\)</span>,” where <span class="math inline">\(R_{left}\)</span> and <span class="math inline">\(R_{right}\)</span> are the resistances seen to the left and right of the coupling capacitance <span class="math inline">\(C_{gd}\)</span>, respectively. Using this result, the individual time constant resulting from <span class="math inline">\(C_{gd}\)</span> is given by</p>
<p><span id="eq-3.67"><span class="math display">\[
\tau_{gdo} = R_{Tgd}C_{gd} = [R_S+R_{out}+g_mR_SR_{out}]C_{gd}
\tag{3.67}\]</span></span></p>
<p>Next, we add the individual time constants from <a href="#eq-3.62" class="quarto-xref">Equation&nbsp;<span>3.62</span></a>, <a href="#eq-3.63" class="quarto-xref">Equation&nbsp;<span>3.63</span></a>, and <a href="#eq-3.67" class="quarto-xref">Equation&nbsp;<span>3.67</span></a>, which results in</p>
<p><span class="math display">\[
b_1 = R_S[C_{gs} + C_{gd}] + R_{out}[C_{db}+C_{gd}] + g_mR_{out}R_SC_gd
\]</span> <span id="eq-3.68"><span class="math display">\[
= R_S[C_{gs}+(1+g_mR_{out})C_{gd}] + R_{out} [ C_{db}+ C_{gd}]
\tag{3.68}\]</span></span></p>
<p>Note that this result is identical to <a href="#eq-3.39" class="quarto-xref">Equation&nbsp;<span>3.39</span></a>, which was obtained from an exact nodal analysis of the complete circuit. This verifies that the method of open-circuit time constants is an exact analysis to determine the factor <span class="math inline">\(b_1\)</span>, which multiplies the first-order term in <span class="math inline">\(s\)</span> in the denominator of the generalized system function. As before, the resulting estimate of the 3-dB breakpoint frequency is therefore given by</p>
<p><span class="math display">\[
\omega_{3dB} = \frac{1}{b_1}
\]</span> <span id="eq-3.69"><span class="math display">\[
= \frac{1}{R_S[C_{gs}+(1+g_mR_{out})C_{gd}] + R_{out} [ C_{db}+ C_{gd}]}
\tag{3.69}\]</span></span></p>
<p>It is important to remember that this result maintains good accuracy only if a dominant pole condition exists. As we showed in <a href="#the-dominant-pole-approximation">Section 3-3-4</a>, this condition is required so that we can approximate <span class="math inline">\(\omega_{3dB} \simeq 1/b_1\)</span>. Finally it is worth noting that <a href="#eq-3.69" class="quarto-xref">Equation&nbsp;<span>3.69</span></a> shows that <span class="math inline">\(C_{gd}\)</span> is effectively multiplied by the circuit’s voltage gain; this corresponds to the Miller amplification effect discussed in the previous section.</p>
<p>&nbsp;&nbsp;&nbsp;A simple example where the dominant pole condition is not met is shown in <a href="#fig-3.20" class="quarto-xref">Figure&nbsp;<span>3.23</span></a>. The reader may prove that the exact transfer function of this circuit is</p>
<p><span id="eq-3.70"><span class="math display">\[
\frac{v_{out}}{v_s} = \frac{-g_mR}{(1+sRC)(1+sRC)}
\tag{3.70}\]</span></span></p>
<p>and thus</p>
<p><span id="eq-3.71"><span class="math display">\[
|p_2| = |p_1| = \frac{1}{RC}
\tag{3.71}\]</span></span></p>
<div id="fig-3.20" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.20.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.23: Circuit example that violates the dominant pole assumption.
</figcaption>
</figure>
</div>
<p>Therefore, we expect that the approximation of <a href="#eq-3.45" class="quarto-xref">Equation&nbsp;<span>3.45</span></a> cannot be applied and <span class="math inline">\(1/b_1\)</span> will not be a good estimate for the circuit’s bandwidth. It is now interesting to calculate the error that will result if the OCT method is nonetheless “blindly” applied.</p>
<p>&nbsp;&nbsp;&nbsp;In performing the OCT analysis, we see that the circuit in question has two open-circuit time constants equal to <span class="math inline">\(RC\)</span>. The bandwidth estimate using OCT analysis is therefore</p>
<p><span id="eq-3.72"><span class="math display">\[
\omega_{3dB,OCT} \simeq \frac{1}{b_1} = \frac{1}{2RC}
\tag{3.72}\]</span></span></p>
<p>&nbsp;&nbsp;&nbsp;On the other hand, we can find the exact 3-dB frequency of the circuit using</p>
<p><span id="eq-3,73"><span class="math display">\[
\frac{1}{\sqrt 2} = \left| \frac{1}{(1+j\omega_{3dB}RC)(1+j\omega_{3dB}RC)}\right |
\tag{3.73}\]</span></span></p>
<p>Solving for <span class="math inline">\(\omega_{3dB}\)</span> gives</p>
<p><span id="eq-3.74"><span class="math display">\[
\omega_{3dB} = \frac{1}{RC} \sqrt{\sqrt{2} -1} \simeq \frac{0.64}{RC}
\tag{3.74}\]</span></span></p>
<p>The error in the OCT estimate is thus</p>
<p><span id="eq-3.75"><span class="math display">\[
\frac{0.5 - 0.64}{0.64} = -22\%
\tag{3.75}\]</span></span></p>
<p>From this result, we can draw a few interesting conclusions. First, even though the dominant pole condition is grossly violated in the above example, the OCT analysis is not extremely far off from the exact result. Second, the OCT result is conservative in the sense that it tends to underestimate the circuit’s bandwidth. This is desirable since the designer can rest assured that the bandwidth is at least as large as predicted by the OCT analysis. It can be shown that this latter property holds for arbitrary circuits whose poles lie on (or near) the real axis, and whose zeros occur beyond the estimated <span class="math inline">\(\omega_{3dB}\)</span>. This is the case for most circuits considered in this module. We will highlight exceptions where appropriate.</p>
<p>&nbsp;&nbsp;&nbsp;In summary, the reader should remember the following key points when applying the OCT analysis:</p>
<ul>
<li><p>In any circuit, the sum of the open-circuit time constants corresponds (exactly) to the term <span class="math inline">\(b_1\)</span>, which multiplies the first-order term in the denominator of the circuit’s <span class="math inline">\(s\)</span>-domain transfer function.</p></li>
<li><p>Under the following conditions, the bandwidth of the circuit can be approximated with good accuracy by <span class="math inline">\(1/b_1\)</span>: (1) a dominant pole condition exists, (2) the transfer function contains only poles that lie on (or near) the real axis, and (3) the zeros in the transfer function occur beyond the bandwidth estimate in question.</p></li>
<li><p>Even if no clear dominant pole condition exists, OCTs can be used to get a first-order feel for the bandwidth of a circuit. For instance, in a circuit with two identical real poles, the OCT bandwidth estimate is in error by <span class="math inline">\(–22\%\)</span>. As long as condition (2) above is met, the percent error will be negative and thus the estimated bandwidth is at least as large as the actual bandwidth (measured, e.g., using a circuit simulation).</p></li>
<li><p>Open-circuit time constants, in general, do not necessarily correspond to the poles of a circuit. The OCT correspond to poles only in circuits that can be broken into decoupled <span class="math inline">\(RC\)</span> sections, as is the case in the circuit of <a href="#fig-3.20" class="quarto-xref">Figure&nbsp;<span>3.23</span></a>.</p></li>
</ul>
<p><strong><span id="example-3-8">Example 3-8</span> Common-Source Amplifier Bandwidth Estimate Using an OCT Analysis</strong></p>
<p>Consider the circuit shown in <a href="#fig-ex-3.8" class="quarto-xref">Figure&nbsp;<span>3.24</span></a> and assume the following parameters: <span class="math inline">\(W = 20 \, \mu{m}\)</span>, <span class="math inline">\(L = 1 \, \mu{m}\)</span>, <span class="math inline">\(I_B = 500 \, \mu{A}\)</span>, <span class="math inline">\(g_m = 1 \, {mS}\)</span>, <span class="math inline">\(C_{gs} = 40.7 \,{fF}\)</span>, <span class="math inline">\(C_{gd} = 10 \, {fF}\)</span>, <span class="math inline">\(C_{db} = 11.6 \, {fF}\)</span>, <span class="math inline">\(R_{out} = R_D \parallel r_o = 5 \, {k}\Omega\)</span> and <span class="math inline">\(R_s = 50 \, {k}\Omega\)</span> (same as in <a href="#eaxmple-3-7">Example 3-7</a>). The value of the load capacitance is <span class="math inline">\(C_L = 10 \, {pF}\)</span>. Estimate the <span class="math inline">\(3\)</span>-dB bandwidth using an OCT analysis and propose a design modification that will increase the bandwidth by <span class="math inline">\(20\%\)</span>. For this modification, you may not alter the circuit’s DC gain, and <span class="math inline">\(R_S\)</span> and <span class="math inline">\(C_L\)</span> must be kept constant.</p>
<div id="fig-ex-3.8" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ex-3.8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-ex-3.8.png" id="fig-ex-3.8" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ex-3.8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.24
</figcaption>
</figure>
</div>
<p><strong>SOLUTION</strong></p>
<p>The circuit has three open-circuit time constants as expressed in <a href="#eq-3.62" class="quarto-xref">Equation&nbsp;<span>3.62</span></a>, <a href="#eq-3.63" class="quarto-xref">Equation&nbsp;<span>3.63</span></a>, and <a href="#eq-3.67" class="quarto-xref">Equation&nbsp;<span>3.67</span></a>, with the difference that <span class="math inline">\(C_L\)</span> appears in parallel to <span class="math inline">\(C_{db}\)</span>. The three OCT expressions are therefore</p>
<p><span class="math display">\[
\tau_{gso} = R_SC_{gs}
\]</span> <span class="math display">\[
\tau_{dbo}^{\prime} = R_{out}(C_{db} + C_L)
\]</span></p>
<p><span class="math display">\[
\tau_{gdo} = R_{Tgd}C_{gd} = [R_S+R_{out}+g_mR_SR_{out}]C_{gd}
\]</span></p>
<p>Evaluating these expression with the given numbers yields</p>
<p><span class="math display">\[
\tau_{gso} = 50k\Omega \cdot 40.7fF= 2.035ns
\]</span></p>
<p><span class="math display">\[
\tau_{dbo}^{\prime} = 5k\Omega (11.6pF + 10pF) = 50.01ns
\]</span></p>
<p><span class="math display">\[
\tau_{gdo} = [50k\Omega +5k\Omega + 1mS \cdot 5k\Omega \cdot 50k\Omega]10fF
\]</span></p>
<!-- TYPO there is a 5 after the fF in the text: fF5-->
<p><span class="math display">\[
= 3.05 ns
\]</span></p>
<p>The bandwidth estimate is</p>
<p><span class="math display">\[
f_{3dB} = \frac{1}{2\pi} \cdot \frac{1}{2.035ns + 50.01ns + 3.05ns} = 2.89MHz
\]</span></p>
<p>In order to improve the bandwidth by <span class="math inline">\(20\%\)</span>, it is clear that we must reduce the dominant open-circuit time constant <span class="math inline">\(\tau_{dbo}^{\prime}\)</span>. Since <span class="math inline">\(C_L\)</span> must remain unchanged, the only option is to reduce Rout. To first-order, reducing Rout to approximately <span class="math inline">\(4\)</span> <span class="math inline">\(k\Omega\)</span> (a <span class="math inline">\(20\%\)</span> reduction from the original value of <span class="math inline">\(5\)</span> <span class="math inline">\(k\Omega\)</span>) should get us close to the desired improvement. In order to keep the DC gain of the circuit constant, we now require a larger transconductance</p>
<p><span class="math display">\[
g_m = \frac{A_{v0}}{R_{out}} = \frac{5}{4k\Omega} = 1.2mS
\]</span></p>
<p>There are several ways to increase the transconductance of the MOSFET. (i) Keep the device width constant and increase the bias current <span class="math inline">\(I_D\)</span>. An advantage of this option is that none of the device capacitances will change, thereby avoiding any counterproductive increase in the total time constant.(ii) Keep <span class="math inline">\(I_D\)</span> constant and increase the device width <span class="math inline">\(W\)</span>. This option has the advantage that the current consumption of the circuit will not increase. Finally, option (iii) is to increase both <span class="math inline">\(W\)</span> and <span class="math inline">\(I_D\)</span> by the same factor. This option has the advantage that the gate overdrive voltage <span class="math inline">\(V_{OV}\)</span> remains unchanged, and hence the input bias voltage and output voltage swing are unaffected. Since our primary focus in this example is to improve bandwidth, and current consumption and biasing considerations are secondary, we will apply option (i).</p>
<p>&nbsp;&nbsp;&nbsp;Using <a href="partI.2.html#eq-2.30" class="quarto-xref">Equation&nbsp;<span>2.30</span></a>, the new value of the required <span class="math inline">\(I_B\)</span> is</p>
<p><span class="math display">\[
I_B = I_D = \frac{g_m^2}{2\mu_n C_{ox} \frac{W}{L}} = \frac{(1.2mS)^2}{2 \cdot 50\frac{\mu A}{V^2} \cdot \frac{20}{1}} = 720\mu A
\]</span></p>
<p>Note that this value is approximately <span class="math inline">\(44\%\)</span> larger than the original bias current of <span class="math inline">\(500\)</span> <span class="math inline">\(\mu\)</span><span class="math inline">\(A\)</span>.</p>
<p>As a final verification step, we recompute the bandwidth estimate using the new value of Rout. The time constant <span class="math inline">\(\tau_{gso}\)</span> remains the same, while the change in <span class="math inline">\(\tau_{gdo}\)</span> is negligible. The dominant OCT modifies as follows</p>
<p><span class="math display">\[
\tau_{dbo}^{\prime} = 4k\Omega (11.6fF + 10pF) = 40.05ns
\]</span></p>
<p>The modified bandwidth estimate is therefore</p>
<p><span class="math display">\[
f_{3dB} = \frac{1}{2\pi} \cdot \frac{1}{2.035ns + 40.05ns + 3.05ns} = 3.53MHz
\]</span></p>
<p>which is about <span class="math inline">\(22\%\)</span> larger than the original bandwidth, satisfying our design intent.</p>
</section>
<section id="oct-extensions" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="oct-extensions"><span class="header-section-number">3.4.3</span> <span id="oct-extensions">OCT Extensions</span></h3>
<p>The OCT analysis covered in this section is tailored toward finding the upper corner frequency in circuits that are limited by capacitive elements; this is the most common situation encountered in integrated circuit design. For completeness, it is worth mentioning that there exists a method of short-circuit time constants (see <a href="#reference-3.3">Reference 3</a>), which aims at estimating the lower corner frequency of a circuit with a high-pass characteristic. This is useful for circuits that employ AC coupling of various forms.</p>
<p>&nbsp;&nbsp;&nbsp;In circuits that contain inductors, the additional time constants can be included by shorting all but one inductor at a time. The generalized framework that includes the consideration of both inductors and capacitors to estimate the upper corner frequency of a circuit is called <strong>zero-value time constant analysis</strong>. Finally, it is interesting to note that higher-order terms [such as <span class="math inline">\(b_2\)</span> in <a href="#eq-3.40" class="quarto-xref">Equation&nbsp;<span>3.40</span></a>] can be found using an OCT-like analysis. The interested reader is referred to <a href="#reference-3.4">Reference 4</a> for a comprehensive discussion of such methods.</p>
</section>
<section id="time-constants-versus-poles" class="level3" data-number="3.4.4">
<h3 data-number="3.4.4" class="anchored" data-anchor-id="time-constants-versus-poles"><span class="header-section-number">3.4.4</span> <span id="time-constants-versus-time">Time Constants versus Poles</span></h3>
<p>The distinction between open-circuit time constants and poles tends to be a source of confusion among circuit design students. We will therefore review the differences in this section using two examples.</p>
<p>&nbsp;&nbsp;&nbsp;Consider first the circuit of <a href="#fig-3.20" class="quarto-xref">Figure&nbsp;<span>3.23</span></a>. As we have shown above, this circuit has two open-circuit time constants, equal to <span class="math inline">\(RC\)</span>. Also we found that this circuit has two poles, located at <span class="math inline">\(–1/RC\)</span>. Thus, in this particular circuit, the poles coincide with the (reciprocals of the) time constants. The reason for this coincidence is that the two networks at the input and output are fully decoupled and represent simple first order <span class="math inline">\(RC\)</span> sections. For such a topology, the circuit designer sometimes loosely speaks of a “pole at the input” and “pole at the output,” which are directly set by the time constants of each network.</p>
<p>&nbsp;&nbsp;&nbsp; Consider now the circuit of <a href="#fig-3.21" class="quarto-xref">Figure&nbsp;<span>3.25</span></a>, which is the same as <a href="#fig-3.20" class="quarto-xref">Figure&nbsp;<span>3.23</span></a>, except that we have added an additional capacitor <span class="math inline">\(C\)</span> between the input and output terminal. This circuit retains the two open-circuit time constants of the original circuit (equal to <span class="math inline">\(RC\)</span>), but has an additional one due to the added capacitor, equal to <span class="math inline">\(RC(2 + g_mR)\)</span>. On the other hand, the poles of this circuit can no longer be found by inspection. The transfer function has the form of <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a>, with <span class="math inline">\(b_1 = RC(4 + g_mR)\)</span> and <span class="math inline">\(b_2 = 3(RC)^2\)</span>. The two poles of the circuit are the roots of the denominator polynomial <span class="math inline">\(1 + b_1s + b_2s^2 = 0\)</span> and their value depends on the value of <span class="math inline">\(g_mR\)</span>. Assuming <span class="math inline">\(g_mR = 2\)</span> as a numerical example, the roots, and therefore the poles become</p>
<p><span id="eq-3.76"><span class="math display">\[
p_{1,2} = - \frac{1}{RC}\left(1\pm \sqrt{\frac{2}{3}}\right)
\tag{3.76}\]</span></span></p>
<div id="fig-3.21" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.21.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.25: Circuit example with three open-circuit time constants.
</figcaption>
</figure>
</div>
<p>As we can see from this result, the poles do not coincide with any of the open-circuit time constants. More significantly, the number of poles (two) is not even equal to the number of open-circuit time constants (three).</p>
<p>&nbsp;&nbsp;&nbsp;As we can see from this result, the poles do not coincide with any of the open-circuit time constants. More significantly, the number of poles (two) is not even equal to the number of open-circuit time constants (three).</p>
<p>&nbsp;&nbsp;&nbsp;Finally, to fully close the loop between the two analysis techniques, note that the magnitude of the low-frequency pole in <a href="#eq-3.76" class="quarto-xref">Equation&nbsp;<span>3.76</span></a> is approximately equal to <span class="math inline">\(0.18/RC\)</span>. This is close to the 3-dB bandwidth predicted by the sum of the open-circuit time constants (for <span class="math inline">\(g_mR = 2\)</span>): <span class="math inline">\(1/(4RC + RC + RC) = 0.167/RC\)</span>, which, as expected, is slightly conservative.</p>
</section>
</section>
<section id="high-frequency-two-port-model-for-the-common-source-voltage-amplifier" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="high-frequency-two-port-model-for-the-common-source-voltage-amplifier"><span class="header-section-number">3.5</span> <span id="high-frequency-two-port-model-for-the-common-source-voltage-amplifier">High-Frequency Two-Port Model for the Common-Source Voltage Amplifier</span></h2>
<p>To summarize, <a href="#fig-3.22" class="quarto-xref">Figure&nbsp;<span>3.26</span></a> shows the most general two-port model for the common-source voltage amplifier [similar to <a href="#fig-3.13" class="quarto-xref">Figure&nbsp;<span>3.15</span></a>] with source and load networks included. The advantage of this model representation is that it is valid for arbitrary component values. The disadvantage is that analyzing a circuit based on this model leads to complex equations. Generally, one should use this model as the starting point for the analysis of more complex circuits that contain a CS amplifier (see <a href="#multistage-amplifiers">Chapter 6</a>). Then, whenever suitable, we can invoke simplifications such as the Miller approximation or open-circuit time constants to simplify the analysis.</p>
<p>&nbsp;&nbsp;&nbsp;Finally, note that the model of <a href="#fig-3.22" class="quarto-xref">Figure&nbsp;<span>3.26</span></a> is not well suited for a translation into a native voltage amplifier model (using a voltage controlled voltage source) as done for the low-frequency circuit in <a href="partI.2.html#two-port-model-for-the-common-source-voltage-amplifier">Section 2-4</a>. The capacitors connected to the output port would lead to a frequency-dependent open-circuit gain and output impedance (<span class="math inline">\(Z_{out}\)</span> rather than <span class="math inline">\(R_{out}\)</span>) that give a non-intuitive representation of the circuit. It is therefore preferred to describe this voltage amplifier using the transconductance model as shown.</p>
<div id="fig-3.22" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-3.22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure3.22.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-3.22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.26: General two-port model for the common-source voltage amplifier valid at high frequencies.
</figcaption>
</figure>
</div>
</section>
<section id="summary" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="summary"><span class="header-section-number">3.6</span> Summary</h2>
<p>In this chapter we have reviewed the basic concepts of frequency domain analysis and introduced the intrinsic and extrinsic device capacitances of a MOSFET. Using the obtained small-signal model, the frequency response of any circuit can be obtained from first principles using the following steps:</p>
<ol type="1">
<li><p>Derive the transfer function using a nodal analysis.</p></li>
<li><p>Let and solve for the magnitude of the <span class="math inline">\(s=j\omega\)</span> resulting expression.</p></li>
<li><p>Set the magnitude equal to <span class="math inline">\(1/\sqrt 2\)</span> times the DC gain value, and solve for <span class="math inline">\(\omega\)</span>.</p></li>
</ol>
<p>Unfortunately, this method is algebraically too complex for all but the most basic circuits. Consequently, we introduced several approximate methods and tools that are frequently used by analog circuit designers. These methods were developed using our driving example of a common-source voltage amplifier, but are widely used in other situations as well</p>
<ul>
<li><p>Provided that an exact (and potentially complicated) transfer function expression is available, the dominant pole approximation can be applied to arrive at a simplified bandwidth expression. In this approximation, it is assumed that a single pole dominates the response and sets the circuit’s 3-dB bandwidth.</p></li>
<li><p>The Miller approximation was used to obtain a quick estimate of the 3 -dB bandwidth specifically for the common-source voltage amplifier. Although it is not an exact calculation, it is very useful for determining an estimate of the bandwidth of the amplifier analytically. Furthermore, this analysis gave insight into the effect of “Miller-multiplication” of a capacitor that appears across a voltage gain path. This effect is found in a multitude of circuits, and understanding this mechanism is insightful for design.</p></li>
<li><p>The method of open-circuit time constants is the most powerful and most broadly applicable technique discussed in this chapter. It provides an accurate answer for the circuit’s bandwidth if a dominant pole condition exists. Even if the dominant pole condition is not strictly met, the method yields acceptable errors (on the conservative side) on the order of a few tens of percent, which is often acceptable in a first-order hand analysis. Finally, the method of open-circuit time constants is an excellent design tool since it assists in finding which capacitors and Thévenin resistances are dominating the dynamic performance.</p></li>
</ul>
</section>
<section id="references" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="references"><span class="header-section-number">3.7</span> References</h2>
<ol type="1">
<li><p><span id="reference-3.1">R. F. Pierret</span>, <strong>Semiconductor Device Fundamentals</strong>, Prentice Hall, 1995.</p></li>
<li><p><span id="reference-3.2">D. K. Shaeffer and T. H. Lee</span>, “A 1.5 V, 1.5 GHz CMOS low noise amplifier,” <strong>IEEE J. Solid-State Circuits</strong>, pp.&nbsp;745–759, May 1997.</p></li>
<li><p><span id="reference-3.3">P. E. Gray and C. L. Searle</span>, <strong>Electronic Principles Physics, Models, and Circuits</strong>, Wiley, 1969.</p></li>
<li><p><span id="reference-3.4">A. Hajimiri</span>, “Generalized Time- and Transfer-Constant Circuit Analysis,” <strong>IEEE Trans. Circuits and Systems I</strong>, Vol. 27, No.&nbsp;6, pp.&nbsp;1105–1121, June 2010.</p></li>
</ol>
</section>
<section id="problems" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="problems"><span class="header-section-number">3.8</span> Problems</h2>
<p>Unless otherwise stated, use the standard model parameters specified in <a href="#tbl-3.1">Table 3-1</a> for the problems given below. Consider only first-order MOSFET behavior and include channel-length modulation (as well as any other second-order effects) only where explicitly stated.</p>
<p><strong>P3.1</strong> Sketch the Bode plots (magnitude and phase) for the following transfer functions. Assume <span class="math inline">\(R_iC_i \gg R_kC_k\)</span> if <span class="math inline">\(i &gt; k\)</span>.</p>
<ol type="a">
<li><p><span class="math inline">\([1 / (1 + j\omega R_1 C_1)] [(1 / (1 + j\omega R_2 C_2))]\)</span></p></li>
<li><p><span class="math inline">\((j\omega R_3 C_3) [(1 + j\omega R_4 C_4) / (1 + j\omega R_5 C_5)]\)</span></p></li>
<li><p><span class="math inline">\([(1 + j\omega R_6 C_6) / (1 + j\omega R_8 C_8)] [(1 + j\omega R_7 C_7) / (1 + j\omega R_9 C_9)]\)</span></p></li>
</ol>
<p><strong>P3.2</strong> A system has a DC gain of 500, LHP zeros at <span class="math inline">\(10\)</span> <span class="math inline">\(kHz\)</span> and <span class="math inline">\(1\)</span> <span class="math inline">\(MHz\)</span> and LHP poles at <span class="math inline">\(100\)</span> <span class="math inline">\(kHz\)</span>, <span class="math inline">\(10\)</span> <span class="math inline">\(MHz\)</span>, and <span class="math inline">\(100\)</span> <span class="math inline">\(MHz\)</span>.</p>
<ol type="a">
<li><p>Write the <span class="math inline">\(s\)</span>-domain transfer function that describes this system.</p></li>
<li><p>Draw a Bode plot for both the magnitude and phase of this system.</p></li>
<li><p>Switch the poles and zeros and repeat parts (a) and (b).</p></li>
</ol>
<p><strong>P3.3</strong> Sketch the Bode plot for the magnitude, <span class="math inline">\(|I_o /I_s|_{dB}\)</span> and phase <span class="math inline">\(\angle I_o/I_s\)</span> of the circuit shown in <a href="#fig-p3-3" class="quarto-xref">Figure&nbsp;<span>3.27</span></a>, given</p>
<ol type="a">
<li><p><span class="math inline">\(R_1\)</span> = <span class="math inline">\(10\)</span> <span class="math inline">\(k\Omega\)</span>, <span class="math inline">\(R_2\)</span> = <span class="math inline">\(100\)</span> <span class="math inline">\(k\Omega\)</span>, <span class="math inline">\(C = 1\)</span> <span class="math inline">\(pF\)</span></p></li>
<li><p><span class="math inline">\(R_1\)</span> = <span class="math inline">\(0.1\)</span> <span class="math inline">\(k\Omega\)</span>, <span class="math inline">\(R_2\)</span> = <span class="math inline">\(100\)</span> <span class="math inline">\(k\Omega\)</span>, <span class="math inline">\(C = 1\)</span> <span class="math inline">\(pF\)</span></p></li>
<li><p><span class="math inline">\(R_1\)</span> = <span class="math inline">\(10\)</span> <span class="math inline">\(k\Omega\)</span>, <span class="math inline">\(R_2\)</span> = <span class="math inline">\(100\)</span> <span class="math inline">\(k\Omega\)</span>, <span class="math inline">\(C = 10\)</span> <span class="math inline">\(pF\)</span></p></li>
</ol>
<div id="fig-p3-3" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p3-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-p3-3.png" id="fig-p3-3" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-p3-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.27
</figcaption>
</figure>
</div>
<p><strong>P3.4</strong> Repeat <a href="#example-3-5">Example 3-5</a> for the following parameters (assuming <span class="math inline">\(V_{DS}\)</span> = <span class="math inline">\(2.5\)</span> <span class="math inline">\(V\)</span>). For each case, compute by which factor the transistor’s transit frequency has changed relative to the value seen in <a href="#example-3-5">Example 3-5</a>.</p>
<ol type="a">
<li><span class="math inline">\(I_D = 500\)</span> <span class="math inline">\(\mu A\)</span>, <span class="math inline">\(L= 2\)</span> <span class="math inline">\(\mu m\)</span>, and <span class="math inline">\(W= 20\)</span> <span class="math inline">\(\mu m\)</span>.</li>
<li><span class="math inline">\(I_D = 500\)</span> <span class="math inline">\(\mu A\)</span>, <span class="math inline">\(L= 1\)</span> <span class="math inline">\(\mu m\)</span>, and <span class="math inline">\(W= 40\)</span> <span class="math inline">\(\mu m\)</span>.</li>
<li><span class="math inline">\(I_D = 1000\)</span> <span class="math inline">\(\mu A\)</span>, <span class="math inline">\(L= 1\)</span> <span class="math inline">\(\mu m\)</span>, and <span class="math inline">\(W= 40\)</span> <span class="math inline">\(\mu m\)</span>.</li>
</ol>
<p><strong>P3.5</strong> Repeat <a href="#example-3-5">Example 3-5</a> for a p-channel MOSFET operating in saturation. Parameters: <span class="math inline">\(V_{SD} = 2.5\)</span> <span class="math inline">\(V\)</span>, <span class="math inline">\(–I_D = 500\)</span> <span class="math inline">\(\mu A\)</span>, <span class="math inline">\(L= 1\)</span> <span class="math inline">\(\mu m\)</span>, and <span class="math inline">\(W= 20\)</span> <span class="math inline">\(\mu m\)</span>. Compute the ratio of the transit frequency obtained in <a href="#example-3-5">Example 3-5</a> and the value obtained for the p-channel device analyzed in this problem. What is the main parameter that is responsible for the lower <span class="math inline">\(f_T\)</span> observed for the p-channel MOSFET?</p>
<p><strong>P3.6</strong> Calculate the drain-bulk capacitance of a <span class="math inline">\(100\)</span> <span class="math inline">\(\mu m\)</span> wide n-channel transistor for <span class="math inline">\(V_{DB} = 2.5\)</span> <span class="math inline">\(V\)</span>. Repeat the analysis for <span class="math inline">\(V_{DB} = 1\)</span> <span class="math inline">\(V\)</span> and <span class="math inline">\(V_{DB} = 4\)</span> <span class="math inline">\(V\)</span> and quantify by which factor the capacitance changes relative to the case of <span class="math inline">\(V_{DB} = 2.5\)</span> <span class="math inline">\(V\)</span>.</p>
<p><strong>P3.7</strong> Calculate the 3-dB bandwidth of the circuit shown in <a href="#fig-p3-7" class="quarto-xref">Figure&nbsp;<span>3.28</span></a>. Note that both MOSFETs operate in the triode region. Parameters: <span class="math inline">\(W_1 =10\)</span> <span class="math inline">\(\mu m\)</span>, <span class="math inline">\(L_1=1\)</span> <span class="math inline">\(\mu m\)</span>, <span class="math inline">\(W_2=10\)</span> <span class="math inline">\(\mu m\)</span>, <span class="math inline">\(L_2=10\)</span> <span class="math inline">\(\mu m\)</span>, <span class="math inline">\(V_S = 2\)</span> <span class="math inline">\(V\)</span>, <span class="math inline">\(V_{DD} = 5\)</span> <span class="math inline">\(V\)</span>. Consider only the intrinsic gate capacitance.</p>
<div id="fig-p3-7" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p3-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-p3-7.png" id="fig-p3-7" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-p3-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.28
</figcaption>
</figure>
</div>
<p><strong>P3.8</strong> Plot the magnitude of <a href="#eq-3.38" class="quarto-xref">Equation&nbsp;<span>3.38</span></a> versus frequency using a software package such as <span class="math inline">\(MATLAB^{®*}\)</span> and find the exact value of the 3-dB frequency from the resulting graph. Parameters: <span class="math inline">\(g_m
= 1\)</span> <span class="math inline">\(mS\)</span>, <span class="math inline">\(C_{gs} = 40.7\)</span> <span class="math inline">\(fF\)</span>, <span class="math inline">\(C_{gd}\)</span> = <span class="math inline">\(10\)</span> <span class="math inline">\(fF\)</span>, <span class="math inline">\(C_{db}\)</span> = <span class="math inline">\(11.6\)</span> <span class="math inline">\(fF\)</span>, <span class="math inline">\(R_{out}\)</span> = <span class="math inline">\(5\)</span> <span class="math inline">\(k\Omega\)</span> and <span class="math inline">\(R_s\)</span> = <span class="math inline">\(50\)</span> <span class="math inline">\(k\Omega\)</span> (same as in <a href="#example-3-7">Examples 3-7</a>. Compare the obtained number with the approximate results obtained in <a href="#example-3-7">Examples 3-7</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>MATLAB is a registered trademark of The MathWorks, Inc.,<br>
3 Apple Hill Road, Natick, MA.</p>
</div>
</div>
<p><strong>P3.9</strong> Calculate the frequency of the non-dominant pole of the circuit analyzed in <a href="#example-3-6">Example 3-6</a>.</p>
<p><strong>P3.10</strong> For <span class="math inline">\(A_{vM}\)</span> = <span class="math inline">\(1\)</span>, <a href="#eq-3.51" class="quarto-xref">Equation&nbsp;<span>3.51</span></a> predicts an effective input capacitance of <span class="math inline">\(C_{eff} = 0\)</span>. Explain this result intuitively, in words. Hint: Consider the voltage waveforms at the input and output of <a href="#fig-3.15" class="quarto-xref">Figure&nbsp;<span>3.18</span></a> for this particular case.</p>
<p><strong>P3.11</strong> In <a href="#example-3-7">Examples 3-7</a>, we saw that the bandwidth estimate obtained through the Miller Approximation was in close agreement with the result from the full analysis (incorporating a dominant pole approximation). In contrast, if we were to apply the Miller Approximation result of <a href="#eq-3.56" class="quarto-xref">Equation&nbsp;<span>3.56</span></a> to <a href="#example-3-8">Examples 3-8</a>, we would find a large error in the resulting answer (convince yourself that this is true). Explain why it is not appropriate to use <a href="#eq-3.56" class="quarto-xref">Equation&nbsp;<span>3.56</span></a> to estimate the bandwidth of the circuit in <a href="#example-3-8">Examples 3-8</a>.</p>
<p><strong>P3.12</strong> Consider the circuit of <a href="#fig-ex-3.8" class="quarto-xref">Figure&nbsp;<span>3.24</span></a> with the following parameters: <span class="math inline">\(W = 100\)</span> <span class="math inline">\(\mu m\)</span>, <span class="math inline">\(L = 2\)</span> <span class="math inline">\(\mu m\)</span>, <span class="math inline">\(I_B = 3\)</span> <span class="math inline">\(mA\)</span>, <span class="math inline">\(V_B\)</span> = <span class="math inline">\(2.5\)</span> <span class="math inline">\(V\)</span>, <span class="math inline">\(C_L\)</span> = <span class="math inline">\(100\)</span> <span class="math inline">\(fF\)</span>, <span class="math inline">\(R_D\)</span> = <span class="math inline">\(1\)</span> <span class="math inline">\(k\Omega\)</span> and <span class="math inline">\(R_s\)</span> = <span class="math inline">\(10\)</span> <span class="math inline">\(k\Omega\)</span> .</p>
<ol type="a">
<li><p>Estimate the required DC input bias <span class="math inline">\(V_S\)</span> such that <span class="math inline">\(I_D = I_B\)</span> and <span class="math inline">\(V_{OUT} = V_B\)</span>. Neglect channel-length modulation.</p></li>
<li><p>Calculate the MOSFET’s transconductance and all device capacitances.</p></li>
<li><p>Estimate the circuit’s 3-dB bandwidth considering only the intrinsic gate capacitance.</p></li>
<li><p>Estimate the circuit’s 3-dB bandwidth using the Miller approximation.</p></li>
<li><p>Estimate the circuit’s 3-dB bandwidth using an OCT analysis.</p></li>
</ol>
<p><strong>P3.13</strong> Consider the circuit shown in <a href="#fig-p3-13" class="quarto-xref">Figure&nbsp;<span>3.29</span></a>.</p>
<ol type="a">
<li><p>Write an analytical expression for the circuit’s 3-dB bandwidth using an OCT analysis.</p></li>
<li><p>Determine the exact analytical result for the circuit’s 3-dB bandwidth.</p></li>
<li><p>Compute the percent-error of the result in part (a), relative to the accurate result of part (b).</p></li>
</ol>
<div id="fig-p3-13" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p3-13-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-p3-13.png" id="fig-p3-13" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-p3-13-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.29
</figcaption>
</figure>
</div>
<p><strong>P3.14</strong> In this chapter, we saw that using the OCT method to estimate a circuits’ bandwidth tends to be conservative. For example, in a circuit with two identical real poles (and no zeros), the bandwidth predicted using the OCT method is <span class="math inline">\(22\%\)</span> lower than the actual bandwidth [see <a href="#eq-3.75" class="quarto-xref">Equation&nbsp;<span>3.75</span></a>]. Derive an analytical expression <span class="math inline">\(f(n)\)</span> that returns the percent error of the OCT analysis for a circuit with n identical real poles and no zeros. Note that <span class="math inline">\(f(2) = –22\%\)</span>.</p>
<p><strong>P3.15</strong> Consider the common-source voltage amplifier of <a href="#fig-ex-3.8" class="quarto-xref">Figure&nbsp;<span>3.24</span></a>. The goal of this design problem is to achieve a small-signal DC gain of <span class="math inline">\(-4\)</span> and a 3-dB bandwidth of <span class="math inline">\(80\)</span> <span class="math inline">\(MHz\)</span>. In addition, we wish to minimize the current consumption of the circuit. For simplicity in your calculations, neglect channel-length modulation and consider only the intrinsic gate capacitance. Assume the following parameters: <span class="math inline">\(R_s = 2R_D\)</span>, <span class="math inline">\(R_D\)</span> = <span class="math inline">\(5\)</span> <span class="math inline">\(k\Omega\)</span>, <span class="math inline">\(C_L\)</span> = <span class="math inline">\(1\)</span> <span class="math inline">\(pF\)</span>.</p>
<ol type="a">
<li><p>Show that the required drain current <span class="math inline">\(I_D\)</span> is related to the circuit’s parameters and specifications as expressed below. In your analysis, approximate <span class="math inline">\(\omega_{3dB}\)</span> using an OCT analysis. Plot <span class="math inline">\(I_D\)</span> as a function of <span class="math inline">\(V_{OV}\)</span> for <span class="math inline">\(L = 1\)</span> <span class="math inline">\(\mu m\)</span> and <span class="math inline">\(L = 1.5\)</span> <span class="math inline">\(\mu m\)</span>.<span class="math display">\[I_D = \frac{1}{2}\frac{ C_L \cdot |A_{v0}| \cdot \omega_{3{dB}} \cdot V_{OV}}{1 - \frac{2}{3} \frac{L^2}{\mu_n V_{OV}} \cdot \frac{R_s}{R_D} \cdot |A_{v0}| \, \omega_{3dB}}\]</span> Note from this result that the choice of the gate overdrive voltage <span class="math inline">\(V_{OV}\)</span> plays an important role in minimizing the required drain current.</p></li>
<li><p>From the expression and plots found in part (a), it is clear that the minimum channel length minimizes the current consumption of the amplifier. Explain in your words why this should be the case.</p></li>
<li><p>The drain current expression derived in (a) has a minimum for a certain value of <span class="math inline">\(V_{OV}\)</span>. Calculate this value assuming <span class="math inline">\(L = 1\)</span> <span class="math inline">\(\mu m\)</span> (minimum length). Also calculate <span class="math inline">\(R_D\)</span>, the device width and drain current for the transistor at this optimum point.</p></li>
<li><p>Simulate the design using SPICE with the bias current and device geometries calculated in part (c). Measure the bandwidth of the circuit using an AC simulation. Since the SPICE transistor model contains extrinsic capacitances and finite output resistance, your circuit should fall short of the desired specs (despite the fact that we have used a conservative OCT estimate for <span class="math inline">\(\omega_{3dB}\)</span>). Calculate the percent discrepancies in the gain and bandwidth of the circuit.</p></li>
<li><p>Use a spreadsheet or math tool (Excel, <span class="math inline">\(MATLAB^{®*}\)</span>, etc.) to setup the design equations for gain and bandwidth that include extrinsic capacitances and finite output conductance. With these additional modeling components added, it is difficult to derive a compact closed form solution as above. However, the setup in the spreadsheet will allow you to sweep the design parameters easily to find the new optimum that meets the gain and bandwidth specs. There are many different ways in which the spreadsheet can be structured. One is to use the width of the transistor as the main “knob” and calculate/iterate over all other parameters. The hand-calculated result can be used as an initial guess in this optimization. Use your spreadsheet to calculate the new bias current and device size that will meet the specs.</p></li>
<li><p>Simulate the refined design from (e) in SPICE and verify that you meet the desired specs. What is the obtained <span class="math inline">\(I_D\)</span>, and how much larger is this value compared to the result from (c)?</p></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><span id="matlab">MATLAB</span> is a registered trademark of The MathWorks, Inc.,<br>
3 Apple Hill Road, Natick, MA.</p>
</div>
</div>
<p><strong><span id="p3.16">P3.16</span></strong> For the circuit shown in <a href="#fig-p3-16" class="quarto-xref">Figure&nbsp;<span>3.30</span></a>, prove the following results, quantifying the Thévenin resistances seen between each pair of transistor terminals. Neglect the finite <span class="math inline">\(r_o\)</span> of the MOSFET.</p>
<p><span class="math display">\[
R_{gs} = \frac{R_G + R_S}{1 + g_m R_S}
\]</span></p>
<p><span class="math display">\[
R_{ds} = \frac{R_D + R_S}{1 + g_m R_S}
\]</span></p>
<p><span class="math display">\[
R_{gd} = R_G + R_D + G_m R_G R_D
\]</span></p>
<p>where</p>
<p><span class="math display">\[
G_m = \frac{g_m}{1 + g_m R_S}
\]</span></p>
<div id="fig-p3-16" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p3-16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-p3-16.png" id="fig-p3-16" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-p3-16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.30
</figcaption>
</figure>
</div>
<p><strong>P3.17</strong> The circuit shown in <a href="#fig-p3-17" class="quarto-xref">Figure&nbsp;<span>3.31</span></a> is called a “source degenerated” common-source voltage amplifier. Analyze this circuit as indicated below.</p>
<ol type="a">
<li><p>Neglecting channel-length modulation and all capacitances in the circuit, show that the circuit’s small-signal DC gain is given by <span class="math display">\[ \frac{v_{out}}{v_{in}} \simeq -G_mR_D\]</span> where <span class="math display">\[G_m = \frac{g_m}{1+ g_mR_S}\]</span> is called the compound transconductance.</p></li>
<li><p>Using the results stated in <a href="#p3.16">Problem 3.16</a>, estimate the DC gain and 3-dB bandwidth of the circuit assuming the following parameters: <span class="math inline">\(R_G = 10\)</span> <span class="math inline">\(k\Omega\)</span>, <span class="math inline">\(R_S\)</span> = <span class="math inline">\(1\)</span> <span class="math inline">\(k\Omega\)</span>, <span class="math inline">\(R_D\)</span> = <span class="math inline">\(5\)</span> <span class="math inline">\(k\Omega\)</span>, <span class="math inline">\(I_D\)</span> = <span class="math inline">\(500\)</span> <span class="math inline">\(\mu A\)</span>, <span class="math inline">\(L= 1\)</span> <span class="math inline">\(\mu m\)</span>, and <span class="math inline">\(W= 20\)</span> <span class="math inline">\(\mu m\)</span>. Consider only the two time constants contributed by <span class="math inline">\(C_{gs}\)</span> and <span class="math inline">\(C{gd}\)</span>.</p></li>
</ol>
<div id="fig-p3-17" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p3-17-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/png/figure-p3-17.png" id="fig-p3-17" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-p3-17-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.31
</figcaption>
</figure>
</div>
</section>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../contents/partI/partI.2.html" class="pagination-link" aria-label="Transfer Characteristic of the Common-Source Voltage Amplifier">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Transfer Characteristic of the Common-Source Voltage Amplifier</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../contents/partI/partI.4.html" class="pagination-link" aria-label="The Common-Gate and Common-Drain Stages">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Common-Gate and Common-Drain Stages</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Curated by Boris Murmann</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions"><ul><li><a href="https://github.com/bmurmann/COCOA/edit/main/contents/partI/partI.3.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/bmurmann/COCOA/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/bmurmann/COCOA/blob/main/contents/partI/partI.3.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>